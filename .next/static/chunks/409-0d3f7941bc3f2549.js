"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[409],{19428:(e,a,i)=>{i.d(a,{_:()=>E});var r=i(11291),s=i(97451),t=i(90718),c=i(82596),l=i(9983),n=i(68630),o=i(59030);let d=(0,o.createServerReference)("40f45b0ba7869e5efca05903df5bae73716a441e60",o.callServer,void 0,o.findSourceMapURL,"getNotes"),m=(0,o.createServerReference)("404363690534c2998b66a11f263b62b36e34dad7a0",o.callServer,void 0,o.findSourceMapURL,"createNote"),p=(0,o.createServerReference)("608003ec4135bd8a3f48d78862a427b9d9f7e694e7",o.callServer,void 0,o.findSourceMapURL,"updateNote"),u=(0,o.createServerReference)("403a9e16c07af6b299c708c6b20892839c7f8aa116",o.callServer,void 0,o.findSourceMapURL,"deleteNote");var x=i(93293),h=i(66656),v=i(92608);let j=(0,v.A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),f=(0,v.A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var g=i(23403),b=i(35947),y=i(62490),N=i(94724);function E(e){let{caseId:a,canCreateNotes:i=!1,canEditNotes:o=!1,showPrivateNotes:x=!0}=e,[v,y]=(0,s.useState)([]),[N,E]=(0,s.useState)(!0),[k,S]=(0,s.useState)(!1),[_,C]=(0,s.useState)(null),[A,R]=(0,s.useState)({tipo:"privada",contenido:""}),{toast:M}=(0,n.dj)(),z=async()=>{E(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?y(e.notes):M({title:"Error",description:e.error||"Error al cargar notas",variant:"destructive"})}catch(e){console.error("Error loading notes:",e),M({title:"Error",description:"Error inesperado al cargar notas",variant:"destructive"})}finally{E(!1)}};(0,s.useEffect)(()=>{z()},[a]);let L=async()=>{if(!A.contenido.trim())return void M({title:"Error",description:"El contenido de la nota es requerido",variant:"destructive"});S(!0);try{let e={case_id:a,tipo:A.tipo,contenido:A.contenido.trim()},i=await m(e);i.success?(M({title:"Nota creada",description:"La nota ha sido creada exitosamente"}),R({tipo:"privada",contenido:""}),await z()):M({title:"Error",description:i.error||"Error al crear la nota",variant:"destructive"})}catch(e){console.error("Error creating note:",e),M({title:"Error",description:"Error inesperado al crear la nota",variant:"destructive"})}finally{S(!1)}},D=async(e,a)=>{try{let i=await p(e,{contenido:a.trim()});i.success?(M({title:"Nota actualizada",description:"La nota ha sido actualizada exitosamente"}),C(null),await z()):M({title:"Error",description:i.error||"Error al actualizar la nota",variant:"destructive"})}catch(e){console.error("Error updating note:",e),M({title:"Error",description:"Error inesperado al actualizar la nota",variant:"destructive"})}},q=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta nota?"))try{let a=await u(e);a.success?(M({title:"Nota eliminada",description:"La nota ha sido eliminada exitosamente"}),await z()):M({title:"Error",description:a.error||"Error al eliminar la nota",variant:"destructive"})}catch(e){console.error("Error deleting note:",e),M({title:"Error",description:"Error inesperado al eliminar la nota",variant:"destructive"})}},I=e=>"publica"===e?(0,r.jsx)(h.A,{className:"h-4 w-4 text-blue-600"}):(0,r.jsx)(j,{className:"h-4 w-4 text-gray-600"}),P=e=>"publica"===e?(0,r.jsx)(l.E,{variant:"default",children:"P\xfablica"}):(0,r.jsx)(l.E,{variant:"secondary",children:"Privada"}),Y=x?v:v.filter(e=>"publica"===e.tipo);return N?(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(f,{className:"h-5 w-5"}),"Notas"]})}),(0,r.jsx)(c.Wu,{children:(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)(g.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(f,{className:"h-5 w-5"}),"Notas (",Y.length,")"]}),i&&(0,r.jsxs)(t.$,{size:"sm",onClick:()=>S(!k),disabled:k,children:[(0,r.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Nueva Nota"]})]})}),(0,r.jsxs)(c.Wu,{className:"space-y-4",children:[k&&i&&(0,r.jsx)(c.Zp,{className:"border-dashed",children:(0,r.jsx)(c.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tipo de nota"}),(0,r.jsxs)("select",{value:A.tipo,onChange:e=>R({...A,tipo:e.target.value}),className:"form-input",children:[(0,r.jsx)("option",{value:"privada",children:"Privada (solo abogados)"}),(0,r.jsx)("option",{value:"publica",children:"P\xfablica (visible para cliente)"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Contenido"}),(0,r.jsx)("textarea",{value:A.contenido,onChange:e=>R({...A,contenido:e.target.value}),placeholder:"Escribe tu nota aqu\xed...",rows:4,className:"form-input"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(t.$,{variant:"outline",onClick:()=>{S(!1),R({tipo:"privada",contenido:""})},children:"Cancelar"}),(0,r.jsx)(t.$,{onClick:L,children:"Crear Nota"})]})]})})}),(0,r.jsx)("div",{className:"space-y-3",children:Y.map(e=>(0,r.jsx)(w,{note:e,canEdit:o,isEditing:_===e.id,onEdit:()=>C(e.id),onCancelEdit:()=>C(null),onSave:a=>D(e.id,a),onDelete:()=>q(e.id),getTypeIcon:I,getTypeBadge:P},e.id))}),0===Y.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)(f,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,r.jsx)("p",{children:"No hay notas para este caso"}),i&&(0,r.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Nota" para agregar la primera nota'})]})]})]})}function w(e){var a;let{note:i,canEdit:l,isEditing:n,onEdit:o,onCancelEdit:d,onSave:m,onDelete:p,getTypeIcon:u,getTypeBadge:h}=e,[v,j]=(0,s.useState)(i.contenido);return(0,r.jsx)(c.Zp,{className:"border-l-4 border-l-blue-500",children:(0,r.jsxs)(c.Wu,{className:"pt-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[u(i.tipo),h(i.tipo),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["por ",(null==(a=i.author)?void 0:a.nombre)||"Usuario"]}),(0,r.jsx)("span",{className:"text-sm text-gray-400",children:(0,x.fw)(i.created_at)})]}),l&&(0,r.jsx)("div",{className:"flex items-center gap-1",children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.$,{variant:"ghost",size:"sm",onClick:d,children:"Cancelar"}),(0,r.jsx)(t.$,{size:"sm",onClick:()=>{v.trim()&&m(v)},children:"Guardar"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.$,{variant:"ghost",size:"sm",onClick:o,children:(0,r.jsx)(y.A,{className:"h-4 w-4"})}),(0,r.jsx)(t.$,{variant:"ghost",size:"sm",onClick:p,children:(0,r.jsx)(N.A,{className:"h-4 w-4"})})]})})]}),n?(0,r.jsx)("textarea",{value:v,onChange:e=>j(e.target.value),rows:4,className:"form-input w-full"}):(0,r.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,r.jsx)("p",{className:"whitespace-pre-wrap text-gray-700",children:i.contenido})})]})})}},20907:(e,a,i)=>{i.d(a,{$:()=>C});var r=i(11291),s=i(97451),t=i(90718),c=i(82596),l=i(9983),n=i(68630),o=i(59030);let d=(0,o.createServerReference)("401c3e5e9fb1d5c2bc713922df9b49cc9506e4102a",o.callServer,void 0,o.findSourceMapURL,"getDocuments"),m=(0,o.createServerReference)("403ecf2e2e00e98f7491362cb1a475942512f602ba",o.callServer,void 0,o.findSourceMapURL,"uploadDocument"),p=(0,o.createServerReference)("609d6fde2046d1536a173ef6460e6019ebe636596d",o.callServer,void 0,o.findSourceMapURL,"updateDocument"),u=(0,o.createServerReference)("406044a123b8b7a5866f2f5f01cf370cbf6075392d",o.callServer,void 0,o.findSourceMapURL,"deleteDocument"),x=(0,o.createServerReference)("4042a9d932eaf5c250a1d37041a85d12b5ce6080a7",o.callServer,void 0,o.findSourceMapURL,"getDocumentDownloadUrl");var h=i(93293),v=i(89064),j=i(92608);let f=(0,j.A)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);var g=i(68671),b=i(23403),y=i(35947);let N=(0,j.A)("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),E=(0,j.A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var w=i(62490),k=i(94724),S=i(66383);S.Ik({case_id:S.Yj().uuid("ID de caso inv\xe1lido"),nombre:S.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres"),visibilidad:S.k5(["privado","cliente"]).default("privado"),file:S.bz().optional()}),S.Ik({nombre:S.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres").optional(),visibilidad:S.k5(["privado","cliente"]).optional()}),S.Ik({case_id:S.Yj().uuid().optional(),visibilidad:S.k5(["privado","cliente"]).optional(),uploader_id:S.Yj().uuid().optional(),tipo_mime:S.Yj().optional(),search:S.Yj().optional(),page:S.ai().min(1).default(1),limit:S.ai().min(1).max(100).default(20)}),S.Ik({maxFileSize:S.ai().default(0xa00000),allowedTypes:S.YO(S.Yj()).default(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/gif","text/plain"])});let _={"application/pdf":{extension:"pdf",icon:"\uD83D\uDCC4",name:"PDF"},"application/msword":{extension:"doc",icon:"\uD83D\uDCDD",name:"Word"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{extension:"docx",icon:"\uD83D\uDCDD",name:"Word"},"image/jpeg":{extension:"jpg",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/png":{extension:"png",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/gif":{extension:"gif",icon:"\uD83D\uDDBC️",name:"Imagen"},"text/plain":{extension:"txt",icon:"\uD83D\uDCC4",name:"Texto"}};function C(e){let{caseId:a,canUpload:i=!1,canEdit:o=!1,canDelete:h=!1,showPrivateDocuments:j=!0}=e,[E,w]=(0,s.useState)([]),[k,S]=(0,s.useState)(!0),[C,R]=(0,s.useState)(!1),[M,z]=(0,s.useState)(null),[L,D]=(0,s.useState)(!1),q=(0,s.useRef)(null),{toast:I}=(0,n.dj)(),P=async()=>{S(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?w(e.documents):I({title:"Error",description:e.error||"Error al cargar documentos",variant:"destructive"})}catch(e){console.error("Error loading documents:",e),I({title:"Error",description:"Error inesperado al cargar documentos",variant:"destructive"})}finally{S(!1)}};(0,s.useEffect)(()=>{P()},[a]);let Y=async e=>{var i;let r=null==(i=e.target.files)?void 0:i[0];if(r){if(r.size>0xa00000)return void I({title:"Archivo demasiado grande",description:"El archivo debe ser menor a ".concat(10,"MB"),variant:"destructive"});if(!Object.keys(_).includes(r.type))return void I({title:"Tipo de archivo no permitido",description:"Solo se permiten archivos PDF, Word, im\xe1genes y texto",variant:"destructive"});R(!0);try{let e=new FormData;e.append("file",r),e.append("case_id",a),e.append("nombre",r.name),e.append("visibilidad","privado");let i=await m(e);i.success?(I({title:"Documento subido",description:"El documento ha sido subido exitosamente"}),D(!1),await P()):I({title:"Error",description:i.error||"Error al subir el documento",variant:"destructive"})}catch(e){console.error("Error uploading document:",e),I({title:"Error",description:"Error inesperado al subir el documento",variant:"destructive"})}finally{R(!1),q.current&&(q.current.value="")}}},Z=async(e,a)=>{try{let i=await p(e,a);i.success?(I({title:"Documento actualizado",description:"El documento ha sido actualizado exitosamente"}),z(null),await P()):I({title:"Error",description:i.error||"Error al actualizar el documento",variant:"destructive"})}catch(e){console.error("Error updating document:",e),I({title:"Error",description:"Error inesperado al actualizar el documento",variant:"destructive"})}},$=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este documento?"))try{let a=await u(e);a.success?(I({title:"Documento eliminado",description:"El documento ha sido eliminado exitosamente"}),await P()):I({title:"Error",description:a.error||"Error al eliminar el documento",variant:"destructive"})}catch(e){console.error("Error deleting document:",e),I({title:"Error",description:"Error inesperado al eliminar el documento",variant:"destructive"})}},U=async(e,a)=>{try{let i=await x(e);if(i.success&&i.url){let e=document.createElement("a");e.href=i.url,e.download=a,document.body.appendChild(e),e.click(),document.body.removeChild(e),I({title:"Descarga iniciada",description:"El documento se est\xe1 descargando"})}else I({title:"Error",description:i.error||"Error al generar enlace de descarga",variant:"destructive"})}catch(e){console.error("Error downloading document:",e),I({title:"Error",description:"Error inesperado al descargar el documento",variant:"destructive"})}},W=e=>{let a=_[e];return a?a.icon:"\uD83D\uDCC4"},F=e=>"cliente"===e?(0,r.jsx)(v.A,{className:"h-4 w-4 text-blue-600"}):(0,r.jsx)(f,{className:"h-4 w-4 text-gray-600"}),T=e=>"cliente"===e?(0,r.jsx)(l.E,{variant:"default",children:"Cliente"}):(0,r.jsx)(l.E,{variant:"secondary",children:"Privado"}),B=j?E:E.filter(e=>"cliente"===e.visibilidad);return k?(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(g.A,{className:"h-5 w-5"}),"Documentos"]})}),(0,r.jsx)(c.Wu,{children:(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)(b.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(g.A,{className:"h-5 w-5"}),"Documentos (",B.length,")"]}),i&&(0,r.jsxs)(t.$,{size:"sm",onClick:()=>D(!L),disabled:C,children:[(0,r.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Subir Documento"]})]})}),(0,r.jsxs)(c.Wu,{className:"space-y-4",children:[L&&i&&(0,r.jsx)(c.Zp,{className:"border-dashed",children:(0,r.jsx)(c.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Seleccionar archivo"}),(0,r.jsx)("input",{ref:q,type:"file",onChange:Y,accept:Object.keys(_).join(","),className:"form-input",disabled:C}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["M\xe1ximo ",10,"MB. Formatos: PDF, Word, im\xe1genes, texto"]})]}),C&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,r.jsx)(b.A,{className:"h-4 w-4 animate-spin"}),"Subiendo archivo..."]}),(0,r.jsx)("div",{className:"flex justify-end space-x-2",children:(0,r.jsx)(t.$,{variant:"outline",onClick:()=>D(!1),disabled:C,children:"Cancelar"})})]})})}),(0,r.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,r.jsx)(A,{document:e,canEdit:o,canDelete:h,isEditing:M===e.id,onEdit:()=>z(e.id),onCancelEdit:()=>z(null),onSave:a=>Z(e.id,a),onDelete:()=>$(e.id),onDownload:()=>U(e.id,e.nombre),getFileIcon:W,getVisibilityIcon:F,getVisibilityBadge:T},e.id))}),0===B.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)(N,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,r.jsx)("p",{children:"No hay documentos para este caso"}),i&&(0,r.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Subir Documento" para agregar el primer documento'})]})]})]})}function A(e){var a;let{document:i,canEdit:l,canDelete:n,isEditing:o,onEdit:d,onCancelEdit:m,onSave:p,onDelete:u,onDownload:x,getFileIcon:v,getVisibilityIcon:j,getVisibilityBadge:f}=e,[g,b]=(0,s.useState)({nombre:i.nombre,visibilidad:i.visibilidad});return(0,r.jsx)(c.Zp,{className:"border-l-4 border-l-green-500",children:(0,r.jsx)(c.Wu,{className:"pt-4",children:(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-2xl",children:v(i.tipo_mime||"")}),(0,r.jsxs)("div",{children:[o?(0,r.jsx)("input",{type:"text",value:g.nombre,onChange:e=>b({...g,nombre:e.target.value}),className:"form-input text-sm"}):(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:i.nombre}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[j(i.visibilidad||"privado"),o?(0,r.jsxs)("select",{value:g.visibilidad,onChange:e=>b({...g,visibilidad:e.target.value}),className:"form-input text-xs",children:[(0,r.jsx)("option",{value:"privado",children:"Privado"}),(0,r.jsx)("option",{value:"cliente",children:"Cliente"})]}):f(i.visibilidad||"privado"),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:(0,h.v7)(i.size_bytes||0)})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Subido por ",(null==(a=i.uploader)?void 0:a.nombre)||"Usuario"," • ",(0,h.fw)(i.created_at)]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(t.$,{variant:"ghost",size:"sm",onClick:x,children:(0,r.jsx)(E,{className:"h-4 w-4"})}),l&&(0,r.jsx)(r.Fragment,{children:o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.$,{variant:"ghost",size:"sm",onClick:m,children:"Cancelar"}),(0,r.jsx)(t.$,{size:"sm",onClick:()=>{g.nombre.trim()&&p(g)},children:"Guardar"})]}):(0,r.jsx)(t.$,{variant:"ghost",size:"sm",onClick:d,children:(0,r.jsx)(w.A,{className:"h-4 w-4"})})}),n&&!o&&(0,r.jsx)(t.$,{variant:"ghost",size:"sm",onClick:u,children:(0,r.jsx)(k.A,{className:"h-4 w-4"})})]})]})})})}},25361:(e,a,i)=>{i.d(a,{L:()=>R});var r=i(11291),s=i(97451),t=i(90718),c=i(82596),l=i(9983),n=i(68630),o=i(59030);let d=(0,o.createServerReference)("40a587fb7794c6b2018479cc7c785562ff1a08b62a",o.callServer,void 0,o.findSourceMapURL,"getInfoRequests"),m=(0,o.createServerReference)("406ff704c3af861ff370fa8797d3545de42fb3fb94",o.callServer,void 0,o.findSourceMapURL,"createInfoRequest"),p=(0,o.createServerReference)("60b3aa380a402bca113b72383818a3cf7c2e1f96d0",o.callServer,void 0,o.findSourceMapURL,"respondInfoRequest"),u=(0,o.createServerReference)("402c4cf049c9145bbd61609694edd7c54aa095d765",o.callServer,void 0,o.findSourceMapURL,"closeInfoRequest");var x=i(93293),h=i(71428),v=i(96843),j=i(38417),f=i(64501),g=i(23403),b=i(35947),y=i(11762),N=i(27416),E=i(90465);let w=(0,i(92608).A)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var k=i(49833),S=i(66383);S.Ik({case_id:S.Yj().uuid("ID de caso inv\xe1lido"),titulo:S.Yj().min(1,"El t\xedtulo es requerido").max(200,"El t\xedtulo no puede exceder 200 caracteres"),descripcion:S.Yj().min(1,"La descripci\xf3n es requerida").max(2e3,"La descripci\xf3n no puede exceder 2000 caracteres"),tipo:S.k5(["documento","informacion","reunion","otro"]).default("informacion"),prioridad:S.k5(["baja","media","alta","urgente"]).default("media"),fecha_limite:S.Yj().optional(),es_publica:S.zM().default(!0)}).partial().omit({case_id:!0}),S.Ik({respuesta:S.Yj().min(1,"La respuesta es requerida").max(2e3,"La respuesta no puede exceder 2000 caracteres"),archivo_adjunto:S.Yj().optional()}),S.Ik({case_id:S.Yj().uuid().optional(),estado:S.k5(["pendiente","en_revision","respondida","cerrada"]).optional(),tipo:S.k5(["documento","informacion","reunion","otro"]).optional(),prioridad:S.k5(["baja","media","alta","urgente"]).optional(),creador_id:S.Yj().uuid().optional(),es_publica:S.zM().optional(),fecha_desde:S.Yj().optional(),fecha_hasta:S.Yj().optional(),search:S.Yj().optional(),page:S.ai().min(1).default(1),limit:S.ai().min(1).max(100).default(20)});let _=[{value:"documento",label:"Documento",description:"Solicitud de documentos espec\xedficos"},{value:"informacion",label:"Informaci\xf3n",description:"Solicitud de informaci\xf3n general"},{value:"reunion",label:"Reuni\xf3n",description:"Solicitud de reuni\xf3n o cita"},{value:"otro",label:"Otro",description:"Otro tipo de solicitud"}],C=[{value:"pendiente",label:"Pendiente",color:"yellow"},{value:"en_revision",label:"En Revisi\xf3n",color:"blue"},{value:"respondida",label:"Respondida",color:"green"},{value:"cerrada",label:"Cerrada",color:"gray"}],A=[{value:"baja",label:"Baja",color:"gray"},{value:"media",label:"Media",color:"blue"},{value:"alta",label:"Alta",color:"orange"},{value:"urgente",label:"Urgente",color:"red"}];function R(e){let{caseId:a,canCreateRequests:i=!1,canRespondRequests:l=!1,showPrivateRequests:o=!0}=e,[x,y]=(0,s.useState)([]),[N,E]=(0,s.useState)(!0),[w,k]=(0,s.useState)(!1),[S,R]=(0,s.useState)(null),[z,L]=(0,s.useState)(!1),[D,q]=(0,s.useState)({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0}),[I,P]=(0,s.useState)({respuesta:"",archivo_adjunto:""}),{toast:Y}=(0,n.dj)(),Z=async()=>{E(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?y(e.requests):Y({title:"Error",description:e.error||"Error al cargar solicitudes",variant:"destructive"})}catch(e){console.error("Error loading requests:",e),Y({title:"Error",description:"Error inesperado al cargar solicitudes",variant:"destructive"})}finally{E(!1)}};(0,s.useEffect)(()=>{Z()},[a]);let $=async()=>{if(!D.titulo.trim()||!D.descripcion.trim())return void Y({title:"Error",description:"El t\xedtulo y la descripci\xf3n son requeridos",variant:"destructive"});k(!0);try{let e={case_id:a,titulo:D.titulo.trim(),descripcion:D.descripcion.trim(),tipo:D.tipo,prioridad:D.prioridad,fecha_limite:D.fecha_limite||void 0,es_publica:D.es_publica},i=await m(e);i.success?(Y({title:"Solicitud creada",description:"La solicitud ha sido creada exitosamente"}),q({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0}),L(!1),await Z()):Y({title:"Error",description:i.error||"Error al crear la solicitud",variant:"destructive"})}catch(e){console.error("Error creating request:",e),Y({title:"Error",description:"Error inesperado al crear la solicitud",variant:"destructive"})}finally{k(!1)}},U=async e=>{if(!I.respuesta.trim())return void Y({title:"Error",description:"La respuesta es requerida",variant:"destructive"});try{let a={respuesta:I.respuesta.trim(),archivo_adjunto:I.archivo_adjunto||void 0},i=await p(e,a);i.success?(Y({title:"Respuesta enviada",description:"La respuesta ha sido enviada exitosamente"}),P({respuesta:"",archivo_adjunto:""}),R(null),await Z()):Y({title:"Error",description:i.error||"Error al enviar la respuesta",variant:"destructive"})}catch(e){console.error("Error responding to request:",e),Y({title:"Error",description:"Error inesperado al enviar la respuesta",variant:"destructive"})}},W=async e=>{try{let a=await u(e);a.success?(Y({title:"Solicitud cerrada",description:"La solicitud ha sido cerrada"}),await Z()):Y({title:"Error",description:a.error||"Error al cerrar la solicitud",variant:"destructive"})}catch(e){console.error("Error closing request:",e),Y({title:"Error",description:"Error inesperado al cerrar la solicitud",variant:"destructive"})}},F=e=>{switch(e){case"respondida":return(0,r.jsx)(h.A,{className:"h-5 w-5 text-green-600"});case"en_revision":return(0,r.jsx)(v.A,{className:"h-5 w-5 text-blue-600"});case"cerrada":return(0,r.jsx)(j.A,{className:"h-5 w-5 text-gray-600"});default:return(0,r.jsx)(f.A,{className:"h-5 w-5 text-yellow-600"})}},T=e=>{let a=C.find(a=>a.value===e);return a?(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({yellow:"bg-yellow-100 text-yellow-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",gray:"bg-gray-100 text-gray-800"}[a.color]),children:a.label}):null},B=e=>{let a=A.find(a=>a.value===e);return a?(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({gray:"bg-gray-100 text-gray-800",blue:"bg-blue-100 text-blue-800",orange:"bg-orange-100 text-orange-800",red:"bg-red-100 text-red-800"}[a.color]),children:a.label}):null},V=e=>{let a=_.find(a=>a.value===e);return a?a.label:e},H=o?x:x.filter(e=>e.es_publica);return N?(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(f.A,{className:"h-5 w-5"}),"Solicitudes de Informaci\xf3n"]})}),(0,r.jsx)(c.Wu,{children:(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)(g.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(f.A,{className:"h-5 w-5"}),"Solicitudes de Informaci\xf3n (",H.length,")"]}),i&&(0,r.jsxs)(t.$,{size:"sm",onClick:()=>L(!z),disabled:w,children:[(0,r.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Nueva Solicitud"]})]})}),(0,r.jsxs)(c.Wu,{className:"space-y-4",children:[z&&i&&(0,r.jsx)(c.Zp,{className:"border-dashed",children:(0,r.jsx)(c.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"T\xedtulo *"}),(0,r.jsx)("input",{type:"text",value:D.titulo,onChange:e=>q({...D,titulo:e.target.value}),placeholder:"T\xedtulo de la solicitud",className:"form-input"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Descripci\xf3n *"}),(0,r.jsx)("textarea",{value:D.descripcion,onChange:e=>q({...D,descripcion:e.target.value}),placeholder:"Describe detalladamente lo que necesitas...",rows:4,className:"form-input"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tipo"}),(0,r.jsx)("select",{value:D.tipo,onChange:e=>q({...D,tipo:e.target.value}),className:"form-input",children:_.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prioridad"}),(0,r.jsx)("select",{value:D.prioridad,onChange:e=>q({...D,prioridad:e.target.value}),className:"form-input",children:A.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fecha l\xedmite (opcional)"}),(0,r.jsx)("input",{type:"date",value:D.fecha_limite,onChange:e=>q({...D,fecha_limite:e.target.value}),className:"form-input"})]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:D.es_publica,onChange:e=>q({...D,es_publica:e.target.checked})}),(0,r.jsx)("span",{className:"text-sm",children:"Visible para el abogado"})]})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(t.$,{variant:"outline",onClick:()=>{L(!1),q({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0})},disabled:w,children:"Cancelar"}),(0,r.jsx)(t.$,{onClick:$,disabled:w,children:w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Creando..."]}):"Crear Solicitud"})]})]})})}),(0,r.jsx)("div",{className:"space-y-3",children:H.map(e=>(0,r.jsx)(M,{request:e,canRespond:l,isResponding:S===e.id,response:I,onStartResponding:()=>R(e.id),onCancelResponding:()=>{R(null),P({respuesta:"",archivo_adjunto:""})},onResponseChange:P,onSendResponse:()=>U(e.id),onClose:()=>W(e.id),getStatusIcon:F,getStatusBadge:T,getPriorityBadge:B,getTypeIcon:V},e.id))}),0===H.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)(f.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,r.jsx)("p",{children:"No hay solicitudes de informaci\xf3n"}),i&&(0,r.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Solicitud" para crear la primera solicitud'})]})]})]})}function M(e){var a,i;let{request:s,canRespond:n,isResponding:o,response:d,onStartResponding:m,onCancelResponding:p,onResponseChange:u,onSendResponse:h,onClose:v,getStatusIcon:f,getStatusBadge:g,getPriorityBadge:b,getTypeIcon:S}=e,_=s.fecha_limite&&(0,x.m7)(s.fecha_limite)&&"respondida"!==s.estado&&"cerrada"!==s.estado;return(0,r.jsx)(c.Zp,{className:"border-l-4 ".concat(_?"border-l-red-500":"border-l-blue-500"),children:(0,r.jsxs)(c.Wu,{className:"pt-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[f(s.estado||"pendiente"),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:s.titulo}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[g(s.estado||"pendiente"),b(s.prioridad||"media"),(0,r.jsx)(l.E,{variant:"outline",children:S(s.tipo||"informacion")}),!s.es_publica&&(0,r.jsx)(l.E,{variant:"outline",children:"Privada"})]})]})]}),_&&(0,r.jsx)(y.A,{className:"h-5 w-5 text-red-500"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:s.descripcion}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(N.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:(null==(a=s.creador)?void 0:a.nombre)||"Usuario"})]}),(0,r.jsx)("span",{children:(0,x.fw)(s.created_at)}),s.fecha_limite&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(E.A,{className:"h-4 w-4"}),(0,r.jsxs)("span",{className:_?"text-red-600 font-medium":"",children:["L\xedmite: ",new Date(s.fecha_limite).toLocaleDateString("es-CL")]})]})]}),s.respuesta&&(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(w,{className:"h-4 w-4 text-blue-600"}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:["Respuesta de ",(null==(i=s.respondido_por_profile)?void 0:i.nombre)||"Abogado"]}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:s.respondido_at&&(0,x.fw)(s.respondido_at)})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700",children:s.respuesta}),s.archivo_adjunto&&(0,r.jsx)("a",{href:s.archivo_adjunto,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Ver archivo adjunto"})]}),o&&(0,r.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mb-3",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("textarea",{value:d.respuesta,onChange:e=>u({...d,respuesta:e.target.value}),placeholder:"Escribe tu respuesta...",rows:3,className:"form-input"}),(0,r.jsx)("input",{type:"url",value:d.archivo_adjunto,onChange:e=>u({...d,archivo_adjunto:e.target.value}),placeholder:"URL del archivo adjunto (opcional)",className:"form-input"}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(t.$,{size:"sm",variant:"outline",onClick:p,children:"Cancelar"}),(0,r.jsxs)(t.$,{size:"sm",onClick:h,children:[(0,r.jsx)(k.A,{className:"h-4 w-4 mr-1"}),"Enviar Respuesta"]})]})]})}),n&&"cerrada"!==s.estado&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["respondida"!==s.estado&&!o&&(0,r.jsxs)(t.$,{size:"sm",variant:"outline",onClick:m,children:[(0,r.jsx)(w,{className:"h-4 w-4 mr-1"}),"Responder"]}),"respondida"===s.estado&&(0,r.jsxs)(t.$,{size:"sm",variant:"outline",onClick:v,children:[(0,r.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Cerrar"]})]})]})})}},27416:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},35947:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},38417:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},43977:(e,a,i)=>{i.d(a,{S:()=>_});var r=i(11291),s=i(97451),t=i(90718),c=i(82596),l=i(9983),n=i(68630),o=i(59030);let d=(0,o.createServerReference)("401ae8f39de269ce4e02eb6353c902e2e4fa2c442b",o.callServer,void 0,o.findSourceMapURL,"getStages"),m=(0,o.createServerReference)("40a895831a1d42497e891995e8bb197427428e9822",o.callServer,void 0,o.findSourceMapURL,"createStage"),p=(0,o.createServerReference)("60dfcfc9f2200e619dc6aa201aa596300c289585fd",o.callServer,void 0,o.findSourceMapURL,"completeStage"),u=(0,o.createServerReference)("404a3ab7425ff7aa7340e79f8aac62f9e31f63a2cc",o.callServer,void 0,o.findSourceMapURL,"deleteStage");var x=i(93293),h=i(71428),v=i(96843);let j=(0,i(92608).A)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var f=i(23403),g=i(35947),b=i(90465),y=i(27416),N=i(62490),E=i(94724),w=i(66383);w.Ik({case_id:w.Yj().uuid("ID de caso inv\xe1lido"),etapa:w.Yj().min(1,"El nombre de la etapa es requerido").max(100,"El nombre no puede exceder 100 caracteres"),descripcion:w.Yj().optional(),fecha_programada:w.Yj().optional(),fecha_completada:w.Yj().optional(),estado:w.k5(["pendiente","en_proceso","completado"]).default("pendiente"),es_publica:w.zM().default(!0),orden:w.ai().int().positive("El orden debe ser un n\xfamero positivo"),responsable_id:w.Yj().uuid("ID de responsable inv\xe1lido").optional()}).partial().omit({case_id:!0}),w.Ik({fecha_completada:w.Yj().optional(),observaciones:w.Yj().optional()}),w.Ik({case_id:w.Yj().uuid().optional(),estado:w.k5(["pendiente","en_proceso","completado"]).optional(),responsable_id:w.Yj().uuid().optional(),es_publica:w.zM().optional(),fecha_desde:w.Yj().optional(),fecha_hasta:w.Yj().optional(),page:w.ai().min(1).default(1),limit:w.ai().min(1).max(100).default(20)});let k={Civil:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda con antecedentes y revisi\xf3n formal del tribunal.",diasEstimados:0},{etapa:"Notificaci\xf3n a la contraparte",descripcion:"Gestiones de notificaci\xf3n personal o por c\xe9dula al demandado.",diasEstimados:30},{etapa:"Contestaci\xf3n de la demanda",descripcion:"Plazo legal para que la contraparte conteste y proponga excepciones.",diasEstimados:20},{etapa:"R\xe9plicas y d\xfaplicas",descripcion:"Intercambio de escritos aclarando puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia preparatoria",descripcion:"Fijaci\xf3n de puntos de prueba y acuerdos probatorios.",diasEstimados:30},{etapa:"Periodo probatorio",descripcion:"Recepci\xf3n de declaraciones, oficios, peritajes y documental.",diasEstimados:45},{etapa:"Alegatos y vista de la causa",descripcion:"Audiencia de cierre donde las partes exponen sus argumentos finales.",diasEstimados:20},{etapa:"Sentencia de primera instancia",descripcion:"Redacci\xf3n y publicaci\xf3n del fallo por el tribunal.",diasEstimados:60},{etapa:"Recursos y cumplimiento",descripcion:"Interposici\xf3n de recursos o cumplimiento voluntario/forzado.",diasEstimados:30}],Comercial:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda y verificaci\xf3n formal.",diasEstimados:0},{etapa:"Notificaci\xf3n demandado",descripcion:"Gesti\xf3n de notificaci\xf3n a la contraparte y acreditaci\xf3n en autos.",diasEstimados:20},{etapa:"Contestaci\xf3n y reconvenci\xf3n",descripcion:"Respuesta del demandado y eventuales reconvenciones.",diasEstimados:20},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de hechos a probar y medios de prueba.",diasEstimados:25},{etapa:"Prueba y alegatos",descripcion:"Producci\xf3n de prueba documental, testimonial y alegatos finales.",diasEstimados:40},{etapa:"Sentencia",descripcion:"Decisi\xf3n del tribunal y notificaci\xf3n a las partes.",diasEstimados:45},{etapa:"Ejecuci\xf3n o recursos",descripcion:"Cumplimiento del fallo o tramitaci\xf3n de recursos.",diasEstimados:30}],Laboral:[{etapa:"Ingreso tutela o demanda laboral",descripcion:"Ingreso del escrito y asignaci\xf3n de audiencia preliminar.",diasEstimados:0},{etapa:"Citaciones y notificaci\xf3n empleador",descripcion:"Notificaci\xf3n de la demanda y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Intento de conciliaci\xf3n y fijaci\xf3n de puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Producci\xf3n de prueba y alegatos finales.",diasEstimados:20},{etapa:"Sentencia laboral",descripcion:"Pronunciamiento del tribunal y notificaci\xf3n a las partes.",diasEstimados:15},{etapa:"Cumplimiento / Recurso de nulidad",descripcion:"Tramitaci\xf3n de recursos o ejecuci\xf3n de la sentencia.",diasEstimados:20}],Familia:[{etapa:"Ingreso demanda o escrito inicial",descripcion:"Ingreso de medida de protecci\xf3n o demanda ante tribunal de familia.",diasEstimados:0},{etapa:"Notificaci\xf3n y citaci\xf3n a audiencia",descripcion:"Notificaci\xf3n a la contraparte y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de puntos controvertidos y acumulaci\xf3n de prueba.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Presentaci\xf3n de prueba, declaraciones y alegatos.",diasEstimados:20},{etapa:"Sentencia",descripcion:"Redacci\xf3n y comunicaci\xf3n del fallo.",diasEstimados:20},{etapa:"Cumplimiento y seguimiento",descripcion:"Ejecuci\xf3n de medidas decretadas y seguimiento del cumplimiento.",diasEstimados:25}]},S=[{value:"pendiente",label:"Pendiente",color:"gray"},{value:"en_proceso",label:"En Proceso",color:"blue"},{value:"completado",label:"Completado",color:"green"}];function _(e){let{caseId:a,caseMateria:i="Civil",canManageStages:o=!1,showPrivateStages:w=!0}=e,[_,C]=(0,s.useState)([]),[A,R]=(0,s.useState)(!0),[M,z]=(0,s.useState)(!1),[L,D]=(0,s.useState)(null),[q,I]=(0,s.useState)(!1),[P,Y]=(0,s.useState)({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1}),{toast:Z}=(0,n.dj)(),$=async()=>{R(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?C(e.stages):Z({title:"Error",description:e.error||"Error al cargar etapas",variant:"destructive"})}catch(e){console.error("Error loading stages:",e),Z({title:"Error",description:"Error inesperado al cargar etapas",variant:"destructive"})}finally{R(!1)}};(0,s.useEffect)(()=>{$()},[a]);let U=async()=>{if(!P.etapa.trim())return void Z({title:"Error",description:"El nombre de la etapa es requerido",variant:"destructive"});z(!0);try{let e=Math.max(..._.map(e=>e.orden||0),0),i={case_id:a,etapa:P.etapa.trim(),descripcion:P.descripcion.trim()||void 0,fecha_programada:P.fecha_programada||void 0,es_publica:P.es_publica,estado:"pendiente",orden:e+1},r=await m(i);r.success?(Z({title:"Etapa creada",description:"La etapa ha sido creada exitosamente"}),Y({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1}),I(!1),await $()):Z({title:"Error",description:r.error||"Error al crear la etapa",variant:"destructive"})}catch(e){console.error("Error creating stage:",e),Z({title:"Error",description:"Error inesperado al crear la etapa",variant:"destructive"})}finally{z(!1)}},W=async e=>{try{let a=await p(e);a.success?(Z({title:"Etapa completada",description:"La etapa ha sido marcada como completada"}),await $()):Z({title:"Error",description:a.error||"Error al completar la etapa",variant:"destructive"})}catch(e){console.error("Error completing stage:",e),Z({title:"Error",description:"Error inesperado al completar la etapa",variant:"destructive"})}},F=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta etapa?"))try{let a=await u(e);a.success?(Z({title:"Etapa eliminada",description:"La etapa ha sido eliminada exitosamente"}),await $()):Z({title:"Error",description:a.error||"Error al eliminar la etapa",variant:"destructive"})}catch(e){console.error("Error deleting stage:",e),Z({title:"Error",description:"Error inesperado al eliminar la etapa",variant:"destructive"})}},T=w?_:_.filter(e=>e.es_publica),B=function(e){if(!e)return k.Civil;let a=e.toLowerCase(),i=Object.keys(k).find(e=>e.toLowerCase()===a);return i?k[i]:k.Civil}(i);return A?(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(v.A,{className:"h-5 w-5"}),"Timeline Procesal"]})}),(0,r.jsx)(c.Wu,{children:(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)(f.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(v.A,{className:"h-5 w-5"}),"Timeline Procesal (",T.length,")"]}),o&&(0,r.jsxs)(t.$,{size:"sm",onClick:()=>I(!q),disabled:M,children:[(0,r.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Nueva Etapa"]})]})}),(0,r.jsxs)(c.Wu,{className:"space-y-6",children:[q&&o&&(0,r.jsx)(c.Zp,{className:"border-dashed",children:(0,r.jsx)(c.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Etapa"}),(0,r.jsxs)("select",{value:P.isCustom?"custom":P.etapa,onChange:e=>{let a=e.target.value;if("custom"===a)return void Y({...P,etapa:"",descripcion:"",isCustom:!0});let i=B.find(e=>e.etapa===a);Y({...P,etapa:a,descripcion:(null==i?void 0:i.descripcion)||P.descripcion,isCustom:!1})},className:"form-input",children:[(0,r.jsx)("option",{value:"",children:"Seleccionar etapa"}),B.map(e=>(0,r.jsxs)("option",{value:e.etapa,children:[e.etapa," ",e.diasEstimados?"(≈ ".concat(e.diasEstimados," d\xedas)"):""]},e.etapa)),(0,r.jsx)("option",{value:"custom",children:"Etapa personalizada..."})]}),P.isCustom&&(0,r.jsx)("input",{type:"text",placeholder:"Nombre de la etapa personalizada",value:P.etapa,onChange:e=>Y({...P,etapa:e.target.value}),className:"form-input mt-2"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Descripci\xf3n (opcional)"}),(0,r.jsx)("textarea",{value:P.descripcion,onChange:e=>Y({...P,descripcion:e.target.value}),placeholder:"Descripci\xf3n de la etapa...",rows:3,className:"form-input"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fecha programada (opcional)"}),(0,r.jsx)("input",{type:"date",value:P.fecha_programada,onChange:e=>Y({...P,fecha_programada:e.target.value}),className:"form-input"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Visibilidad"}),(0,r.jsxs)("select",{value:P.es_publica?"publica":"privada",onChange:e=>Y({...P,es_publica:"publica"===e.target.value}),className:"form-input",children:[(0,r.jsx)("option",{value:"publica",children:"P\xfablica (visible para cliente)"}),(0,r.jsx)("option",{value:"privada",children:"Privada (solo abogados)"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(t.$,{variant:"outline",onClick:()=>{I(!1),Y({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1})},disabled:M,children:"Cancelar"}),(0,r.jsx)(t.$,{onClick:U,disabled:M,children:M?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Creando..."]}):"Crear Etapa"})]})]})})}),(0,r.jsx)("div",{className:"relative",children:T.map((e,a)=>{let i=e.responsable;return(0,r.jsxs)("div",{className:"relative flex items-start space-x-4 pb-8",children:[a<T.length-1&&(0,r.jsx)("div",{className:"absolute left-2.5 top-8 w-0.5 h-full bg-gray-200"}),(0,r.jsx)("div",{className:"relative z-10 flex-shrink-0",children:(e=>{switch(e){case"completado":return(0,r.jsx)(h.A,{className:"h-5 w-5 text-green-600"});case"en_proceso":return(0,r.jsx)(v.A,{className:"h-5 w-5 text-blue-600"});default:return(0,r.jsx)(j,{className:"h-5 w-5 text-gray-400"})}})(e.estado||"pendiente")}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsx)(c.Zp,{className:"".concat("completado"===e.estado?"bg-green-50":""),children:(0,r.jsxs)(c.Wu,{className:"pt-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:e.etapa}),e.descripcion&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.descripcion})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(e=>{let a=S.find(a=>a.value===e);return a?(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({gray:"bg-gray-100 text-gray-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",red:"bg-red-100 text-red-800"}[a.color]),children:a.label}):null})(e.estado||"pendiente"),!e.es_publica&&(0,r.jsx)(l.E,{variant:"outline",children:"Privada"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[e.fecha_programada&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(b.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:(0,x.m7)(e.fecha_programada)&&"completado"!==e.estado?"text-red-600 font-medium":"",children:(0,x.Yq)(e.fecha_programada)})]}),(null==i?void 0:i.nombre)&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(y.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:i.nombre})]}),e.fecha_cumplida&&(0,r.jsxs)("div",{className:"text-green-600",children:["Completado ",(0,x.fw)(e.fecha_cumplida)]})]}),o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["completado"!==e.estado&&(0,r.jsxs)(t.$,{size:"sm",variant:"outline",onClick:()=>W(e.id),children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-1"}),"Completar"]}),(0,r.jsx)(t.$,{size:"sm",variant:"ghost",onClick:()=>D(e.id),children:(0,r.jsx)(N.A,{className:"h-4 w-4"})}),(0,r.jsx)(t.$,{size:"sm",variant:"ghost",onClick:()=>F(e.id),children:(0,r.jsx)(E.A,{className:"h-4 w-4"})})]})]})})})]},e.id)})}),0===T.length&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)(v.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,r.jsx)("p",{children:"No hay etapas definidas para este caso"}),o&&(0,r.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Etapa" para agregar la primera etapa'})]}),B.length>0&&(0,r.jsxs)("div",{className:"border-t pt-4 mt-2",children:[(0,r.jsxs)("h3",{className:"text-sm font-semibold text-gray-700",children:["Plan estimado de referencia para materia ",i||"Civil"]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Duraciones aproximadas en d\xedas a partir del inicio del caso."}),(0,r.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-gray-600",children:B.map((e,a)=>(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"mt-1 h-2 w-2 rounded-full bg-blue-500 flex-shrink-0"}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-800",children:e.etapa}),(0,r.jsxs)("span",{className:"block text-gray-500",children:[e.descripcion,e.diasEstimados?" \xb7 ≈ ".concat(e.diasEstimados," d\xedas"):""]})]})]},"".concat(e.etapa,"-").concat(a)))})]})]})]})}},49833:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},62490:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},64501:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]])},66656:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},69719:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]])},71428:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},77297:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},89064:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},89740:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},94724:(e,a,i)=>{i.d(a,{A:()=>r});let r=(0,i(92608).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},97301:(e,a,i)=>{i.d(a,{B:()=>v});var r=i(11291),s=i(97451),t=i(59030);let c=(0,t.createServerReference)("409f00fb61c08a8235ef06aa2d1964f04327fc3767",t.callServer,void 0,t.findSourceMapURL,"sendCaseMessage"),l=(0,t.createServerReference)("60983053161faf835386084ba34bfbbdf11cdcee2d",t.callServer,void 0,t.findSourceMapURL,"listCaseMessages");var n=i(90718),o=i(848),d=i(82596),m=i(9983),p=i(93293),u=i(23403),x=i(49833),h=i(68630);function v(e){let{caseId:a,initialMessages:i,currentProfileId:t,allowSend:v=!0}=e,[j,f]=(0,s.useState)(i),[g,b]=(0,s.useState)(""),[y,N]=(0,s.useTransition)(),[E,w]=(0,s.useState)(!1),{toast:k}=(0,h.dj)();(0,s.useEffect)(()=>{f(i)},[i,a]),(0,s.useEffect)(()=>{0===i.length&&_()},[a]);let S=(0,s.useMemo)(()=>j.slice().sort((e,a)=>new Date(e.created_at).getTime()-new Date(a.created_at).getTime()),[j]),_=async()=>{w(!0);try{let e=await l(a,{limit:100});f(e)}catch(a){var e;k({title:"Error al actualizar",description:null!=(e=null==a?void 0:a.message)?e:"No fue posible obtener los mensajes.",variant:"destructive"})}finally{w(!1)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-lexser-gray-900",children:"Mensajes del caso"}),(0,r.jsx)(n.$,{variant:"outline",size:"sm",onClick:_,disabled:E,children:E?(0,r.jsx)(u.A,{className:"h-4 w-4 animate-spin"}):"Actualizar"})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===S.length?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"A\xfan no hay mensajes para este caso."}):S.map(e=>{var a,i,s;let c=e.sender_profile_id===t;return(0,r.jsx)(d.Zp,{className:"border ".concat(c?"border-lexser-blue-200 bg-lexser-blue-50":"border-lexser-gray-100"),children:(0,r.jsxs)(d.Wu,{className:"p-4 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{children:[null!=(s=null==(a=e.sender)?void 0:a.nombre)?s:"Usuario",(null==(i=e.sender)?void 0:i.role)&&(0,r.jsx)(m.E,{variant:"outline",className:"ml-2 capitalize text-[10px]",children:e.sender.role})]}),(0,r.jsx)("span",{children:(0,p.r6)(e.created_at)})]}),(0,r.jsx)("p",{className:"text-sm text-lexser-gray-900 whitespace-pre-wrap",children:e.contenido}),e.attachment_url&&(0,r.jsx)("a",{href:e.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs font-medium text-lexser-blue-600 hover:text-lexser-blue-700",children:"Ver adjunto"})]})},e.id)})}),v&&(0,r.jsxs)("div",{className:"rounded-lg border border-lexser-gray-200 p-4 space-y-3",children:[(0,r.jsx)(o.T,{placeholder:"Escribe un mensaje para tu cliente o equipo...",value:g,onChange:e=>b(e.target.value),disabled:y,className:"min-h-[120px]"}),(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsxs)(n.$,{onClick:()=>{if(!g.trim())return void k({title:"Mensaje vac\xedo",description:"Escribe un mensaje antes de enviarlo.",variant:"destructive"});N(async()=>{try{let e=await c({caseId:a,contenido:g.trim()});f(a=>[...a,e]),b("")}catch(a){var e;k({title:"No se pudo enviar",description:null!=(e=null==a?void 0:a.message)?e:"Intenta nuevamente en unos minutos.",variant:"destructive"})}})},disabled:y,children:[y?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Enviar"]})})]})]})}}}]);