(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[233],{848:(e,a,i)=>{"use strict";i.d(a,{T:()=>l});var s=i(11291),t=i(97451),r=i(93293);let l=t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)("textarea",{ref:a,className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",i),...t})});l.displayName="Textarea"},40918:(e,a,i)=>{"use strict";i.d(a,{p:()=>l});var s=i(11291),t=i(97451),r=i(93293);let l=t.forwardRef((e,a)=>{let{className:i,type:t,...l}=e;return(0,s.jsx)("input",{type:t,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:a,...l})});l.displayName="Input"},57965:(e,a,i)=>{Promise.resolve().then(i.bind(i,77368))},68630:(e,a,i)=>{"use strict";i.d(a,{dj:()=>m});var s=i(97451);let t=0,r=new Map,l=e=>{if(r.has(e))return;let a=setTimeout(()=>{r.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,a)},o=[],n={toasts:[]};function c(e){n=((e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:i}=a;return i?l(i):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}})(n,e),o.forEach(e=>{e(n)})}function d(e){let{...a}=e,i=(t=(t+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:i});return c({type:"ADD_TOAST",toast:{...a,id:i,open:!0,onOpenChange:e=>{e||s()}}}),{id:i,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:i}})}}function m(){let[e,a]=s.useState(n);return s.useEffect(()=>(o.push(a),()=>{let e=o.indexOf(a);e>-1&&o.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>c(e?{type:"DISMISS_TOAST",toastId:e}:{type:"DISMISS_TOAST"})}}},73244:(e,a,i)=>{"use strict";i.d(a,{J:()=>c});var s=i(11291),t=i(97451),r=i(23838),l=i(11263),o=i(93293);let n=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)(r.b,{ref:a,className:(0,o.cn)(n(),i),...t})});c.displayName=r.b.displayName},77368:(e,a,i)=>{"use strict";i.d(a,{CaseForm:()=>Y});var s=i(11291),t=i(97451),r=i(95876),l=i(55167),o=i(32951),n=i(90718),c=i(40918),d=i(73244),m=i(82596),u=i(848),p=i(68630),x=i(59030);let h=(0,x.createServerReference)("600ae10f5197efbf0d781e426ef0c63665a14b6095",x.callServer,void 0,x.findSourceMapURL,"updateCase"),g=(0,x.createServerReference)("4005ee7254afb4611af8875139dc5a2557d207248f",x.callServer,void 0,x.findSourceMapURL,"createCase");var v=i(80754),b=i(66383),f=i(1931);let j=b.Yj().optional().refine(function(e){if("string"!=typeof e||0===e.trim().length)return!0;let a=e.replace(/[^0-9kK]/g,"");if(a.length<8||a.length>9)return!1;let i=a.slice(0,-1),s=a.slice(-1).toUpperCase(),t=0,r=2;for(let e=i.length-1;e>=0;e--)t+=parseInt(i[e],10)*r,r=7===r?2:r+1;let l=11-t%11;return s===(11===l?"0":10===l?"K":String(l))},{message:"RUT inv\xe1lido"}),_=b.Ik({numero_causa:b.Yj().optional(),caratulado:b.Yj().min(1,"El caratulado es requerido").max(500,"El caratulado no puede exceder 500 caracteres"),materia:b.Yj().min(1,"La materia es requerida").max(100,"La materia no puede exceder 100 caracteres"),tribunal:b.Yj().optional(),region:b.Yj().optional(),comuna:b.Yj().optional(),rut_cliente:j,nombre_cliente:b.Yj().min(1,"El nombre del cliente es requerido").max(200,"El nombre no puede exceder 200 caracteres"),contraparte:b.Yj().optional(),etapa_actual:b.Yj().default("Ingreso Demanda"),estado:b.k5(["activo","suspendido","archivado","terminado"]).default("activo"),fecha_inicio:b.Yj().optional(),abogado_responsable:b.Yj().uuid("ID de abogado inv\xe1lido").optional(),analista_id:b.Yj().uuid("ID de analista inv\xe1lido").optional(),cliente_principal_id:b.Yj().uuid("ID de cliente inv\xe1lido").optional(),workflow_state:b.k5(["preparacion","en_revision","activo","cerrado"]).default("preparacion"),prioridad:b.k5(["baja","media","alta","urgente"]).default("media"),valor_estimado:b.ai().positive("El valor debe ser positivo").optional(),observaciones:b.Yj().optional(),descripcion_inicial:b.Yj().min(20,"Describe el contexto del caso con al menos 20 caracteres").max(2e3,"La descripci\xf3n inicial no puede exceder 2000 caracteres"),objetivo_cliente:b.Yj().max(1e3,"El objetivo del cliente no puede exceder 1000 caracteres").optional(),documentacion_recibida:b.Yj().max(2e3,"El listado de documentaci\xf3n no puede exceder 2000 caracteres").optional(),validado_at:b.Yj().optional().nullable(),marcar_validado:b.zM().optional()});function N(e,a){e.marcar_validado&&(e.abogado_responsable||a.addIssue({code:f.eq.custom,message:"Debes asignar un abogado responsable para validar el caso",path:["abogado_responsable"]}),e.cliente_principal_id||a.addIssue({code:f.eq.custom,message:"Debes vincular al menos un cliente principal para validar el caso",path:["cliente_principal_id"]}))}let y=_.superRefine((e,a)=>{N(e,a)});_.partial().superRefine((e,a)=>{N(e,a)}),b.Ik({brief:b.Yj().min(10,"El brief debe tener al menos 10 caracteres").max(2e3,"El brief no puede exceder 2000 caracteres"),overrides:_.partial().optional()}),b.Ik({case_id:b.Yj().uuid("ID de caso inv\xe1lido"),abogado_id:b.Yj().uuid("ID de abogado inv\xe1lido")}),b.Ik({estado:b.k5(["activo","suspendido","archivado","terminado"]).optional(),prioridad:b.k5(["baja","media","alta","urgente"]).optional(),abogado_responsable:b.Yj().uuid().optional(),materia:b.Yj().optional(),fecha_inicio_desde:b.Yj().optional(),fecha_inicio_hasta:b.Yj().optional(),search:b.Yj().optional(),page:b.ai().min(1).default(1),limit:b.ai().min(1).max(100).default(10)}),b.Ik({abogado_id:b.Yj().uuid().optional(),fecha_desde:b.Yj().optional(),fecha_hasta:b.Yj().optional()});let w=[{value:"activo",label:"Activo"},{value:"suspendido",label:"Suspendido"},{value:"archivado",label:"Archivado"},{value:"terminado",label:"Terminado"}],C=[{value:"baja",label:"Baja"},{value:"media",label:"Media"},{value:"alta",label:"Alta"},{value:"urgente",label:"Urgente"}],S=[{value:"preparacion",label:"Preparaci\xf3n"},{value:"en_revision",label:"Revisi\xf3n interna"},{value:"activo",label:"Activo"},{value:"cerrado",label:"Cerrado"}],D=["Laboral","Civil","Comercial","Penal","Familia","Tributario","Administrativo","Constitucional","Ambiental","Propiedad Intelectual"],A=["Arica y Parinacota","Tarapac\xe1","Antofagasta","Atacama","Coquimbo","Valpara\xedso","Metropolitana","O'Higgins","Maule","\xd1uble","Biob\xedo","La Araucan\xeda","Los R\xedos","Los Lagos","Ays\xe9n","Magallanes"];var T=i(93293),I=i(37074),k=i(38417),F=i(34721),E=i(94724),M=i(23403),R=i(14314);function Y(e){var a,i,x;let{case:b,onCancel:f,lawyers:j,clients:_,currentProfile:N}=e,[Y,J]=(0,t.useState)(!1),O=(0,t.useRef)(null),[B,L]=(0,t.useState)([]),z=(0,r.useRouter)(),{toast:P}=(0,p.dj)(),q="abogado"===N.role?N.id:void 0,U=b?b.abogado_responsable_id||("string"==typeof b.abogado_responsable?b.abogado_responsable:null==(a=b.abogado_responsable)?void 0:a.id):void 0,$=b?{numero_causa:b.numero_causa||"",caratulado:b.caratulado,materia:b.materia||"",tribunal:b.tribunal||"",region:b.region||"",comuna:b.comuna||"",rut_cliente:b.rut_cliente||"",nombre_cliente:b.nombre_cliente,contraparte:b.contraparte||"",etapa_actual:b.etapa_actual||"Ingreso Demanda",estado:b.estado||"activo",fecha_inicio:b.fecha_inicio||new Date().toISOString().split("T")[0],abogado_responsable:U||q,cliente_principal_id:b.cliente_principal_id||void 0,prioridad:b.prioridad||"media",valor_estimado:b.valor_estimado||void 0,observaciones:b.observaciones||"",descripcion_inicial:b.descripcion_inicial||"",objetivo_cliente:b.objetivo_cliente||"",documentacion_recibida:b.documentacion_recibida||"",workflow_state:b.workflow_state||"preparacion",validado_at:b.validado_at||void 0,marcar_validado:!!b.validado_at}:{numero_causa:"",caratulado:"",materia:"",tribunal:"",region:"",comuna:"",rut_cliente:"",nombre_cliente:"",contraparte:"",etapa_actual:"Ingreso Demanda",estado:"activo",fecha_inicio:new Date().toISOString().split("T")[0],abogado_responsable:q,cliente_principal_id:void 0,prioridad:"media",valor_estimado:void 0,observaciones:"",descripcion_inicial:"",objetivo_cliente:"",documentacion_recibida:"",workflow_state:"preparacion",marcar_validado:!1},{register:K,control:V,handleSubmit:H,formState:{errors:X},setValue:Z,watch:Q}=(0,l.mN)({resolver:(0,o.u)(y),defaultValues:$}),W=Q("rut_cliente"),G=Q("marcar_validado"),ee=Q("workflow_state");(0,t.useEffect)(()=>{b||Z("workflow_state",G?"en_revision":"preparacion")},[G,b,Z]);let ea=()=>{L([]),O.current&&(O.current.value="")},ei=async e=>{J(!0);try{var a,i,s;let t,r=!!e.marcar_validado,l=new Date().toISOString(),o={...e,validado_at:r?null!=(i=null!=(a=e.validado_at)?a:null==b?void 0:b.validado_at)?i:l:null,workflow_state:b?e.workflow_state:r?"en_revision":"preparacion"};if((t=b?await h(b.id,o):await g(o)).success){P({title:b?"Caso actualizado":"Caso creado",description:b?"El caso ha sido actualizado exitosamente":"El nuevo caso ha sido creado exitosamente"});let e=null==(s=t.case)?void 0:s.id;if(!b&&B.length>0){if(e){let a=0,i=[];for(let s of B){let t=new FormData;t.append("case_id",e),t.append("file",s),t.append("nombre",s.name),t.append("visibilidad","privado");let r=await (0,v.X)(t);r.success?a+=1:i.push({fileName:s.name,...r.error?{message:r.error}:{}})}i.length>0?P({title:"Algunos documentos no se cargaron",description:i.map(e=>{var a;return"".concat(e.fileName,": ").concat(null!=(a=e.message)?a:"Error desconocido")}).join(", "),variant:"destructive"}):a>0&&P({title:"Documentos cargados",description:"Se cargaron ".concat(a," documento").concat(a>1?"s":""," correctamente.")})}else P({title:"Documentos no cargados",description:"No se pudo obtener el ID del caso reci\xe9n creado para adjuntar los documentos.",variant:"destructive"});ea()}z.push(e?"/cases/".concat(e):"/cases")}else P({title:"Error",description:t.error||"Ocurri\xf3 un error inesperado",variant:"destructive"})}catch(e){console.error("Error submitting form:",e),P({title:"Error",description:"Ocurri\xf3 un error inesperado",variant:"destructive"})}finally{J(!1)}};return(0,s.jsxs)(m.Zp,{className:"w-full max-w-4xl mx-auto",children:[(0,s.jsx)(m.aR,{children:(0,s.jsx)(m.ZB,{children:b?"Editar Caso":"Nuevo Caso"})}),(0,s.jsx)(m.Wu,{children:(0,s.jsxs)("form",{onSubmit:H(ei),className:"space-y-8",children:[(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Datos del caso"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Completa la informaci\xf3n general del expediente."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"numero_causa",children:"N\xfamero de Causa"}),(0,s.jsx)(c.p,{id:"numero_causa",placeholder:"C-1234-2024",...K("numero_causa"),disabled:Y}),X.numero_causa&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.numero_causa.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"materia",children:"Materia *"}),(0,s.jsxs)("select",{id:"materia",className:"form-input",...K("materia"),disabled:Y,children:[(0,s.jsx)("option",{value:"",children:"Seleccionar materia"}),D.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),X.materia&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.materia.message})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"caratulado",children:"Caratulado *"}),(0,s.jsx)(c.p,{id:"caratulado",placeholder:"P\xe9rez con Empresa ABC",...K("caratulado"),disabled:Y}),X.caratulado&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.caratulado.message})]})]}),(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Cliente y contraparte"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Identifica a las partes involucradas."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"nombre_cliente",children:"Nombre del Cliente *"}),(0,s.jsx)(c.p,{id:"nombre_cliente",placeholder:"Juan P\xe9rez",...K("nombre_cliente"),disabled:Y}),X.nombre_cliente&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.nombre_cliente.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"rut_cliente",children:"RUT del Cliente"}),(0,s.jsx)(c.p,{id:"rut_cliente",placeholder:"12.345.678-9",value:W||"",onChange:e=>{Z("rut_cliente",(0,T.nr)(e.target.value))},disabled:Y}),X.rut_cliente&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.rut_cliente.message})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"cliente_principal_id",children:"Cliente principal *"}),(0,s.jsx)(l.xI,{control:V,name:"cliente_principal_id",render:e=>{let{field:a}=e;return(0,s.jsxs)("select",{id:"cliente_principal_id",className:"form-input",value:a.value||"",onChange:e=>a.onChange(e.target.value||void 0),disabled:Y||0===_.length,children:[(0,s.jsx)("option",{value:"",children:"Selecciona un cliente"}),_.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nombre},e.id))]})}}),0===_.length&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"No hay clientes registrados. Puedes vincularlo m\xe1s tarde."}),X.cliente_principal_id&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.cliente_principal_id.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"contraparte",children:"Contraparte"}),(0,s.jsx)(c.p,{id:"contraparte",placeholder:"Empresa ABC S.A.",...K("contraparte"),disabled:Y}),X.contraparte&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.contraparte.message})]})]})]}),(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Detalle procesal"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Ingresa la informaci\xf3n requerida por Supabase para seguimiento."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"tribunal",children:"Tribunal"}),(0,s.jsx)(c.p,{id:"tribunal",placeholder:"1\xb0 Juzgado Civil de Santiago",...K("tribunal"),disabled:Y}),X.tribunal&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.tribunal.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"region",children:"Regi\xf3n"}),(0,s.jsxs)("select",{id:"region",className:"form-input",...K("region"),disabled:Y,children:[(0,s.jsx)("option",{value:"",children:"Seleccionar regi\xf3n"}),A.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),X.region&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.region.message})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"comuna",children:"Comuna"}),(0,s.jsx)(c.p,{id:"comuna",placeholder:"Santiago",...K("comuna"),disabled:Y}),X.comuna&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.comuna.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"fecha_inicio",children:"Fecha de Inicio"}),(0,s.jsx)(c.p,{id:"fecha_inicio",type:"date",...K("fecha_inicio"),disabled:Y}),X.fecha_inicio&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.fecha_inicio.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"valor_estimado",children:"Valor Estimado (CLP)"}),(0,s.jsx)(c.p,{id:"valor_estimado",type:"number",placeholder:"5000000",...K("valor_estimado",{valueAsNumber:!0}),disabled:Y}),X.valor_estimado&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.valor_estimado.message})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"estado",children:"Estado actual"}),(0,s.jsx)("select",{id:"estado",className:"form-input",...K("estado"),disabled:Y,children:w.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),X.estado&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.estado.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"prioridad",children:"Prioridad"}),(0,s.jsx)("select",{id:"prioridad",className:"form-input",...K("prioridad"),disabled:Y,children:C.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),X.prioridad&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.prioridad.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"etapa_actual",children:"Etapa actual"}),(0,s.jsx)(c.p,{id:"etapa_actual",placeholder:"Ingreso Demanda",...K("etapa_actual"),disabled:Y}),X.etapa_actual&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.etapa_actual.message})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"observaciones",children:"Observaciones"}),(0,s.jsx)(u.T,{id:"observaciones",rows:4,placeholder:"Observaciones adicionales, riesgos o comentarios internos.",...K("observaciones"),disabled:Y}),X.observaciones&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.observaciones.message})]})]}),(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Informaci\xf3n inicial"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Describe el contexto y los objetivos del cliente para una correcta asignaci\xf3n."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"descripcion_inicial",children:"Descripci\xf3n inicial *"}),(0,s.jsx)(u.T,{id:"descripcion_inicial",rows:5,placeholder:"Resumen del caso, antecedentes relevantes y hechos principales.",...K("descripcion_inicial"),disabled:Y}),X.descripcion_inicial&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.descripcion_inicial.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"objetivo_cliente",children:"Objetivo del cliente"}),(0,s.jsx)(u.T,{id:"objetivo_cliente",rows:4,placeholder:"\xbfQu\xe9 espera lograr el cliente con este procedimiento?",...K("objetivo_cliente"),disabled:Y}),X.objetivo_cliente&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.objetivo_cliente.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"documentacion_recibida",children:"Documentaci\xf3n recibida"}),(0,s.jsx)(u.T,{id:"documentacion_recibida",rows:4,placeholder:"Detalle la documentaci\xf3n entregada por el cliente (contratos, boletas, respaldos, etc.).",...K("documentacion_recibida"),disabled:Y}),X.documentacion_recibida&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.documentacion_recibida.message})]})]}),!b&&(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Documentos de respaldo"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Adjunta antecedentes relevantes para el equipo. Tama\xf1o m\xe1ximo de 20 MB por archivo."})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"case_documents",children:"Archivos"}),(0,s.jsxs)("div",{className:"space-y-3 rounded-md border border-dashed border-muted-foreground/40 p-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,s.jsx)(I.A,{className:"h-4 w-4 text-gray-500"}),(0,s.jsx)("span",{children:"Selecciona uno o m\xe1s archivos de hasta 20 MB cada uno."})]}),B.length>0&&(0,s.jsxs)(n.$,{type:"button",variant:"ghost",size:"sm",onClick:ea,disabled:Y,children:[(0,s.jsx)(k.A,{className:"mr-2 h-4 w-4"}),"Limpiar selecci\xf3n"]})]}),(0,s.jsx)(c.p,{id:"case_documents",type:"file",multiple:!0,onChange:e=>{var a;let i=Array.from(null!=(a=e.target.files)?a:[]);if(0===i.length)return;let s=i.filter(e=>e.size>0x1400000);s.length>0&&P({title:"Archivo demasiado grande",description:"Los siguientes archivos superan el l\xedmite de 20 MB: ".concat(s.map(e=>e.name).join(", ")),variant:"destructive"});let t=i.filter(e=>e.size<=0x1400000);t.length>0&&L(e=>{let a=new Set(e.map(e=>"".concat(e.name,"-").concat(e.size,"-").concat(e.lastModified))),i=t.filter(e=>{let i="".concat(e.name,"-").concat(e.size,"-").concat(e.lastModified);return!a.has(i)&&(a.add(i),!0)});return 0===i.length?e:[...e,...i]}),e.target.value=""},disabled:Y,ref:O}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Se aceptan archivos PDF, Word, im\xe1genes y texto. M\xe1ximo 20 MB por archivo."})]})]}),B.length>0&&(0,s.jsx)("ul",{className:"space-y-2",children:B.map((e,a)=>{var i;return(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(F.A,{className:"h-4 w-4 text-gray-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:(i=e.size)>=1048576?"".concat((i/1048576).toFixed(1)," MB"):i>=1024?"".concat((i/1024).toFixed(1)," KB"):"".concat(i," B")})]})]}),(0,s.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>{L(e=>e.filter((e,i)=>i!==a)),O.current&&(O.current.value="")},disabled:Y,"aria-label":"Quitar ".concat(e.name),children:(0,s.jsx)(E.A,{className:"h-4 w-4 text-gray-500"})})]},"".concat(e.name,"-").concat(e.lastModified,"-").concat(a))})})]})]}),(0,s.jsxs)("section",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Asignaci\xf3n y workflow"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Define qui\xe9n liderar\xe1 el caso y el estado interno del expediente."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"abogado_responsable",children:"Abogado responsable"}),(0,s.jsx)(l.xI,{control:V,name:"abogado_responsable",render:e=>{let{field:a}=e;return(0,s.jsxs)("select",{id:"abogado_responsable",className:"form-input",value:a.value||"",onChange:e=>a.onChange(e.target.value||void 0),disabled:Y||0===j.length,children:[(0,s.jsx)("option",{value:"",children:"Selecciona un abogado"}),j.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nombre},e.id))]})}}),0===j.length&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"No hay abogados disponibles. Un administrador debe registrarlos."}),X.abogado_responsable&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.abogado_responsable.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(d.J,{htmlFor:"workflow_state",children:"Estado interno"}),(0,s.jsx)("select",{id:"workflow_state",className:"form-input",...K("workflow_state"),disabled:Y,children:S.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),X.workflow_state&&(0,s.jsx)("p",{className:"text-sm text-red-600",children:X.workflow_state.message})]})]}),(0,s.jsxs)("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-4",children:[(0,s.jsxs)("label",{className:"flex items-start space-x-3",children:[(0,s.jsx)("input",{type:"checkbox",className:"mt-1 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",...K("marcar_validado"),disabled:Y}),(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Marcar caso como validado y listo para asignaci\xf3n"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Al validar el caso se notificar\xe1 al abogado responsable y al cliente principal, y se activar\xe1 el timeline autom\xe1tico."})]})]}),X.marcar_validado&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-2",children:X.marcar_validado.message}),G&&(0,s.jsxs)("div",{className:"mt-3 text-sm text-blue-700 bg-blue-50 border border-blue-200 rounded-md p-3",children:["Revisa que la informaci\xf3n est\xe9 completa. El workflow pasar\xe1 a ",(0,s.jsxs)("strong",{children:['"',null!=(x=null==(i=S.find(e=>e.value===ee))?void 0:i.label)?x:"Revisi\xf3n interna",'"']})," y el equipo recibir\xe1 un resumen del caso junto al timeline sugerido."]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4",children:[f&&(0,s.jsxs)(n.$,{type:"button",variant:"outline",onClick:f,disabled:Y,children:[(0,s.jsx)(k.A,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),(0,s.jsx)(n.$,{type:"submit",disabled:Y,children:Y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.A,{className:"w-4 h-4 mr-2 animate-spin"}),b?"Actualizando...":"Creando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.A,{className:"w-4 h-4 mr-2"}),b?"Actualizar Caso":"Crear Caso"]})})]})]})})]})}},80754:(e,a,i)=>{"use strict";i.d(a,{X:()=>t});var s=i(59030);let t=(0,s.createServerReference)("403ecf2e2e00e98f7491362cb1a475942512f602ba",s.callServer,void 0,s.findSourceMapURL,"uploadDocument")},82596:(e,a,i)=>{"use strict";i.d(a,{Wu:()=>c,ZB:()=>n,Zp:()=>l,aR:()=>o});var s=i(11291),t=i(97451),r=i(93293);let l=t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",i),...t})});l.displayName="Card";let o=t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",i),...t})});o.displayName="CardHeader";let n=t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)("h3",{ref:a,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",i),...t})});n.displayName="CardTitle",t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)("p",{ref:a,className:(0,r.cn)("text-sm text-muted-foreground",i),...t})}).displayName="CardDescription";let c=t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("p-6 pt-0",i),...t})});c.displayName="CardContent",t.forwardRef((e,a)=>{let{className:i,...t}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("flex items-center p-6 pt-0",i),...t})}).displayName="CardFooter"},90718:(e,a,i)=>{"use strict";i.d(a,{$:()=>c});var s=i(11291),t=i(97451),r=i(26809),l=i(11263),o=i(93293);let n=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=t.forwardRef((e,a)=>{let{className:i,variant:t,size:l,asChild:c=!1,...d}=e,m=c?r.DX:"button";return(0,s.jsx)(m,{className:(0,o.cn)(n({variant:t,size:l,className:i})),ref:a,...d})});c.displayName="Button"},93293:(e,a,i)=>{"use strict";i.d(a,{IM:()=>x,Yq:()=>c,cn:()=>o,fw:()=>u,kz:()=>d,m7:()=>h,nr:()=>p,qA:()=>v,r6:()=>m,v7:()=>g,vv:()=>n});var s=i(41111),t=i(98358);function r(e){return null!=e?e:""}function l(e){if(!e)return new Date("Invalid Date");let a="string"==typeof e?new Date(e):e;return isNaN(a.getTime())?new Date("Invalid Date"):a}function o(){for(var e=arguments.length,a=Array(e),i=0;i<e;i++)a[i]=arguments[i];return(0,t.QP)((0,s.$)(a))}function n(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(e)}function c(e){let a=l(null!=e?e:null);return isNaN(a.getTime())?"":new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"long",day:"numeric"}).format(a)}function d(e){let a=l(null!=e?e:null);return isNaN(a.getTime())?"":new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"2-digit",day:"2-digit"}).format(a)}function m(e){let a=l(null!=e?e:null);return isNaN(a.getTime())?"":new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(a)}function u(e){let a=l(null!=e?e:null);if(isNaN(a.getTime()))return"Fecha inv\xe1lida";let i=(Date.now()-a.getTime())/1e3;return i<60?"hace unos segundos":i<3600?"hace ".concat(Math.floor(i/60)," minutos"):i<86400?"hace ".concat(Math.floor(i/3600)," horas"):i<2592e3?"hace ".concat(Math.floor(i/86400)," d\xedas"):i<31104e3?"hace ".concat(Math.floor(i/2592e3)," meses"):"hace ".concat(Math.floor(i/31104e3)," a\xf1os")}function p(e){let a=r(e).replace(/[^0-9kK]/g,"");if(a.length<8)return a;let i=a.slice(0,-1),s=a.slice(-1),t=i.replace(/\B(?=(\d{3})+(?!\d))/g,".");return"".concat(t,"-").concat(s)}function x(e){let a=r(e).trim();return a?a.split(/\s+/).map(e=>e[0]).join("").toUpperCase().slice(0,2):""}function h(e){let a=l(null!=e?e:null);if(isNaN(a.getTime()))return!1;let i=new Date;i.setHours(0,0,0,0);let s=new Date(a);return s.setHours(0,0,0,0),s<i}function g(e){let a="number"!=typeof e||isNaN(e)?0:e;if(a<=0)return"0 Bytes";let i=["Bytes","KB","MB","GB"],s=Math.min(Math.floor(Math.log(a)/Math.log(1024)),i.length-1),t=(a/Math.pow(1024,s)).toFixed(2);return"".concat(t," ").concat(i[s])}function v(e){let a=r(e),i=0;for(let e=0;e<a.length;e++)i=a.charCodeAt(e)+((i<<5)-i);let s=(i%360+360)%360;return"hsl(".concat(s,", 70%, 50%)")}}},e=>{e.O(0,[936,577,625,193,55,358],()=>e(e.s=57965)),_N_E=e.O()}]);