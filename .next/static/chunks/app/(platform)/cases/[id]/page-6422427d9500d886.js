(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{25126:(e,a,s)=>{Promise.resolve().then(s.t.bind(s,64787,23)),Promise.resolve().then(s.bind(s,49501))},26181:(e,a,s)=>{"use strict";s.d(a,{A:()=>l});let l=(0,s(92608).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},49501:(e,a,s)=>{"use strict";s.d(a,{CaseDetailView:()=>q});var l=s(11291),t=s(97451),i=s(95876),r=s(82596),c=s(9983),n=s(90718),o=s(54997),d=s(14007),m=s(44722),x=s(25711),u=s(68668),h=s(93293),p=s(68630),g=s(59030);let b=(0,g.createServerReference)("6086c61dfb9231b4acbda11d41d490ece17f554ca3",g.callServer,void 0,g.findSourceMapURL,"authorizeCaseAdvance");var j=s(69719),N=s(96843),v=s(68671),f=s(64501),y=s(26181),_=s(92608);let w=(0,_.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var A=s(62490);let z=(0,_.A)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var C=s(27416),k=s(77297),S=s(89740),M=s(90465),E=s(87917),P=s(23403),R=s(77230);function q(e){var a,s,g,_,q,I,D,U,L,F,T,$;let{case:O,profile:V,messages:Z}=e,[H,B]=(0,t.useState)("overview"),G=(0,i.useRouter)(),{toast:W}=(0,p.dj)(),[Y,X]=(0,t.useState)(null!=(s=O.case_stages)?s:[]),[J,K]=(0,t.useState)({solicitado:null!=(g=O.alcance_cliente_solicitado)?g:0,autorizado:null!=(_=O.alcance_cliente_autorizado)?_:0}),Q=(0,t.useMemo)(()=>{let e=new Map;return Y.forEach(a=>{var s;let l=null!=(s=a.orden)?s:0;l>0&&!e.has(l)&&e.set(l,a.etapa)}),e},[Y]),ee=J.solicitado>0&&null!=(q=Q.get(J.solicitado))?q:null,ea=J.autorizado>0&&null!=(I=Q.get(J.autorizado))?I:null,[es,el]=(0,t.useState)(!1);(0,t.useEffect)(()=>{var e;X(null!=(e=O.case_stages)?e:[])},[O.case_stages]),(0,t.useEffect)(()=>{var e,a;K({solicitado:null!=(e=O.alcance_cliente_solicitado)?e:0,autorizado:null!=(a=O.alcance_cliente_autorizado)?a:0})},[O.alcance_cliente_solicitado,O.alcance_cliente_autorizado]);let et="admin_firma"===V.role||"abogado"===V.role&&(null==(a=O.abogado_responsable)?void 0:a.id)===V.id,ei="cliente"!==V.role,er="cliente"!==V.role,ec="cliente"!==V.role,en=e=>null==e||Number.isNaN(e)?"—":"".concat(new Intl.NumberFormat("es-CL",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)," UF"),eo=null!=(D=O.honorario_total_uf)?D:null,ed=null!=(U=O.honorario_pagado_uf)?U:0,em=null!==eo?Math.max(eo-ed,0):null,ex=async e=>{if(e&&!(e<=0)){el(!0);try{var a,s,l;let t=await b(O.id,e);if(t.success){let l=null!=(a=t.authorizedOrder)?a:e;K(e=>({...e,autorizado:l})),W({title:"Avance autorizado",description:"Se autoriz\xf3 avanzar hasta ".concat(null!=(s=Q.get(l))?s:"la etapa ".concat(l),".")}),G.refresh()}else W({title:"No se pudo autorizar",description:null!=(l=t.error)?l:"Intenta nuevamente en unos minutos.",variant:"destructive"})}catch(e){console.error("Error authorizing advance",e),W({title:"Error inesperado",description:"No fue posible autorizar el avance solicitado.",variant:"destructive"})}finally{el(!1)}}},eu=[{id:"overview",label:"Resumen",icon:j.A},{id:"timeline",label:"Timeline",icon:N.A},{id:"documents",label:"Documentos",icon:v.A},{id:"notes",label:"Notas",icon:f.A},{id:"messages",label:"Mensajes",icon:f.A},{id:"requests",label:"Solicitudes",icon:f.A},...et?[{id:"clients",label:"Clientes",icon:y.A}]:[]];return(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>G.back(),children:[(0,l.jsx)(w,{className:"h-4 w-4 mr-2"}),"Volver"]}),(0,l.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,l.jsx)(j.A,{className:"h-6 w-6 text-blue-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Detalle del Caso"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"Xel Chile"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[et&&(0,l.jsxs)(n.$,{size:"sm",variant:"outline",children:[(0,l.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Editar Caso"]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-900",children:V.nombre}),(0,l.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:V.role.replace("_"," ")})]}),(0,l.jsx)("div",{className:"h-8 w-8 rounded-full flex items-center justify-center text-white font-medium text-sm",style:{backgroundColor:(0,h.qA)(V.nombre)},children:(0,h.IM)(V.nombre)})]})]})})}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsx)(r.Zp,{className:"mb-8",children:(0,l.jsxs)(r.Wu,{className:"pt-6",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:O.caratulado}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mb-4",children:[O.numero_causa&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(j.A,{className:"h-4 w-4 mr-1"}),"Causa: ",O.numero_causa]}),O.materia&&(0,l.jsxs)("span",{children:["Materia: ",O.materia]}),O.tribunal&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(z,{className:"h-4 w-4 mr-1"}),O.tribunal]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(T=O.estado||"activo",(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({activo:"bg-green-100 text-green-800",suspendido:"bg-yellow-100 text-yellow-800",archivado:"bg-gray-100 text-gray-800",terminado:"bg-blue-100 text-blue-800"}[T]||"bg-gray-100 text-gray-800"),children:T.charAt(0).toUpperCase()+T.slice(1)})),O.prioridad&&($=O.prioridad,(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({baja:"bg-gray-100 text-gray-800",media:"bg-blue-100 text-blue-800",alta:"bg-orange-100 text-orange-800",urgente:"bg-red-100 text-red-800"}[$]||"bg-gray-100 text-gray-800"),children:$.charAt(0).toUpperCase()+$.slice(1)})),O.etapa_actual&&(0,l.jsx)(c.E,{variant:"outline",children:O.etapa_actual})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[O.abogado_responsable&&(0,l.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-blue-900 mb-2 flex items-center",children:[(0,l.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Abogado Responsable"]}),(0,l.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,l.jsx)("p",{className:"font-medium text-blue-800",children:O.abogado_responsable.nombre}),O.abogado_responsable.telefono&&(0,l.jsxs)("p",{className:"flex items-center text-blue-700",children:[(0,l.jsx)(k.A,{className:"h-3 w-3 mr-1"}),O.abogado_responsable.telefono]}),O.abogado_responsable.email&&(0,l.jsxs)("p",{className:"flex items-center text-blue-700",children:[(0,l.jsx)(S.A,{className:"h-3 w-3 mr-1"}),O.abogado_responsable.email]})]})]}),O.nombre_cliente&&(0,l.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-green-900 mb-2 flex items-center",children:[(0,l.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Cliente"]}),(0,l.jsx)("p",{className:"text-sm font-medium text-green-800",children:O.nombre_cliente}),O.rut_cliente&&(0,l.jsxs)("p",{className:"text-sm text-green-700",children:["RUT: ",O.rut_cliente]})]}),(0,l.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-purple-900 mb-2 flex items-center",children:[(0,l.jsx)(M.A,{className:"h-4 w-4 mr-2"}),"Fechas"]}),(0,l.jsxs)("div",{className:"space-y-1 text-sm text-purple-700",children:[O.fecha_inicio&&(0,l.jsxs)("p",{children:["Inicio: ",(0,h.Yq)(O.fecha_inicio)]}),O.fecha_termino&&(0,l.jsxs)("p",{children:["T\xe9rmino: ",(0,h.Yq)(O.fecha_termino)]})]})]}),O.valor_estimado&&(0,l.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-yellow-900 mb-2 flex items-center",children:[(0,l.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Valor Estimado"]}),(0,l.jsx)("p",{className:"text-lg font-bold text-yellow-800",children:(0,h.vv)(O.valor_estimado)})]}),(J.solicitado>0||J.autorizado>0)&&(0,l.jsxs)("div",{className:"bg-sky-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-sky-900 mb-2 flex items-center",children:[(0,l.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Alcance del cliente"]}),(0,l.jsx)("p",{className:"text-sm text-sky-700",children:J.solicitado>0?"Solicitado: ".concat(null!=ee?ee:"Etapa ".concat(J.solicitado)):"Sin solicitudes vigentes"}),(0,l.jsx)("p",{className:"text-sm text-sky-700",children:J.autorizado>0?"Autorizado: ".concat(null!=ea?ea:"Etapa ".concat(J.autorizado)):"Aprobaci\xf3n pendiente"}),("admin_firma"===V.role||"analista"===V.role)&&J.solicitado>J.autorizado&&(0,l.jsx)(n.$,{size:"sm",className:"mt-3 inline-flex items-center gap-2 rounded-full bg-sky-600 text-white hover:bg-sky-700",onClick:()=>ex(J.solicitado),disabled:es,children:es?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(P.A,{className:"h-4 w-4 animate-spin"}),"Autorizando…"]}):"Autorizar solicitud"})]}),(null!==eo||O.tarifa_referencia)&&(0,l.jsxs)("div",{className:"bg-indigo-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-indigo-900 mb-2 flex items-center",children:[(0,l.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Honorarios"]}),(0,l.jsxs)("div",{className:"space-y-1 text-sm text-indigo-800",children:[O.modalidad_cobro&&(0,l.jsx)("p",{className:"uppercase text-xs tracking-wide text-indigo-600",children:O.modalidad_cobro}),null!==eo&&(0,l.jsxs)("p",{className:"font-semibold",children:["Total: ",en(eo)]}),null!==eo&&(0,l.jsxs)("p",{children:["Pagado: ",en(ed)]}),null!==em&&(0,l.jsxs)("p",{children:["Pendiente: ",en(em)]}),O.honorario_variable_porcentaje&&(0,l.jsxs)("p",{children:["Variable: ",O.honorario_variable_porcentaje,"%",O.honorario_variable_base?" (".concat(O.honorario_variable_base,")"):""]}),O.tarifa_referencia&&(0,l.jsxs)("p",{className:"text-xs text-indigo-600",children:["Tarifa: ",O.tarifa_referencia]}),O.honorario_notas&&(0,l.jsx)("p",{className:"text-xs text-indigo-700 whitespace-pre-wrap",children:O.honorario_notas})]})]})]}),O.contraparte&&(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Contraparte"}),(0,l.jsx)("p",{className:"text-gray-700",children:O.contraparte})]}),O.observaciones&&(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Observaciones"}),(0,l.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:O.observaciones})]})]})}),(0,l.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,l.jsx)("nav",{className:"-mb-px flex space-x-8",children:eu.map(e=>{let a=e.icon;return(0,l.jsxs)("button",{onClick:()=>B(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ".concat(H===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,l.jsx)(a,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:e.label})]},e.id)})})}),(0,l.jsxs)("div",{children:["overview"===H&&(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsx)(m.S,{caseId:O.id,caseMateria:null!=(L=O.materia)?L:"General",canManageStages:et,showPrivateStages:ec,clientContext:{role:V.role,alcanceAutorizado:J.autorizado,alcanceSolicitado:J.solicitado},onClientProgressChange:e=>K(a=>{var s,l;return{solicitado:null!=(s=e.solicitado)?s:a.solicitado,autorizado:null!=(l=e.autorizado)?l:a.autorizado}}),onStagesLoaded:X})}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(d.$,{caseId:O.id,canUpload:et,canEdit:et,canDelete:et,showPrivateDocuments:ec}),(0,l.jsx)(x.L,{caseId:O.id,canCreateRequests:!0,canRespondRequests:er,showPrivateRequests:ec})]})]}),"timeline"===H&&(0,l.jsx)(m.S,{caseId:O.id,caseMateria:null!=(F=O.materia)?F:"General",canManageStages:et,showPrivateStages:ec,clientContext:{role:V.role,alcanceAutorizado:J.autorizado,alcanceSolicitado:J.solicitado},onClientProgressChange:e=>K(a=>{var s,l;return{solicitado:null!=(s=e.solicitado)?s:a.solicitado,autorizado:null!=(l=e.autorizado)?l:a.autorizado}}),onStagesLoaded:X}),"documents"===H&&(0,l.jsx)(d.$,{caseId:O.id,canUpload:et,canEdit:et,canDelete:et,showPrivateDocuments:ec}),"notes"===H&&(0,l.jsx)(o._,{caseId:O.id,canCreateNotes:ei,canEditNotes:ei,showPrivateNotes:ec}),"messages"===H&&(0,l.jsx)(u.B,{caseId:O.id,initialMessages:Z,currentProfileId:V.id,allowSend:"cliente"!==V.role}),"requests"===H&&(0,l.jsx)(x.L,{caseId:O.id,canCreateRequests:!0,canRespondRequests:er,showPrivateRequests:ec}),"clients"===H&&et&&(0,l.jsx)("div",{className:"space-y-6",children:O.clients&&O.clients.length>0&&(0,l.jsxs)(r.Zp,{children:[(0,l.jsx)(r.aR,{children:(0,l.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(y.A,{className:"h-5 w-5"}),"Clientes Asociados (",O.clients.length,")"]})}),(0,l.jsx)(r.Wu,{children:(0,l.jsx)("div",{className:"space-y-3",children:O.clients.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"h-10 w-10 rounded-full flex items-center justify-center text-white font-medium",style:{backgroundColor:(0,h.qA)(e.nombre)},children:(0,h.IM)(e.nombre)}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900",children:e.nombre}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(S.A,{className:"h-3 w-3 mr-1"}),e.email]}),e.telefono&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(k.A,{className:"h-3 w-3 mr-1"}),e.telefono]})]})]})]}),(0,l.jsx)(c.E,{variant:"outline",children:"Cliente"})]},e.id))})})]})})]})]})]})}}},e=>{e.O(0,[936,787,577,4,927,193,55,358],()=>e(e.s=25126)),_N_E=e.O()}]);