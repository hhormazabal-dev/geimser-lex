(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{23838:(e,a,s)=>{"use strict";s.d(a,{b:()=>n});var l=s(97451),t=s(31010),r=s(11291),i=l.forwardRef((e,a)=>(0,r.jsx)(t.sG.label,{...e,ref:a,onMouseDown:a=>{var s;a.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));i.displayName="Label";var n=i},25126:(e,a,s)=>{Promise.resolve().then(s.t.bind(s,64787,23)),Promise.resolve().then(s.bind(s,53439))},31010:(e,a,s)=>{"use strict";s.d(a,{hO:()=>o,sG:()=>n});var l=s(97451),t=s(8970),r=s(26809),i=s(11291),n=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,a)=>{let s=(0,r.TL)(`Primitive.${a}`),t=l.forwardRef((e,l)=>{let{asChild:t,...r}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(t?s:a,{...r,ref:l})});return t.displayName=`Primitive.${a}`,{...e,[a]:t}},{});function o(e,a){e&&t.flushSync(()=>e.dispatchEvent(a))}},40918:(e,a,s)=>{"use strict";s.d(a,{p:()=>i});var l=s(11291),t=s(97451),r=s(93293);let i=t.forwardRef((e,a)=>{let{className:s,type:t,...i}=e;return(0,l.jsx)("input",{type:t,className:(0,r.cn)("flex h-11 w-full rounded-2xl border border-white/30 bg-white/70 px-4 text-sm text-foreground/80 shadow-inner ring-offset-transparent transition-all placeholder:text-foreground/40 focus-visible:border-primary focus-visible:bg-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30 disabled:cursor-not-allowed disabled:opacity-60",s),ref:a,...i})});i.displayName="Input"},53439:(e,a,s)=>{"use strict";s.d(a,{CaseDetailView:()=>$});var l=s(11291),t=s(97451),r=s(95876),i=s(82596),n=s(9983),o=s(90718),c=s(40918),d=s(73244),m=s(54997),u=s(14007),x=s(44722),p=s(25711),b=s(68668),h=s(93293),g=s(68630),f=s(59030);let v=(0,f.createServerReference)("00127df0956e3268c8ee6c6b96b1f1e3b422410771",f.callServer,void 0,f.findSourceMapURL,"listAvailableLawyers"),j=(0,f.createServerReference)("406a9d70a736b5d8693dccaf0ba8bb918d3389df1f",f.callServer,void 0,f.findSourceMapURL,"assignLawyer"),N=(0,f.createServerReference)("6086c61dfb9231b4acbda11d41d490ece17f554ca3",f.callServer,void 0,f.findSourceMapURL,"authorizeCaseAdvance"),y=(0,f.createServerReference)("40b228871e08ee0563c69a2ce1a6851a34ef104dd6",f.callServer,void 0,f.findSourceMapURL,"createCaseCounterparty"),w=(0,f.createServerReference)("403ddfd9f5f8e8c23ba6b0bfb8928b426a8816361a",f.callServer,void 0,f.findSourceMapURL,"deleteCaseCounterparty");var _=s(69719),A=s(96843),S=s(68671),C=s(64501),z=s(26181),R=s(92608);let E=(0,R.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var k=s(62490);let M=(0,R.A)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var I=s(27416),P=s(77297),q=s(89740),D=s(23403),L=s(90465),U=s(87917),F=s(77230),T=s(94724);function $(e){var a,s,f,R,$,Z,G,J,O,V,B,W,Y,H,X,K,Q,ee,ea,es,el,et,er;let{case:ei,profile:en,messages:eo}=e,[ec,ed]=(0,t.useState)("overview"),em=(0,r.useRouter)(),{toast:eu}=(0,g.dj)(),[ex,ep]=(0,t.useState)(null!=(G=ei.case_stages)?G:[]),[eb,eh]=(0,t.useState)({solicitado:null!=(J=ei.alcance_cliente_solicitado)?J:0,autorizado:null!=(O=ei.alcance_cliente_autorizado)?O:0}),[eg,ef]=(0,t.useState)(null!=(V=ei.counterparties)?V:[]),[ev,ej]=(0,t.useState)({nombre:"",rut:"",tipo:"demandado"}),[eN,ey]=(0,t.useTransition)(),[ew,e_]=(0,t.useState)(null),[eA,eS]=(0,t.useState)(ei.abogado_responsable?{id:ei.abogado_responsable.id,nombre:ei.abogado_responsable.nombre,telefono:null!=(B=ei.abogado_responsable.telefono)?B:null,email:null!=(W=ei.abogado_responsable.email)?W:null}:null),[eC,ez]=(0,t.useState)(ei.abogado_responsable?[{id:ei.abogado_responsable.id,nombre:ei.abogado_responsable.nombre,email:null!=(Y=ei.abogado_responsable.email)?Y:null,telefono:null!=(H=ei.abogado_responsable.telefono)?H:null}]:[]),[eR,eE]=(0,t.useState)(null!=(X=null==(a=ei.abogado_responsable)?void 0:a.id)?X:""),[ek,eM]=(0,t.useState)(!1),[eI,eP]=(0,t.useState)(!1),eq=(0,t.useMemo)(()=>{let e=new Map;return ex.forEach(a=>{var s;let l=null!=(s=a.orden)?s:0;l>0&&!e.has(l)&&e.set(l,a.etapa)}),e},[ex]),eD=eb.solicitado>0&&null!=(K=eq.get(eb.solicitado))?K:null,eL=eb.autorizado>0&&null!=(Q=eq.get(eb.autorizado))?Q:null,[eU,eF]=(0,t.useState)(!1);(0,t.useEffect)(()=>{var e;ep(null!=(e=ei.case_stages)?e:[])},[ei.case_stages]),(0,t.useEffect)(()=>{var e,a;eh({solicitado:null!=(e=ei.alcance_cliente_solicitado)?e:0,autorizado:null!=(a=ei.alcance_cliente_autorizado)?a:0})},[ei.alcance_cliente_solicitado,ei.alcance_cliente_autorizado]),(0,t.useEffect)(()=>{var e;ef(null!=(e=ei.counterparties)?e:[])},[ei.counterparties]),(0,t.useEffect)(()=>{if(ei.abogado_responsable){var e,a;eS({id:ei.abogado_responsable.id,nombre:ei.abogado_responsable.nombre,telefono:null!=(e=ei.abogado_responsable.telefono)?e:null,email:null!=(a=ei.abogado_responsable.email)?a:null}),eE(ei.abogado_responsable.id)}else eS(null),eE("")},[null==(s=ei.abogado_responsable)?void 0:s.id,null==(f=ei.abogado_responsable)?void 0:f.nombre,null==(R=ei.abogado_responsable)?void 0:R.telefono,null==($=ei.abogado_responsable)?void 0:$.email]);let eT="admin_firma"===en.role||"abogado"===en.role&&(null==(Z=ei.abogado_responsable)?void 0:Z.id)===en.id,e$="admin_firma"===en.role||"analista"===en.role,eZ="cliente"!==en.role,eG="cliente"!==en.role,eJ="cliente"!==en.role,eO=(0,t.useCallback)(async e=>{if(e$){eM(!0);try{var a,s,l,t,r;let i=await v();if(i.success){let r=null!=(s=(null!=(a=i.lawyers)?a:[]).map(e=>{var a,s,l;return{id:e.id,nombre:null!=(a=e.nombre)?a:"Sin nombre",email:null!=(s=e.email)?s:null,telefono:null!=(l=e.telefono)?l:null}}))?s:[],n=null!=e?e:eA?{id:eA.id,nombre:eA.nombre,email:null!=(l=eA.email)?l:null,telefono:null!=(t=eA.telefono)?t:null}:null;n&&!r.some(e=>e.id===n.id)&&(r=[...r,n]),r.sort((e,a)=>e.nombre.localeCompare(a.nombre,"es")),ez(r)}else eu({title:"No se pudo cargar el equipo",description:null!=(r=i.error)?r:"Intenta nuevamente en unos minutos.",variant:"destructive"})}catch(e){console.error("Error fetching lawyers:",e),eu({title:"Error",description:"No pudimos obtener la lista de abogados disponibles.",variant:"destructive"})}finally{eM(!1)}}},[e$,eA,eu]);(0,t.useEffect)(()=>{eO().catch(()=>{})},[eO]),(0,t.useEffect)(()=>{if(!eA&&eR){let e=eC.find(e=>e.id===eR);e&&eS(e)}},[eC,eA,eR]),(0,t.useEffect)(()=>{var e;eE(null!=(e=null==eA?void 0:eA.id)?e:"")},[null==eA?void 0:eA.id]);let eV=e=>null==e||Number.isNaN(e)?"â€”":"".concat(new Intl.NumberFormat("es-CL",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)," UF"),eB=async e=>{if(e.preventDefault(),e$){if(!eR)return void eu({title:"Selecciona un abogado",description:"Debes elegir un abogado para reasignar el caso.",variant:"destructive"});if(eR===(null==eA?void 0:eA.id))return void eu({title:"Sin cambios",description:"El caso ya est\xe1 asignado a ese abogado."});eP(!0);try{var a,s,l,t,r,i;let e=await j({case_id:ei.id,abogado_id:eR});if(e.success){let i=null!=(s=null!=(a=e.lawyer)?a:eC.find(e=>e.id===eR))?s:null;if(i){let e={id:i.id,nombre:null!=(l=i.nombre)?l:"Sin nombre",email:null!=(t=i.email)?t:null,telefono:null!=(r=i.telefono)?r:null};eS(e),await eO(e)}else eS(null),await eO();eu({title:"Caso reasignado",description:"Actualizamos el abogado responsable sin afectar el historial del caso."})}else eu({title:"No se pudo reasignar",description:null!=(i=e.error)?i:"Intenta nuevamente en unos minutos.",variant:"destructive"})}catch(e){console.error("Error reassigning lawyer:",e),eu({title:"Error inesperado",description:"No pudimos reasignar este caso, intenta nuevamente.",variant:"destructive"})}finally{eP(!1)}}},eW=null!=(ee=ei.honorario_total_uf)?ee:null,eY=null!=(ea=ei.honorario_pagado_uf)?ea:0,eH=null!==eW?Math.max(eW-eY,0):null,eX=async e=>{if(e&&!(e<=0)){eF(!0);try{var a,s,l;let t=await N(ei.id,e);if(t.success){let l=null!=(a=t.authorizedOrder)?a:e;eh(e=>({...e,autorizado:l})),eu({title:"Avance autorizado",description:"Se autoriz\xf3 avanzar hasta ".concat(null!=(s=eq.get(l))?s:"la etapa ".concat(l),".")}),em.refresh()}else eu({title:"No se pudo autorizar",description:null!=(l=t.error)?l:"Intenta nuevamente en unos minutos.",variant:"destructive"})}catch(e){console.error("Error authorizing advance",e),eu({title:"Error inesperado",description:"No fue posible autorizar el avance solicitado.",variant:"destructive"})}finally{eF(!1)}}},eK=(e,a)=>{ej(s=>({...s,[e]:a}))},eQ=async e=>{e.preventDefault(),ey(async()=>{let e=await y({caseId:ei.id,nombre:ev.nombre,rut:ev.rut||void 0,tipo:ev.tipo});e.success?(ef(a=>[e.counterparty,...a]),ej({nombre:"",rut:"",tipo:"demandado"}),eu({title:"Contraparte agregada",description:"Registramos la contraparte en el expediente."})):eu({title:"No se pudo agregar la contraparte",description:e.error,variant:"destructive"})})},e0=async e=>{e_(e);try{let a=await w({id:e});a.success?(ef(a=>a.filter(a=>a.id!==e)),eu({title:"Contraparte eliminada"})):eu({title:"No se pudo eliminar la contraparte",description:a.error,variant:"destructive"})}finally{e_(null)}},e1=[{id:"overview",label:"Resumen",icon:_.A},{id:"timeline",label:"Timeline",icon:A.A},{id:"documents",label:"Documentos",icon:S.A},{id:"notes",label:"Notas",icon:C.A},{id:"messages",label:"Mensajes",icon:C.A},{id:"requests",label:"Solicitudes",icon:C.A},...eT?[{id:"clients",label:"Clientes",icon:z.A}]:[]];return(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)(o.$,{variant:"ghost",size:"sm",onClick:()=>em.back(),children:[(0,l.jsx)(E,{className:"h-4 w-4 mr-2"}),"Volver"]}),(0,l.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,l.jsx)(_.A,{className:"h-6 w-6 text-blue-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Detalle del Caso"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"Xel Chile"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[eT&&(0,l.jsxs)(o.$,{size:"sm",variant:"outline",children:[(0,l.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Editar Caso"]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-900",children:en.nombre}),(0,l.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:en.role.replace("_"," ")})]}),(0,l.jsx)("div",{className:"h-8 w-8 rounded-full flex items-center justify-center text-white font-medium text-sm",style:{backgroundColor:(0,h.qA)(en.nombre)},children:(0,h.IM)(en.nombre)})]})]})})}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsx)(i.Zp,{className:"mb-8",children:(0,l.jsxs)(i.Wu,{className:"pt-6",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:ei.caratulado}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 mb-4",children:[ei.numero_causa&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(_.A,{className:"h-4 w-4 mr-1"}),"Causa: ",ei.numero_causa]}),ei.materia&&(0,l.jsxs)("span",{children:["Materia: ",ei.materia]}),ei.tribunal&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(M,{className:"h-4 w-4 mr-1"}),ei.tribunal]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(et=ei.estado||"activo",(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({activo:"bg-green-100 text-green-800",suspendido:"bg-yellow-100 text-yellow-800",archivado:"bg-gray-100 text-gray-800",terminado:"bg-blue-100 text-blue-800"}[et]||"bg-gray-100 text-gray-800"),children:et.charAt(0).toUpperCase()+et.slice(1)})),ei.prioridad&&(er=ei.prioridad,(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({baja:"bg-gray-100 text-gray-800",media:"bg-blue-100 text-blue-800",alta:"bg-orange-100 text-orange-800",urgente:"bg-red-100 text-red-800"}[er]||"bg-gray-100 text-gray-800"),children:er.charAt(0).toUpperCase()+er.slice(1)})),ei.etapa_actual&&(0,l.jsx)(n.E,{variant:"outline",children:ei.etapa_actual})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[(0,l.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-blue-900 mb-2 flex items-center",children:[(0,l.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Abogado Responsable"]}),eA?(0,l.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,l.jsx)("p",{className:"font-medium text-blue-800",children:eA.nombre}),eA.telefono&&(0,l.jsxs)("p",{className:"flex items-center text-blue-700",children:[(0,l.jsx)(P.A,{className:"h-3 w-3 mr-1"}),eA.telefono]}),eA.email&&(0,l.jsxs)("p",{className:"flex items-center text-blue-700",children:[(0,l.jsx)(q.A,{className:"h-3 w-3 mr-1"}),eA.email]})]}):(0,l.jsx)("p",{className:"text-sm text-blue-700",children:"Este caso a\xfan no tiene un abogado asignado."}),e$&&(0,l.jsxs)("form",{className:"mt-4 space-y-2",onSubmit:eB,children:[(0,l.jsx)(d.J,{htmlFor:"case-lawyer-select",className:"text-xs uppercase tracking-wide text-blue-800",children:"Reasignar / asignar abogado"}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,l.jsxs)("select",{id:"case-lawyer-select",className:"form-input flex-1",value:eR,onChange:e=>eE(e.target.value),disabled:ek||eI,children:[(0,l.jsx)("option",{value:"",children:ek?"Cargando abogadosâ€¦":"Selecciona un abogado"}),eC.map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.nombre,e.email?" â€¢ ".concat(e.email):""]},e.id))]}),(0,l.jsx)(o.$,{type:"submit",disabled:eI||!eR||eR===(null==eA?void 0:eA.id),children:eI?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(D.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Guardandoâ€¦"]}):"Actualizar"})]}),(0,l.jsx)("p",{className:"text-xs text-blue-700",children:"Los cambios quedan registrados autom\xe1ticamente en el historial del caso."})]})]}),ei.nombre_cliente&&(0,l.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-green-900 mb-2 flex items-center",children:[(0,l.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"Cliente"]}),(0,l.jsx)("p",{className:"text-sm font-medium text-green-800",children:ei.nombre_cliente}),ei.rut_cliente&&(0,l.jsxs)("p",{className:"text-sm text-green-700",children:["RUT: ",ei.rut_cliente]})]}),(0,l.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-purple-900 mb-2 flex items-center",children:[(0,l.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"Fechas"]}),(0,l.jsxs)("div",{className:"space-y-1 text-sm text-purple-700",children:[ei.fecha_inicio&&(0,l.jsxs)("p",{children:["Inicio: ",(0,h.Yq)(ei.fecha_inicio)]}),ei.fecha_termino&&(0,l.jsxs)("p",{children:["T\xe9rmino: ",(0,h.Yq)(ei.fecha_termino)]})]})]}),ei.valor_estimado&&(0,l.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-yellow-900 mb-2 flex items-center",children:[(0,l.jsx)(U.A,{className:"h-4 w-4 mr-2"}),"Valor Estimado"]}),(0,l.jsx)("p",{className:"text-lg font-bold text-yellow-800",children:(0,h.vv)(ei.valor_estimado)})]}),(eb.solicitado>0||eb.autorizado>0)&&(0,l.jsxs)("div",{className:"bg-sky-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-sky-900 mb-2 flex items-center",children:[(0,l.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Alcance del cliente"]}),(0,l.jsx)("p",{className:"text-sm text-sky-700",children:eb.solicitado>0?"Solicitado: ".concat(null!=eD?eD:"Etapa ".concat(eb.solicitado)):"Sin solicitudes vigentes"}),(0,l.jsx)("p",{className:"text-sm text-sky-700",children:eb.autorizado>0?"Autorizado: ".concat(null!=eL?eL:"Etapa ".concat(eb.autorizado)):"Aprobaci\xf3n pendiente"}),("admin_firma"===en.role||"analista"===en.role)&&eb.solicitado>eb.autorizado&&(0,l.jsx)(o.$,{size:"sm",className:"mt-3 inline-flex items-center gap-2 rounded-full bg-sky-600 text-white hover:bg-sky-700",onClick:()=>eX(eb.solicitado),disabled:eU,children:eU?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(D.A,{className:"h-4 w-4 animate-spin"}),"Autorizandoâ€¦"]}):"Autorizar solicitud"})]}),(null!==eW||ei.tarifa_referencia)&&(0,l.jsxs)("div",{className:"bg-indigo-50 rounded-lg p-4",children:[(0,l.jsxs)("h3",{className:"font-medium text-indigo-900 mb-2 flex items-center",children:[(0,l.jsx)(F.A,{className:"h-4 w-4 mr-2"}),"Honorarios"]}),(0,l.jsxs)("div",{className:"space-y-1 text-sm text-indigo-800",children:[ei.modalidad_cobro&&(0,l.jsx)("p",{className:"uppercase text-xs tracking-wide text-indigo-600",children:ei.modalidad_cobro}),null!==eW&&(0,l.jsxs)("p",{className:"font-semibold",children:["Total: ",eV(eW)]}),null!==eW&&(0,l.jsxs)("p",{children:["Pagado: ",eV(eY)]}),null!==eH&&(0,l.jsxs)("p",{children:["Pendiente: ",eV(eH)]}),ei.honorario_variable_porcentaje&&(0,l.jsxs)("p",{children:["Variable: ",ei.honorario_variable_porcentaje,"%",ei.honorario_variable_base?" (".concat(ei.honorario_variable_base,")"):""]}),ei.tarifa_referencia&&(0,l.jsxs)("p",{className:"text-xs text-indigo-600",children:["Tarifa: ",ei.tarifa_referencia]}),ei.honorario_notas&&(0,l.jsx)("p",{className:"text-xs text-indigo-700 whitespace-pre-wrap",children:ei.honorario_notas})]})]})]}),ei.contraparte&&(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Contraparte"}),(0,l.jsx)("p",{className:"text-gray-700",children:ei.contraparte})]}),ei.observaciones&&(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Observaciones"}),(0,l.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:ei.observaciones})]})]})}),(0,l.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,l.jsx)("nav",{className:"-mb-px flex space-x-8",children:e1.map(e=>{let a=e.icon;return(0,l.jsxs)("button",{onClick:()=>ed(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ".concat(ec===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,l.jsx)(a,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:e.label})]},e.id)})})}),(0,l.jsxs)("div",{children:["overview"===ec&&(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsx)(x.S,{caseId:ei.id,caseMateria:null!=(es=ei.materia)?es:"General",canManageStages:eT,showPrivateStages:eJ,clientContext:{role:"usuario"===en.role?"cliente":en.role,alcanceAutorizado:eb.autorizado,alcanceSolicitado:eb.solicitado},onClientProgressChange:e=>{eh(a=>{var s,l;let t=null!=(s=e.solicitado)?s:a.solicitado,r=null!=(l=e.autorizado)?l:a.autorizado;return t===a.solicitado&&r===a.autorizado?a:{solicitado:t,autorizado:r}})},onStagesLoaded:ep})}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(u.$,{caseId:ei.id,canUpload:eT,canEdit:eT,canDelete:eT,showPrivateDocuments:eJ}),(0,l.jsx)(p.L,{caseId:ei.id,canCreateRequests:!0,canRespondRequests:eG,showPrivateRequests:eJ})]})]}),"timeline"===ec&&(0,l.jsx)(x.S,{caseId:ei.id,caseMateria:null!=(el=ei.materia)?el:"General",canManageStages:eT,showPrivateStages:eJ,clientContext:{role:"usuario"===en.role?"cliente":en.role,alcanceAutorizado:eb.autorizado,alcanceSolicitado:eb.solicitado},onClientProgressChange:e=>{eh(a=>{var s,l;let t=null!=(s=e.solicitado)?s:a.solicitado,r=null!=(l=e.autorizado)?l:a.autorizado;return t===a.solicitado&&r===a.autorizado?a:{solicitado:t,autorizado:r}})},onStagesLoaded:ep}),"documents"===ec&&(0,l.jsx)(u.$,{caseId:ei.id,canUpload:eT,canEdit:eT,canDelete:eT,showPrivateDocuments:eJ}),"notes"===ec&&(0,l.jsx)(m._,{caseId:ei.id,canCreateNotes:eZ,canEditNotes:eZ,showPrivateNotes:eJ}),"messages"===ec&&(0,l.jsx)(b.B,{caseId:ei.id,initialMessages:eo,currentProfileId:en.id,allowSend:"cliente"!==en.role}),"requests"===ec&&(0,l.jsx)(p.L,{caseId:ei.id,canCreateRequests:!0,canRespondRequests:eG,showPrivateRequests:eJ}),"clients"===ec&&eT&&(0,l.jsxs)("div",{className:"space-y-6",children:[ei.clients&&ei.clients.length>0&&(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(z.A,{className:"h-5 w-5"}),"Clientes Asociados (",ei.clients.length,")"]})}),(0,l.jsx)(i.Wu,{children:(0,l.jsx)("div",{className:"space-y-3",children:ei.clients.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"h-10 w-10 rounded-full flex items-center justify-center text-white font-medium",style:{backgroundColor:(0,h.qA)(e.nombre)},children:(0,h.IM)(e.nombre)}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900",children:e.nombre}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(q.A,{className:"h-3 w-3 mr-1"}),e.email]}),e.telefono&&(0,l.jsxs)("span",{className:"flex items-center",children:[(0,l.jsx)(P.A,{className:"h-3 w-3 mr-1"}),e.telefono]})]})]})]}),(0,l.jsx)(n.E,{variant:"outline",children:"Cliente"})]},e.id))})})]}),(0,l.jsxs)(i.Zp,{children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(z.A,{className:"h-5 w-5"}),"Contrapartes (demandados)"]})}),(0,l.jsxs)(i.Wu,{className:"space-y-6",children:[(0,l.jsxs)("form",{onSubmit:eQ,className:"grid gap-4 md:grid-cols-[1.2fr_1fr_0.8fr_auto]",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d.J,{htmlFor:"counterparty_nombre",children:"Nombre completo *"}),(0,l.jsx)(c.p,{id:"counterparty_nombre",placeholder:"Empresa demandada o persona",value:ev.nombre,onChange:e=>eK("nombre",e.target.value),required:!0})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d.J,{htmlFor:"counterparty_rut",children:"RUT"}),(0,l.jsx)(c.p,{id:"counterparty_rut",placeholder:"12.345.678-9",value:ev.rut,onChange:e=>eK("rut",e.target.value)})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(d.J,{htmlFor:"counterparty_tipo",children:"Rol"}),(0,l.jsxs)("select",{id:"counterparty_tipo",className:"form-input",value:ev.tipo,onChange:e=>eK("tipo",e.target.value),children:[(0,l.jsx)("option",{value:"demandado",children:"Demandado"}),(0,l.jsx)("option",{value:"demandante",children:"Demandante"}),(0,l.jsx)("option",{value:"tercero",children:"Tercero"})]})]}),(0,l.jsx)("div",{className:"flex items-end",children:(0,l.jsx)(o.$,{type:"submit",className:"w-full",disabled:eN||ev.nombre.trim().length<2,children:eN?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(D.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Registrandoâ€¦"]}):"Agregar"})})]}),(0,l.jsx)("div",{className:"space-y-3",children:0===eg.length?(0,l.jsx)("p",{className:"text-sm text-slate-500",children:"A\xfan no se agregan demandados al expediente. Reg\xedstralos para tener claridad de las partes involucradas."}):eg.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm shadow-sm",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"font-medium text-slate-900",children:e.nombre}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-slate-500",children:[(0,l.jsx)("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[11px] uppercase tracking-wide text-slate-600",children:e.tipo.charAt(0).toUpperCase()+e.tipo.slice(1)}),e.rut&&(0,l.jsxs)("span",{children:["RUT: ",e.rut]}),(0,l.jsxs)("span",{children:["Agregado: ",e.created_at?(0,h.Yq)(e.created_at):"â€”"]})]})]}),(0,l.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-slate-400 hover:text-red-600",onClick:()=>e0(e.id),disabled:ew===e.id,children:ew===e.id?(0,l.jsx)(D.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(T.A,{className:"h-4 w-4"})})]},e.id))})]})]})]})]})]})]})}},73244:(e,a,s)=>{"use strict";s.d(a,{J:()=>c});var l=s(11291),t=s(97451),r=s(23838),i=s(11263),n=s(93293);let o=(0,i.F)("text-sm font-medium leading-none text-foreground/75 peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.b,{ref:a,className:(0,n.cn)(o(),s),...t})});c.displayName=r.b.displayName}},e=>{e.O(0,[936,787,577,943,927,193,55,358],()=>e(e.s=25126)),_N_E=e.O()}]);