"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[182],{848:(e,a,r)=>{r.d(a,{T:()=>n});var t=r(11291),i=r(97451),s=r(93293);let n=i.forwardRef((e,a)=>{let{className:r,...i}=e;return(0,t.jsx)("textarea",{ref:a,className:(0,s.cn)("flex min-h-[100px] w-full rounded-2xl border border-white/30 bg-white/70 px-4 py-3 text-sm text-foreground/80 shadow-inner transition-all placeholder:text-foreground/40 focus-visible:border-primary focus-visible:bg-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30 disabled:cursor-not-allowed disabled:opacity-60",r),...i})});n.displayName="Textarea"},8179:(e,a,r)=>{r.d(a,{S:()=>L});var t=r(11291),i=r(97451),s=r(90718),n=r(82596),o=r(9983),l=r(68630),c=r(59030);let d=(0,c.createServerReference)("407d6cb4ff2bd39dcaf5f15fa9d0e06606b79d5032",c.callServer,void 0,c.findSourceMapURL,"getStages"),p=(0,c.createServerReference)("4085495ff5376de2d9544dda91281e646ae494c949",c.callServer,void 0,c.findSourceMapURL,"createStage"),m=(0,c.createServerReference)("60ca260422e043e8d031aa4e5ec5aa5cec62c69295",c.callServer,void 0,c.findSourceMapURL,"completeStage"),u=(0,c.createServerReference)("400967a73b9add91995e0337cec7f66ae699a36c62",c.callServer,void 0,c.findSourceMapURL,"deleteStage"),x=(0,c.createServerReference)("608da5f884100b9fa525729204e6c90fb38047921a",c.callServer,void 0,c.findSourceMapURL,"updateStage");var v=r(93293),h=r(71428),g=r(96843),f=r(74759),b=r(23403),j=r(35947),N=r(90465),y=r(27416),_=r(87917),E=r(3814),w=r(77230),S=r(67759),C=r(55096),k=r(87442),A=r(62490),R=r(94724),D=r(66383);D.Ik({case_id:D.Yj().uuid("ID de caso inv\xe1lido"),etapa:D.Yj().min(1,"El nombre de la etapa es requerido").max(100,"El nombre no puede exceder 100 caracteres"),descripcion:D.Yj().optional(),fecha_programada:D.Yj().optional(),fecha_completada:D.Yj().optional(),estado:D.k5(["pendiente","en_proceso","completado"]).default("pendiente"),es_publica:D.zM().default(!0),orden:D.ai().int().positive("El orden debe ser un n\xfamero positivo"),responsable_id:D.Yj().uuid("ID de responsable inv\xe1lido").optional(),requiere_pago:D.zM().default(!1),costo_uf:D.ai().min(0,"El costo debe ser positivo").optional(),porcentaje_variable:D.ai().min(0,"El porcentaje debe ser positivo").max(100,"El porcentaje no puede exceder 100").optional(),estado_pago:D.k5(["pendiente","en_proceso","parcial","pagado","vencido"]).default("pendiente"),enlace_pago:D.Yj().url("Debe ser una URL v\xe1lida").optional(),notas_pago:D.Yj().max(1e3,"Las notas no pueden exceder 1000 caracteres").optional(),monto_variable_base:D.Yj().optional(),monto_pagado_uf:D.ai().min(0,"El monto pagado debe ser positivo").optional()}).partial().omit({case_id:!0}),D.Ik({fecha_completada:D.Yj().optional(),observaciones:D.Yj().optional()}),D.Ik({case_id:D.Yj().uuid().optional(),estado:D.k5(["pendiente","en_proceso","completado"]).optional(),responsable_id:D.Yj().uuid().optional(),es_publica:D.zM().optional(),fecha_desde:D.Yj().optional(),fecha_hasta:D.Yj().optional(),page:D.ai().min(1).default(1),limit:D.ai().min(1).max(100).default(20)});let I={Civil:[.15,.1,.1,.1,.15,.2,.1,.05,.05],Comercial:[.2,.15,.15,.2,.15,.1,.05],Laboral:[.2,.2,.2,.2,.1,.1],Familia:[.2,.15,.15,.15,.2,.15]},M={Civil:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda con antecedentes y revisi\xf3n formal del tribunal.",diasEstimados:0},{etapa:"Notificaci\xf3n a la contraparte",descripcion:"Gestiones de notificaci\xf3n personal o por c\xe9dula al demandado.",diasEstimados:30},{etapa:"Contestaci\xf3n de la demanda",descripcion:"Plazo legal para que la contraparte conteste y proponga excepciones.",diasEstimados:20},{etapa:"R\xe9plicas y d\xfaplicas",descripcion:"Intercambio de escritos aclarando puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia preparatoria",descripcion:"Fijaci\xf3n de puntos de prueba y acuerdos probatorios.",diasEstimados:30},{etapa:"Periodo probatorio",descripcion:"Recepci\xf3n de declaraciones, oficios, peritajes y documental.",diasEstimados:45},{etapa:"Alegatos y vista de la causa",descripcion:"Audiencia de cierre donde las partes exponen sus argumentos finales.",diasEstimados:20},{etapa:"Sentencia de primera instancia",descripcion:"Redacci\xf3n y publicaci\xf3n del fallo por el tribunal.",diasEstimados:60},{etapa:"Recursos y cumplimiento",descripcion:"Interposici\xf3n de recursos o cumplimiento voluntario/forzado.",diasEstimados:30}],Comercial:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda y verificaci\xf3n formal.",diasEstimados:0},{etapa:"Notificaci\xf3n demandado",descripcion:"Gesti\xf3n de notificaci\xf3n a la contraparte y acreditaci\xf3n en autos.",diasEstimados:20},{etapa:"Contestaci\xf3n y reconvenci\xf3n",descripcion:"Respuesta del demandado y eventuales reconvenciones.",diasEstimados:20},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de hechos a probar y medios de prueba.",diasEstimados:25},{etapa:"Prueba y alegatos",descripcion:"Producci\xf3n de prueba documental, testimonial y alegatos finales.",diasEstimados:40},{etapa:"Sentencia",descripcion:"Decisi\xf3n del tribunal y notificaci\xf3n a las partes.",diasEstimados:45},{etapa:"Ejecuci\xf3n o recursos",descripcion:"Cumplimiento del fallo o tramitaci\xf3n de recursos.",diasEstimados:30}],Laboral:[{etapa:"Ingreso tutela o demanda laboral",descripcion:"Ingreso del escrito y asignaci\xf3n de audiencia preliminar.",diasEstimados:0},{etapa:"Citaciones y notificaci\xf3n empleador",descripcion:"Notificaci\xf3n de la demanda y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Intento de conciliaci\xf3n y fijaci\xf3n de puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Producci\xf3n de prueba y alegatos finales.",diasEstimados:20},{etapa:"Sentencia laboral",descripcion:"Pronunciamiento del tribunal y notificaci\xf3n a las partes.",diasEstimados:15},{etapa:"Cumplimiento / Recurso de nulidad",descripcion:"Tramitaci\xf3n de recursos o ejecuci\xf3n de la sentencia.",diasEstimados:20}],Familia:[{etapa:"Ingreso demanda o escrito inicial",descripcion:"Ingreso de medida de protecci\xf3n o demanda ante tribunal de familia.",diasEstimados:0},{etapa:"Notificaci\xf3n y citaci\xf3n a audiencia",descripcion:"Notificaci\xf3n a la contraparte y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de puntos controvertidos y acumulaci\xf3n de prueba.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Presentaci\xf3n de prueba, declaraciones y alegatos.",diasEstimados:20},{etapa:"Sentencia",descripcion:"Redacci\xf3n y comunicaci\xf3n del fallo.",diasEstimados:20},{etapa:"Cumplimiento y seguimiento",descripcion:"Ejecuci\xf3n de medidas decretadas y seguimiento del cumplimiento.",diasEstimados:25}]},q=[{value:"pendiente",label:"Pendiente",color:"gray"},{value:"en_proceso",label:"En Proceso",color:"blue"},{value:"completado",label:"Completado",color:"green"}],z=[{value:"pendiente",label:"Pendiente",color:"gray"},{value:"en_proceso",label:"En proceso",color:"amber"},{value:"parcial",label:"Pago parcial",color:"blue"},{value:"pagado",label:"Pagado",color:"green"},{value:"vencido",label:"Vencido",color:"red"}];function L(e){let{caseId:a,caseMateria:r="Civil",canManageStages:c=!1,showPrivateStages:D=!0}=e,[L,T]=(0,i.useState)([]),[F,P]=(0,i.useState)(!0),[U,Y]=(0,i.useState)(!1),[$,Z]=(0,i.useState)(null),[B,W]=(0,i.useState)(!1),[O,V]=(0,i.useState)({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1,requiere_pago:!1,costo_uf:"",porcentaje_variable:"",enlace_pago:"",notas_pago:"",monto_variable_base:"",estado_pago:"pendiente",monto_pagado_uf:""}),{toast:H}=(0,l.dj)(),[G,X]=(0,i.useState)(null),[K,Q]=(0,i.useState)(null),J=async()=>{P(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?T(e.stages):H({title:"Error",description:e.error||"Error al cargar etapas",variant:"destructive"})}catch(e){console.error("Error loading stages:",e),H({title:"Error",description:"Error inesperado al cargar etapas",variant:"destructive"})}finally{P(!1)}};(0,i.useEffect)(()=>{J()},[a]);let ee=async()=>{var e,r,t;if(!O.etapa.trim())return void H({title:"Error",description:"El nombre de la etapa es requerido",variant:"destructive"});let i=O.costo_uf?Number(O.costo_uf):void 0;if(O.requiere_pago&&(void 0===i||Number.isNaN(i)))return void H({title:"Costo requerido",description:"Debes indicar el costo en UF de la etapa para poder cobrarla.",variant:"destructive"});if(void 0!==i&&i<0)return void H({title:"Monto inv\xe1lido",description:"El costo en UF debe ser un n\xfamero positivo.",variant:"destructive"});let s=O.porcentaje_variable?Number(O.porcentaje_variable):void 0;if(void 0!==s&&(Number.isNaN(s)||s<0||s>100))return void H({title:"Porcentaje inv\xe1lido",description:"El porcentaje variable debe estar entre 0% y 100%.",variant:"destructive"});let n=O.monto_pagado_uf?Number(O.monto_pagado_uf):void 0;if(void 0!==n&&(Number.isNaN(n)||n<0))return void H({title:"Monto pagado inv\xe1lido",description:"El monto pagado debe ser un n\xfamero positivo.",variant:"destructive"});let o=null==(e=O.enlace_pago)?void 0:e.trim();if(o&&!/^https?:\/\//i.test(o))return void H({title:"URL inv\xe1lida",description:"El enlace de pago debe comenzar con http:// o https://",variant:"destructive"});Y(!0);try{let e=Math.max(...L.map(e=>e.orden||0),0),l={case_id:a,etapa:O.etapa.trim(),descripcion:O.descripcion.trim()||void 0,fecha_programada:O.fecha_programada||void 0,es_publica:O.es_publica,estado:"pendiente",orden:e+1,requiere_pago:O.requiere_pago,costo_uf:i,porcentaje_variable:s,estado_pago:O.estado_pago||"pendiente",enlace_pago:o||void 0,notas_pago:(null==(r=O.notas_pago)?void 0:r.trim())||void 0,monto_variable_base:(null==(t=O.monto_variable_base)?void 0:t.trim())||void 0,monto_pagado_uf:n},c=await p(l);c.success?(H({title:"Etapa creada",description:"La etapa ha sido creada exitosamente"}),V({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1,requiere_pago:!1,costo_uf:"",porcentaje_variable:"",enlace_pago:"",notas_pago:"",monto_variable_base:"",estado_pago:"pendiente",monto_pagado_uf:""}),W(!1),await J()):H({title:"Error",description:c.error||"Error al crear la etapa",variant:"destructive"})}catch(e){console.error("Error creating stage:",e),H({title:"Error",description:"Error inesperado al crear la etapa",variant:"destructive"})}finally{Y(!1)}},ea=async e=>{if(e.requiere_pago&&"pagado"!==e.estado_pago)return void H({title:"Pago pendiente",description:"Debes registrar el pago de esta etapa antes de marcarla como completada.",variant:"destructive"});try{X(e.id);let a=await m(e.id);a.success?(H({title:"Etapa completada",description:"La etapa ha sido marcada como completada"}),await J()):H({title:"Error",description:a.error||"Error al completar la etapa",variant:"destructive"})}catch(e){console.error("Error completing stage:",e),H({title:"Error",description:"Error inesperado al completar la etapa",variant:"destructive"})}finally{X(null)}},er=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta etapa?"))try{let a=await u(e);a.success?(H({title:"Etapa eliminada",description:"La etapa ha sido eliminada exitosamente"}),await J()):H({title:"Error",description:a.error||"Error al eliminar la etapa",variant:"destructive"})}catch(e){console.error("Error deleting stage:",e),H({title:"Error",description:"Error inesperado al eliminar la etapa",variant:"destructive"})}},et=e=>null==e?"—":"".concat(new Intl.NumberFormat("es-CL",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)," UF"),ei=async e=>{var a;let r=prompt("Ingresa el enlace de pago de Payku para esta etapa",null!=(a=e.enlace_pago)?a:"");if(null===r)return;let t=r.trim();if(t&&!/^https?:\/\//i.test(t))return void H({title:"URL inv\xe1lida",description:"Ingresa una URL v\xe1lida que comience con http:// o https://",variant:"destructive"});try{Q(e.id);let a=await x(e.id,{enlace_pago:t||void 0,requiere_pago:!!t||e.requiere_pago});a.success?(H({title:t?"Enlace de pago actualizado":"Enlace eliminado",description:t?"Comparte este enlace con el cliente para cobrar la etapa.":"Se elimin\xf3 el enlace asociado a la etapa."}),await J()):H({title:"No se pudo guardar el enlace",description:a.error||"Intenta nuevamente.",variant:"destructive"})}catch(e){console.error("Error setting payment link:",e),H({title:"Error inesperado",description:"No pudimos guardar el enlace en este momento.",variant:"destructive"})}finally{Q(null)}},es=async e=>{var a,r,t,i,s;let n=null!=(t=e.monto_pagado_uf)?t:null!=(r=e.costo_uf)?r:0,o=prompt("Monto pagado (UF)",n>0?n.toString():null!=(i=null==(a=e.costo_uf)?void 0:a.toString())?i:"");if(null===o)return;let l=Number(o.replace(",","."));if(Number.isNaN(l)||l<0)return void H({title:"Monto inv\xe1lido",description:"Ingresa un n\xfamero v\xe1lido en UF.",variant:"destructive"});let c=null!=(s=e.costo_uf)?s:0,d=c>0&&l>=c?"pagado":"parcial";try{Q(e.id);let a=await x(e.id,{estado_pago:d,monto_pagado_uf:l,requiere_pago:!0});a.success?(H({title:"Pago registrado",description:"pagado"===d?"La etapa qued\xf3 marcada como pagada.":"Se registr\xf3 un pago parcial."}),await J()):H({title:"No se pudo registrar el pago",description:a.error||"Vuelve a intentarlo.",variant:"destructive"})}catch(e){console.error("Error setting payment status:",e),H({title:"Error inesperado",description:"No pudimos registrar el pago.",variant:"destructive"})}finally{Q(null)}},en=async e=>{if(!e.costo_uf||!e.monto_pagado_uf||!(e.monto_pagado_uf<e.costo_uf)||confirm("El monto registrado como pagado es menor al costo de la etapa. \xbfDeseas marcarla como pagada de todas maneras?"))try{var a,r;Q(e.id);let t=await x(e.id,{estado_pago:"pagado",monto_pagado_uf:null!=(r=null!=(a=e.costo_uf)?a:e.monto_pagado_uf)?r:0,requiere_pago:!0});t.success?(H({title:"Pago completado",description:"Esta etapa qued\xf3 marcada como pagada."}),await J()):H({title:"No se pudo marcar como pagado",description:t.error||"Intenta nuevamente.",variant:"destructive"})}catch(e){console.error("Error marking stage paid:",e),H({title:"Error inesperado",description:"No fue posible marcar la etapa como pagada.",variant:"destructive"})}finally{Q(null)}},eo=D?L:L.filter(e=>e.es_publica),el=function(e){var a;if(!e)return M.Civil;let r=e.toLowerCase(),t=Object.keys(M).find(e=>e.toLowerCase()===r),i=t?M[t]:M.Civil,s=t&&I[t]?I[t]:null!=(a=I.Civil)?a:[];return i.map((e,a)=>{var r;return{...e,porcentajeHonorario:null!=(r=s[a])?r:0}})}(r),ec=L.reduce((e,a)=>{var r;return e+(null!=(r=a.costo_uf)?r:0)},0),ed=L.reduce((e,a)=>{var r;return e+(null!=(r=a.monto_pagado_uf)?r:0)},0),ep=L.filter(e=>e.requiere_pago),em=ep.filter(e=>"pagado"===e.estado_pago).length,eu=ep.filter(e=>"pagado"!==e.estado_pago).length;return((0,i.useEffect)(()=>{B&&ep.length>0&&V(e=>({...e,requiere_pago:!0}))},[B,ep.length]),F)?(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-5 w-5"}),"Timeline Procesal"]})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(b.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-5 w-5"}),"Timeline Procesal (",eo.length,")"]}),c&&(0,t.jsxs)(s.$,{size:"sm",onClick:()=>W(!B),disabled:U,children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Nueva Etapa"]})]})}),(0,t.jsxs)(n.Wu,{className:"space-y-6",children:[ep.length>0&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 rounded-lg border border-blue-100 bg-blue-50 p-4 text-sm text-blue-900",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-wide text-blue-600",children:"Honorario distribuido"}),(0,t.jsx)("p",{className:"text-lg font-semibold",children:et(ec)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-wide text-blue-600",children:"Pagado"}),(0,t.jsx)("p",{className:"text-lg font-semibold",children:et(ed)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-wide text-blue-600",children:"Etapas liberadas"}),(0,t.jsxs)("p",{className:"text-lg font-semibold",children:[em," / ",ep.length]}),eu>0&&(0,t.jsxs)("p",{className:"text-xs text-blue-700 mt-1",children:["Faltan ",eu," pago(s) para completar el plan."]})]})]}),B&&c&&(0,t.jsx)(n.Zp,{className:"border-dashed",children:(0,t.jsx)(n.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Etapa"}),(0,t.jsxs)("select",{value:O.isCustom?"custom":O.etapa,onChange:e=>{var a;let r=e.target.value;if("custom"===r)return void V({...O,etapa:"",descripcion:"",isCustom:!0});let t=el.find(e=>e.etapa===r);V({...O,etapa:r,descripcion:(null==t?void 0:t.descripcion)||O.descripcion,isCustom:!1,requiere_pago:null!=(a=null==t?void 0:t.requierePago)?a:O.requiere_pago,costo_uf:(null==t?void 0:t.costoUF)!==void 0?t.costoUF.toString():"",porcentaje_variable:(null==t?void 0:t.porcentajeVariable)!==void 0?t.porcentajeVariable.toString():"",monto_variable_base:(null==t?void 0:t.notasPago)||"",estado_pago:"pendiente",notas_pago:(null==t?void 0:t.notasPago)||""})},className:"form-input",children:[(0,t.jsx)("option",{value:"",children:"Seleccionar etapa"}),el.map(e=>(0,t.jsxs)("option",{value:e.etapa,children:[e.etapa," ",e.diasEstimados?"(≈ ".concat(e.diasEstimados," d\xedas)"):""]},e.etapa)),(0,t.jsx)("option",{value:"custom",children:"Etapa personalizada..."})]}),O.isCustom&&(0,t.jsx)("input",{type:"text",placeholder:"Nombre de la etapa personalizada",value:O.etapa,onChange:e=>V({...O,etapa:e.target.value}),className:"form-input mt-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Descripci\xf3n (opcional)"}),(0,t.jsx)("textarea",{value:O.descripcion,onChange:e=>V({...O,descripcion:e.target.value}),placeholder:"Descripci\xf3n de la etapa...",rows:3,className:"form-input"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fecha programada (opcional)"}),(0,t.jsx)("input",{type:"date",value:O.fecha_programada,onChange:e=>V({...O,fecha_programada:e.target.value}),className:"form-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Visibilidad"}),(0,t.jsxs)("select",{value:O.es_publica?"publica":"privada",onChange:e=>V({...O,es_publica:"publica"===e.target.value}),className:"form-input",children:[(0,t.jsx)("option",{value:"publica",children:"P\xfablica (visible para cliente)"}),(0,t.jsx)("option",{value:"privada",children:"Privada (solo abogados)"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t border-gray-200 pt-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,t.jsx)("input",{type:"checkbox",className:"rounded border-gray-300",checked:O.requiere_pago,onChange:e=>V({...O,requiere_pago:e.target.checked,estado_pago:"pendiente"})}),"Esta etapa requiere pago para avanzar"]}),O.requiere_pago&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Monto fijo (UF)"}),(0,t.jsx)("input",{type:"number",min:"0",step:"0.01",value:O.costo_uf,onChange:e=>V({...O,costo_uf:e.target.value}),className:"form-input",placeholder:"Ej: 5.0"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Componente variable (%)"}),(0,t.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",value:O.porcentaje_variable,onChange:e=>V({...O,porcentaje_variable:e.target.value}),className:"form-input",placeholder:"Ej: 10"})]}),(0,t.jsxs)("div",{className:"md:col-span-2 space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Base del variable"}),(0,t.jsx)("textarea",{rows:2,value:O.monto_variable_base,onChange:e=>V({...O,monto_variable_base:e.target.value}),className:"form-input",placeholder:"Ej: 10% de lo obtenido o ahorrado."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Link de pago (Payku)"}),(0,t.jsx)("input",{type:"url",value:O.enlace_pago,onChange:e=>V({...O,enlace_pago:e.target.value}),className:"form-input",placeholder:"https://..."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Notas internas"}),(0,t.jsx)("textarea",{rows:2,value:O.notas_pago,onChange:e=>V({...O,notas_pago:e.target.value}),className:"form-input",placeholder:"Instrucciones u observaciones sobre el cobro."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Estado inicial del pago"}),(0,t.jsx)("select",{value:O.estado_pago,onChange:e=>V({...O,estado_pago:e.target.value}),className:"form-input",children:z.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Monto ya pagado (UF)"}),(0,t.jsx)("input",{type:"number",min:"0",step:"0.01",value:O.monto_pagado_uf,onChange:e=>V({...O,monto_pagado_uf:e.target.value}),className:"form-input",placeholder:"0.00"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(s.$,{variant:"outline",onClick:()=>{W(!1),V({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1,requiere_pago:!1,costo_uf:"",porcentaje_variable:"",enlace_pago:"",notas_pago:"",monto_variable_base:"",estado_pago:"pendiente",monto_pagado_uf:""})},disabled:U,children:"Cancelar"}),(0,t.jsx)(s.$,{onClick:ee,disabled:U,children:U?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Creando..."]}):"Crear Etapa"})]})]})]})})}),(0,t.jsx)("div",{className:"relative",children:eo.map((e,a)=>{let r=e.responsable;return(0,t.jsxs)("div",{className:"relative flex items-start space-x-4 pb-8",children:[a<eo.length-1&&(0,t.jsx)("div",{className:"absolute left-2.5 top-8 w-0.5 h-full bg-gray-200"}),(0,t.jsx)("div",{className:"relative z-10 flex-shrink-0",children:(e=>{switch(e){case"completado":return(0,t.jsx)(h.A,{className:"h-5 w-5 text-green-600"});case"en_proceso":return(0,t.jsx)(g.A,{className:"h-5 w-5 text-blue-600"});default:return(0,t.jsx)(f.A,{className:"h-5 w-5 text-gray-400"})}})(e.estado||"pendiente")}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)(n.Zp,{className:"".concat("completado"===e.estado?"bg-green-50":""),children:(0,t.jsxs)(n.Wu,{className:"pt-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900",children:e.etapa}),e.descripcion&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.descripcion})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(e=>{let a=q.find(a=>a.value===e);return a?(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({gray:"bg-gray-100 text-gray-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",red:"bg-red-100 text-red-800"}[a.color]),children:a.label}):null})(e.estado||"pendiente"),!e.es_publica&&(0,t.jsx)(o.E,{variant:"outline",children:"Privada"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[e.fecha_programada&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(N.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:(0,v.m7)(e.fecha_programada)&&"completado"!==e.estado?"text-red-600 font-medium":"",children:(0,v.Yq)(e.fecha_programada)})]}),(null==r?void 0:r.nombre)&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:r.nombre})]}),e.fecha_cumplida&&(0,t.jsxs)("div",{className:"text-green-600",children:["Completado ",(0,v.fw)(e.fecha_cumplida)]})]}),e.requiere_pago&&(0,t.jsxs)("div",{className:"mt-3 rounded-lg border border-amber-200 bg-amber-50 p-3 text-sm space-y-2 text-amber-900",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 font-semibold",children:[(0,t.jsx)(_.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Costo de la etapa:"}),(0,t.jsx)("span",{children:et(e.costo_uf)})]}),(e=>{if(!e)return null;let a=z.find(a=>a.value===e);if(!a)return null;let r={gray:"bg-gray-100 text-gray-800",amber:"bg-amber-100 text-amber-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",red:"bg-red-100 text-red-800"}[a.color]||"bg-gray-100 text-gray-800";return(0,t.jsx)(o.E,{className:r,variant:"outline",children:a.label})})(e.estado_pago||"pendiente")]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-amber-800",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Pagado: ",et(e.monto_pagado_uf)]})]}),e.porcentaje_variable&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Variable: ",e.porcentaje_variable,"% ",e.monto_variable_base?"(".concat(e.monto_variable_base,")"):""]})]})]}),e.notas_pago&&(0,t.jsx)("p",{className:"text-xs text-amber-700 bg-white/60 border border-amber-200 rounded-md px-3 py-2",children:e.notas_pago}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[e.enlace_pago&&(0,t.jsx)(s.$,{size:"sm",variant:"outline",asChild:!0,children:(0,t.jsxs)("a",{href:e.enlace_pago,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)(S.A,{className:"h-4 w-4 mr-2"}),"Abrir enlace Payku"]})}),c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.$,{size:"sm",variant:"ghost",onClick:()=>ei(e),disabled:K===e.id,children:K===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Guardando…"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.A,{className:"h-4 w-4 mr-2"}),e.enlace_pago?"Editar enlace":"Asignar enlace"]})}),(0,t.jsx)(s.$,{size:"sm",variant:"ghost",onClick:()=>es(e),disabled:K===e.id,children:K===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Registrando…"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Registrar pago"]})}),(0,t.jsx)(s.$,{size:"sm",variant:"outline",onClick:()=>en(e),disabled:K===e.id,children:K===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Confirmando…"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Marcar pagado"]})})]})]}),"pagado"!==e.estado_pago&&e.enlace_pago&&(0,t.jsxs)("p",{className:"text-xs text-amber-700 flex items-center gap-1",children:[(0,t.jsx)(k.A,{className:"h-3 w-3"}),"Comparte el enlace con el cliente para liberar esta etapa."]})]}),c&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["completado"!==e.estado&&(0,t.jsx)(s.$,{size:"sm",variant:"outline",onClick:()=>ea(e),disabled:G===e.id||e.requiere_pago&&"pagado"!==e.estado_pago,children:G===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-1 animate-spin"}),"Procesando…"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.A,{className:"h-4 w-4 mr-1"}),"Completar"]})}),(0,t.jsx)(s.$,{size:"sm",variant:"ghost",onClick:()=>Z(e.id),children:(0,t.jsx)(A.A,{className:"h-4 w-4"})}),(0,t.jsx)(s.$,{size:"sm",variant:"ghost",onClick:()=>er(e.id),children:(0,t.jsx)(R.A,{className:"h-4 w-4"})})]})]})})})]},e.id)})}),0===eo.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(g.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"No hay etapas definidas para este caso"}),c&&(0,t.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Etapa" para agregar la primera etapa'})]}),el.length>0&&(0,t.jsxs)("div",{className:"border-t pt-4 mt-2",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-700",children:["Plan estimado de referencia para materia ",r||"Civil"]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Duraciones aproximadas en d\xedas a partir del inicio del caso."}),(0,t.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-gray-600",children:el.map((e,a)=>(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"mt-1 h-2 w-2 rounded-full bg-blue-500 flex-shrink-0"}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-800",children:e.etapa}),(0,t.jsxs)("span",{className:"block text-gray-500",children:[e.descripcion,e.diasEstimados?" \xb7 ≈ ".concat(e.diasEstimados," d\xedas"):""]})]})]},"".concat(e.etapa,"-").concat(a)))})]})]})]})}},9983:(e,a,r)=>{r.d(a,{E:()=>o});var t=r(11291);r(97451);var i=r(11263),s=r(93293);let n=(0,i.F)("inline-flex items-center gap-1 rounded-full border px-3 py-0.5 text-xs font-medium tracking-tight transition-all focus:outline-none focus:ring-2 focus:ring-offset-2",{variants:{variant:{default:"border-white/30 bg-white/70 text-foreground/80 shadow-sm backdrop-blur-md",secondary:"border-white/20 bg-white/30 text-foreground/70",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/90",outline:"border-white/40 text-foreground/70",success:"border-transparent bg-emerald-500/15 text-emerald-500",warning:"border-transparent bg-amber-400/20 text-amber-600",info:"border-transparent bg-sky-500/15 text-sky-500"}},defaultVariants:{variant:"default"}});function o(e){let{className:a,variant:r,...i}=e;return(0,t.jsx)("div",{className:(0,s.cn)(n({variant:r}),a),...i})}},14007:(e,a,r)=>{r.d(a,{$:()=>C});var t=r(11291),i=r(97451),s=r(90718),n=r(82596),o=r(9983),l=r(68630),c=r(59030);let d=(0,c.createServerReference)("4068b2aad6bb5abca1df8e575b8900239c3f91e123",c.callServer,void 0,c.findSourceMapURL,"getDocuments");var p=r(41782);let m=(0,c.createServerReference)("60a05bb0cd24233599cf9f92c53da27432d198f23b",c.callServer,void 0,c.findSourceMapURL,"updateDocument"),u=(0,c.createServerReference)("40a5ed4d1a022e18d6d1f8ccc8da589a299ef3c127",c.callServer,void 0,c.findSourceMapURL,"deleteDocument"),x=(0,c.createServerReference)("404011b5219b751b45cbe3934d0daa074a2cfba13f",c.callServer,void 0,c.findSourceMapURL,"getDocumentDownloadUrl");var v=r(93293),h=r(89064),g=r(70392),f=r(68671),b=r(23403),j=r(35947),N=r(85605),y=r(22607),_=r(62490),E=r(94724),w=r(66383);w.Ik({case_id:w.Yj().uuid("ID de caso inv\xe1lido"),nombre:w.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres"),visibilidad:w.k5(["privado","cliente"]).default("privado"),file:w.bz().optional()}),w.Ik({nombre:w.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres").optional(),visibilidad:w.k5(["privado","cliente"]).optional()}),w.Ik({case_id:w.Yj().uuid().optional(),visibilidad:w.k5(["privado","cliente"]).optional(),uploader_id:w.Yj().uuid().optional(),tipo_mime:w.Yj().optional(),search:w.Yj().optional(),page:w.ai().min(1).default(1),limit:w.ai().min(1).max(100).default(20)}),w.Ik({maxFileSize:w.ai().default(0x1400000),allowedTypes:w.YO(w.Yj()).default(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/gif","text/plain"])});let S={"application/pdf":{extension:"pdf",icon:"\uD83D\uDCC4",name:"PDF"},"application/msword":{extension:"doc",icon:"\uD83D\uDCDD",name:"Word"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{extension:"docx",icon:"\uD83D\uDCDD",name:"Word"},"image/jpeg":{extension:"jpg",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/png":{extension:"png",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/gif":{extension:"gif",icon:"\uD83D\uDDBC️",name:"Imagen"},"text/plain":{extension:"txt",icon:"\uD83D\uDCC4",name:"Texto"}};function C(e){let{caseId:a,canUpload:r=!1,canEdit:c=!1,canDelete:v=!1,showPrivateDocuments:y=!0}=e,[_,E]=(0,i.useState)([]),[w,C]=(0,i.useState)(!0),[A,R]=(0,i.useState)(!1),[D,I]=(0,i.useState)(null),[M,q]=(0,i.useState)(!1),z=(0,i.useRef)(null),{toast:L}=(0,l.dj)(),T=async()=>{C(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?E(e.documents):L({title:"Error",description:e.error||"Error al cargar documentos",variant:"destructive"})}catch(e){console.error("Error loading documents:",e),L({title:"Error",description:"Error inesperado al cargar documentos",variant:"destructive"})}finally{C(!1)}};(0,i.useEffect)(()=>{T()},[a]);let F=async e=>{var r;let t=null==(r=e.target.files)?void 0:r[0];if(t){if(t.size>0x1400000)return void L({title:"Archivo demasiado grande",description:"El archivo debe ser menor a ".concat(20,"MB"),variant:"destructive"});if(!Object.keys(S).includes(t.type))return void L({title:"Tipo de archivo no permitido",description:"Solo se permiten archivos PDF, Word, im\xe1genes y texto",variant:"destructive"});R(!0);try{let e=new FormData;e.append("file",t),e.append("case_id",a),e.append("nombre",t.name),e.append("visibilidad","privado");let r=await (0,p.X)(e);r.success?(L({title:"Documento subido",description:"El documento ha sido subido exitosamente"}),q(!1),await T()):L({title:"Error",description:r.error||"Error al subir el documento",variant:"destructive"})}catch(e){console.error("Error uploading document:",e),L({title:"Error",description:"Error inesperado al subir el documento",variant:"destructive"})}finally{R(!1),z.current&&(z.current.value="")}}},P=async(e,a)=>{try{let r=await m(e,a);r.success?(L({title:"Documento actualizado",description:"El documento ha sido actualizado exitosamente"}),I(null),await T()):L({title:"Error",description:r.error||"Error al actualizar el documento",variant:"destructive"})}catch(e){console.error("Error updating document:",e),L({title:"Error",description:"Error inesperado al actualizar el documento",variant:"destructive"})}},U=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este documento?"))try{let a=await u(e);a.success?(L({title:"Documento eliminado",description:"El documento ha sido eliminado exitosamente"}),await T()):L({title:"Error",description:a.error||"Error al eliminar el documento",variant:"destructive"})}catch(e){console.error("Error deleting document:",e),L({title:"Error",description:"Error inesperado al eliminar el documento",variant:"destructive"})}},Y=async(e,a)=>{try{let r=await x(e);if(r.success&&r.url){let e=document.createElement("a");e.href=r.url,e.download=a,document.body.appendChild(e),e.click(),document.body.removeChild(e),L({title:"Descarga iniciada",description:"El documento se est\xe1 descargando"})}else L({title:"Error",description:r.error||"Error al generar enlace de descarga",variant:"destructive"})}catch(e){console.error("Error downloading document:",e),L({title:"Error",description:"Error inesperado al descargar el documento",variant:"destructive"})}},$=e=>{let a=S[e];return a?a.icon:"\uD83D\uDCC4"},Z=e=>"cliente"===e?(0,t.jsx)(h.A,{className:"h-4 w-4 text-blue-600"}):(0,t.jsx)(g.A,{className:"h-4 w-4 text-gray-600"}),B=e=>"cliente"===e?(0,t.jsx)(o.E,{variant:"default",children:"Cliente"}):(0,t.jsx)(o.E,{variant:"secondary",children:"Privado"}),W=y?_:_.filter(e=>"cliente"===e.visibilidad);return w?(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Documentos"]})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(b.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Documentos (",W.length,")"]}),r&&(0,t.jsxs)(s.$,{size:"sm",onClick:()=>q(!M),disabled:A,children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Subir Documento"]})]})}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[M&&r&&(0,t.jsx)(n.Zp,{className:"border-dashed",children:(0,t.jsx)(n.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Seleccionar archivo"}),(0,t.jsx)("input",{ref:z,type:"file",onChange:F,accept:Object.keys(S).join(","),className:"form-input",disabled:A}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["M\xe1ximo ",20,"MB. Formatos: PDF, Word, im\xe1genes, texto"]})]}),A&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 animate-spin"}),"Subiendo archivo..."]}),(0,t.jsx)("div",{className:"flex justify-end space-x-2",children:(0,t.jsx)(s.$,{variant:"outline",onClick:()=>q(!1),disabled:A,children:"Cancelar"})})]})})}),(0,t.jsx)("div",{className:"space-y-3",children:W.map(e=>(0,t.jsx)(k,{document:e,canEdit:c,canDelete:v,isEditing:D===e.id,onEdit:()=>I(e.id),onCancelEdit:()=>I(null),onSave:a=>P(e.id,a),onDelete:()=>U(e.id),onDownload:()=>Y(e.id,e.nombre),getFileIcon:$,getVisibilityIcon:Z,getVisibilityBadge:B},e.id))}),0===W.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(N.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"No hay documentos para este caso"}),r&&(0,t.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Subir Documento" para agregar el primer documento'})]})]})]})}function k(e){var a;let{document:r,canEdit:o,canDelete:l,isEditing:c,onEdit:d,onCancelEdit:p,onSave:m,onDelete:u,onDownload:x,getFileIcon:h,getVisibilityIcon:g,getVisibilityBadge:f}=e,[b,j]=(0,i.useState)({nombre:r.nombre,visibilidad:r.visibilidad});return(0,t.jsx)(n.Zp,{className:"border-l-4 border-l-green-500",children:(0,t.jsx)(n.Wu,{className:"pt-4",children:(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-2xl",children:h(r.tipo_mime||"")}),(0,t.jsxs)("div",{children:[c?(0,t.jsx)("input",{type:"text",value:b.nombre,onChange:e=>j({...b,nombre:e.target.value}),className:"form-input text-sm"}):(0,t.jsx)("h4",{className:"font-medium text-gray-900",children:r.nombre}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[g(r.visibilidad||"privado"),c?(0,t.jsxs)("select",{value:b.visibilidad,onChange:e=>j({...b,visibilidad:e.target.value}),className:"form-input text-xs",children:[(0,t.jsx)("option",{value:"privado",children:"Privado"}),(0,t.jsx)("option",{value:"cliente",children:"Cliente"})]}):f(r.visibilidad||"privado"),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:(0,v.v7)(r.size_bytes||0)})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Subido por ",(null==(a=r.uploader)?void 0:a.nombre)||"Usuario"," • ",(0,v.fw)(r.created_at)]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(s.$,{variant:"ghost",size:"sm",onClick:x,children:(0,t.jsx)(y.A,{className:"h-4 w-4"})}),o&&(0,t.jsx)(t.Fragment,{children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.$,{variant:"ghost",size:"sm",onClick:p,children:"Cancelar"}),(0,t.jsx)(s.$,{size:"sm",onClick:()=>{b.nombre.trim()&&m(b)},children:"Guardar"})]}):(0,t.jsx)(s.$,{variant:"ghost",size:"sm",onClick:d,children:(0,t.jsx)(_.A,{className:"h-4 w-4"})})}),l&&!c&&(0,t.jsx)(s.$,{variant:"ghost",size:"sm",onClick:u,children:(0,t.jsx)(E.A,{className:"h-4 w-4"})})]})]})})})}},25711:(e,a,r)=>{r.d(a,{L:()=>R});var t=r(11291),i=r(97451),s=r(90718),n=r(82596),o=r(9983),l=r(68630),c=r(59030);let d=(0,c.createServerReference)("409b0a64c97bfe61b6e8814829fd1beb5b3c0ce84b",c.callServer,void 0,c.findSourceMapURL,"getInfoRequests"),p=(0,c.createServerReference)("40590b8aeb9cfa434beea52a3b54560f16fb3251f6",c.callServer,void 0,c.findSourceMapURL,"createInfoRequest"),m=(0,c.createServerReference)("606404fa1c57a53adafcdadd0b4189028f4b743e65",c.callServer,void 0,c.findSourceMapURL,"respondInfoRequest"),u=(0,c.createServerReference)("40b3ae676bee74d4c392577de287d9a07360d67bdc",c.callServer,void 0,c.findSourceMapURL,"closeInfoRequest");var x=r(93293),v=r(71428),h=r(96843),g=r(38417),f=r(64501),b=r(23403),j=r(35947),N=r(11762),y=r(27416),_=r(90465),E=r(91969),w=r(49833),S=r(66383);S.Ik({case_id:S.Yj().uuid("ID de caso inv\xe1lido"),titulo:S.Yj().min(1,"El t\xedtulo es requerido").max(200,"El t\xedtulo no puede exceder 200 caracteres"),descripcion:S.Yj().min(1,"La descripci\xf3n es requerida").max(2e3,"La descripci\xf3n no puede exceder 2000 caracteres"),tipo:S.k5(["documento","informacion","reunion","otro"]).default("informacion"),prioridad:S.k5(["baja","media","alta","urgente"]).default("media"),fecha_limite:S.Yj().optional(),es_publica:S.zM().default(!0)}).partial().omit({case_id:!0}),S.Ik({respuesta:S.Yj().min(1,"La respuesta es requerida").max(2e3,"La respuesta no puede exceder 2000 caracteres"),archivo_adjunto:S.Yj().optional()}),S.Ik({case_id:S.Yj().uuid().optional(),estado:S.k5(["pendiente","en_revision","respondida","cerrada"]).optional(),tipo:S.k5(["documento","informacion","reunion","otro"]).optional(),prioridad:S.k5(["baja","media","alta","urgente"]).optional(),creador_id:S.Yj().uuid().optional(),es_publica:S.zM().optional(),fecha_desde:S.Yj().optional(),fecha_hasta:S.Yj().optional(),search:S.Yj().optional(),page:S.ai().min(1).default(1),limit:S.ai().min(1).max(100).default(20)});let C=[{value:"documento",label:"Documento",description:"Solicitud de documentos espec\xedficos"},{value:"informacion",label:"Informaci\xf3n",description:"Solicitud de informaci\xf3n general"},{value:"reunion",label:"Reuni\xf3n",description:"Solicitud de reuni\xf3n o cita"},{value:"otro",label:"Otro",description:"Otro tipo de solicitud"}],k=[{value:"pendiente",label:"Pendiente",color:"yellow"},{value:"en_revision",label:"En Revisi\xf3n",color:"blue"},{value:"respondida",label:"Respondida",color:"green"},{value:"cerrada",label:"Cerrada",color:"gray"}],A=[{value:"baja",label:"Baja",color:"gray"},{value:"media",label:"Media",color:"blue"},{value:"alta",label:"Alta",color:"orange"},{value:"urgente",label:"Urgente",color:"red"}];function R(e){let{caseId:a,canCreateRequests:r=!1,canRespondRequests:o=!1,showPrivateRequests:c=!0}=e,[x,N]=(0,i.useState)([]),[y,_]=(0,i.useState)(!0),[E,w]=(0,i.useState)(!1),[S,R]=(0,i.useState)(null),[I,M]=(0,i.useState)(!1),[q,z]=(0,i.useState)({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0}),[L,T]=(0,i.useState)({respuesta:"",archivo_adjunto:""}),{toast:F}=(0,l.dj)(),P=async()=>{_(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?N(e.requests):F({title:"Error",description:e.error||"Error al cargar solicitudes",variant:"destructive"})}catch(e){console.error("Error loading requests:",e),F({title:"Error",description:"Error inesperado al cargar solicitudes",variant:"destructive"})}finally{_(!1)}};(0,i.useEffect)(()=>{P()},[a]);let U=async()=>{if(!q.titulo.trim()||!q.descripcion.trim())return void F({title:"Error",description:"El t\xedtulo y la descripci\xf3n son requeridos",variant:"destructive"});w(!0);try{let e={case_id:a,titulo:q.titulo.trim(),descripcion:q.descripcion.trim(),tipo:q.tipo,prioridad:q.prioridad,fecha_limite:q.fecha_limite||void 0,es_publica:q.es_publica},r=await p(e);r.success?(F({title:"Solicitud creada",description:"La solicitud ha sido creada exitosamente"}),z({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0}),M(!1),await P()):F({title:"Error",description:r.error||"Error al crear la solicitud",variant:"destructive"})}catch(e){console.error("Error creating request:",e),F({title:"Error",description:"Error inesperado al crear la solicitud",variant:"destructive"})}finally{w(!1)}},Y=async e=>{if(!L.respuesta.trim())return void F({title:"Error",description:"La respuesta es requerida",variant:"destructive"});try{let a={respuesta:L.respuesta.trim(),archivo_adjunto:L.archivo_adjunto||void 0},r=await m(e,a);r.success?(F({title:"Respuesta enviada",description:"La respuesta ha sido enviada exitosamente"}),T({respuesta:"",archivo_adjunto:""}),R(null),await P()):F({title:"Error",description:r.error||"Error al enviar la respuesta",variant:"destructive"})}catch(e){console.error("Error responding to request:",e),F({title:"Error",description:"Error inesperado al enviar la respuesta",variant:"destructive"})}},$=async e=>{try{let a=await u(e);a.success?(F({title:"Solicitud cerrada",description:"La solicitud ha sido cerrada"}),await P()):F({title:"Error",description:a.error||"Error al cerrar la solicitud",variant:"destructive"})}catch(e){console.error("Error closing request:",e),F({title:"Error",description:"Error inesperado al cerrar la solicitud",variant:"destructive"})}},Z=e=>{switch(e){case"respondida":return(0,t.jsx)(v.A,{className:"h-5 w-5 text-green-600"});case"en_revision":return(0,t.jsx)(h.A,{className:"h-5 w-5 text-blue-600"});case"cerrada":return(0,t.jsx)(g.A,{className:"h-5 w-5 text-gray-600"});default:return(0,t.jsx)(f.A,{className:"h-5 w-5 text-yellow-600"})}},B=e=>{let a=k.find(a=>a.value===e);return a?(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({yellow:"bg-yellow-100 text-yellow-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",gray:"bg-gray-100 text-gray-800"}[a.color]),children:a.label}):null},W=e=>{let a=A.find(a=>a.value===e);return a?(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat({gray:"bg-gray-100 text-gray-800",blue:"bg-blue-100 text-blue-800",orange:"bg-orange-100 text-orange-800",red:"bg-red-100 text-red-800"}[a.color]),children:a.label}):null},O=e=>{let a=C.find(a=>a.value===e);return a?a.label:e},V=c?x:x.filter(e=>e.es_publica);return y?(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Solicitudes de Informaci\xf3n"]})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(b.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Solicitudes de Informaci\xf3n (",V.length,")"]}),r&&(0,t.jsxs)(s.$,{size:"sm",onClick:()=>M(!I),disabled:E,children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Nueva Solicitud"]})]})}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[I&&r&&(0,t.jsx)(n.Zp,{className:"border-dashed",children:(0,t.jsx)(n.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"T\xedtulo *"}),(0,t.jsx)("input",{type:"text",value:q.titulo,onChange:e=>z({...q,titulo:e.target.value}),placeholder:"T\xedtulo de la solicitud",className:"form-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Descripci\xf3n *"}),(0,t.jsx)("textarea",{value:q.descripcion,onChange:e=>z({...q,descripcion:e.target.value}),placeholder:"Describe detalladamente lo que necesitas...",rows:4,className:"form-input"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tipo"}),(0,t.jsx)("select",{value:q.tipo,onChange:e=>z({...q,tipo:e.target.value}),className:"form-input",children:C.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prioridad"}),(0,t.jsx)("select",{value:q.prioridad,onChange:e=>z({...q,prioridad:e.target.value}),className:"form-input",children:A.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fecha l\xedmite (opcional)"}),(0,t.jsx)("input",{type:"date",value:q.fecha_limite,onChange:e=>z({...q,fecha_limite:e.target.value}),className:"form-input"})]})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:q.es_publica,onChange:e=>z({...q,es_publica:e.target.checked})}),(0,t.jsx)("span",{className:"text-sm",children:"Visible para el abogado"})]})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(s.$,{variant:"outline",onClick:()=>{M(!1),z({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0})},disabled:E,children:"Cancelar"}),(0,t.jsx)(s.$,{onClick:U,disabled:E,children:E?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Creando..."]}):"Crear Solicitud"})]})]})})}),(0,t.jsx)("div",{className:"space-y-3",children:V.map(e=>(0,t.jsx)(D,{request:e,canRespond:o,isResponding:S===e.id,response:L,onStartResponding:()=>R(e.id),onCancelResponding:()=>{R(null),T({respuesta:"",archivo_adjunto:""})},onResponseChange:T,onSendResponse:()=>Y(e.id),onClose:()=>$(e.id),getStatusIcon:Z,getStatusBadge:B,getPriorityBadge:W,getTypeIcon:O},e.id))}),0===V.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(f.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"No hay solicitudes de informaci\xf3n"}),r&&(0,t.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Solicitud" para crear la primera solicitud'})]})]})]})}function D(e){var a,r;let{request:i,canRespond:l,isResponding:c,response:d,onStartResponding:p,onCancelResponding:m,onResponseChange:u,onSendResponse:v,onClose:h,getStatusIcon:f,getStatusBadge:b,getPriorityBadge:j,getTypeIcon:S}=e,C=i.fecha_limite&&(0,x.m7)(i.fecha_limite)&&"respondida"!==i.estado&&"cerrada"!==i.estado;return(0,t.jsx)(n.Zp,{className:"border-l-4 ".concat(C?"border-l-red-500":"border-l-blue-500"),children:(0,t.jsxs)(n.Wu,{className:"pt-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[f(i.estado||"pendiente"),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900",children:i.titulo}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[b(i.estado||"pendiente"),j(i.prioridad||"media"),(0,t.jsx)(o.E,{variant:"outline",children:S(i.tipo||"informacion")}),!i.es_publica&&(0,t.jsx)(o.E,{variant:"outline",children:"Privada"})]})]})]}),C&&(0,t.jsx)(N.A,{className:"h-5 w-5 text-red-500"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:i.descripcion}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(y.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:(null==(a=i.creador)?void 0:a.nombre)||"Usuario"})]}),(0,t.jsx)("span",{children:(0,x.fw)(i.created_at)}),i.fecha_limite&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(_.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{className:C?"text-red-600 font-medium":"",children:["L\xedmite: ",new Date(i.fecha_limite).toLocaleDateString("es-CL")]})]})]}),i.respuesta&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(E.A,{className:"h-4 w-4 text-blue-600"}),(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Respuesta de ",(null==(r=i.respondido_por_profile)?void 0:r.nombre)||"Abogado"]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:i.respondido_at&&(0,x.fw)(i.respondido_at)})]}),(0,t.jsx)("p",{className:"text-sm text-gray-700",children:i.respuesta}),i.archivo_adjunto&&(0,t.jsx)("a",{href:i.archivo_adjunto,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Ver archivo adjunto"})]}),c&&(0,t.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mb-3",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("textarea",{value:d.respuesta,onChange:e=>u({...d,respuesta:e.target.value}),placeholder:"Escribe tu respuesta...",rows:3,className:"form-input"}),(0,t.jsx)("input",{type:"url",value:d.archivo_adjunto,onChange:e=>u({...d,archivo_adjunto:e.target.value}),placeholder:"URL del archivo adjunto (opcional)",className:"form-input"}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(s.$,{size:"sm",variant:"outline",onClick:m,children:"Cancelar"}),(0,t.jsxs)(s.$,{size:"sm",onClick:v,children:[(0,t.jsx)(w.A,{className:"h-4 w-4 mr-1"}),"Enviar Respuesta"]})]})]})}),l&&"cerrada"!==i.estado&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["respondida"!==i.estado&&!c&&(0,t.jsxs)(s.$,{size:"sm",variant:"outline",onClick:p,children:[(0,t.jsx)(E.A,{className:"h-4 w-4 mr-1"}),"Responder"]}),"respondida"===i.estado&&(0,t.jsxs)(s.$,{size:"sm",variant:"outline",onClick:h,children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-1"}),"Cerrar"]})]})]})})}},41782:(e,a,r)=>{r.d(a,{X:()=>i});var t=r(59030);let i=(0,t.createServerReference)("4075c1ceb223881a0e7965a110fc966b45d5dff05e",t.callServer,void 0,t.findSourceMapURL,"uploadDocument")},54997:(e,a,r)=>{r.d(a,{_:()=>y});var t=r(11291),i=r(97451),s=r(90718),n=r(82596),o=r(9983),l=r(68630),c=r(59030);let d=(0,c.createServerReference)("40c65ac279e16daf07c1a74f8b3ab765a3040f1ce2",c.callServer,void 0,c.findSourceMapURL,"getNotes"),p=(0,c.createServerReference)("4012b70a5d87f841ea19b6c7403670ab3f6f53982d",c.callServer,void 0,c.findSourceMapURL,"createNote"),m=(0,c.createServerReference)("60e9b52677848e6ec117b36775fbbc96c53c2d4b8b",c.callServer,void 0,c.findSourceMapURL,"updateNote"),u=(0,c.createServerReference)("40bcd3afb7420703f0e38188f3b26c056f4dd76913",c.callServer,void 0,c.findSourceMapURL,"deleteNote");var x=r(93293),v=r(66656),h=r(53464),g=r(65030),f=r(23403),b=r(35947),j=r(62490),N=r(94724);function y(e){let{caseId:a,canCreateNotes:r=!1,canEditNotes:c=!1,showPrivateNotes:x=!0}=e,[j,N]=(0,i.useState)([]),[y,E]=(0,i.useState)(!0),[w,S]=(0,i.useState)(!1),[C,k]=(0,i.useState)(null),[A,R]=(0,i.useState)({tipo:"privada",contenido:""}),{toast:D}=(0,l.dj)(),I=async()=>{E(!0);try{let e=await d({case_id:a,page:1,limit:50});e.success?N(e.notes):D({title:"Error",description:e.error||"Error al cargar notas",variant:"destructive"})}catch(e){console.error("Error loading notes:",e),D({title:"Error",description:"Error inesperado al cargar notas",variant:"destructive"})}finally{E(!1)}};(0,i.useEffect)(()=>{I()},[a]);let M=async()=>{if(!A.contenido.trim())return void D({title:"Error",description:"El contenido de la nota es requerido",variant:"destructive"});S(!0);try{let e={case_id:a,tipo:A.tipo,contenido:A.contenido.trim()},r=await p(e);r.success?(D({title:"Nota creada",description:"La nota ha sido creada exitosamente"}),R({tipo:"privada",contenido:""}),await I()):D({title:"Error",description:r.error||"Error al crear la nota",variant:"destructive"})}catch(e){console.error("Error creating note:",e),D({title:"Error",description:"Error inesperado al crear la nota",variant:"destructive"})}finally{S(!1)}},q=async(e,a)=>{try{let r=await m(e,{contenido:a.trim()});r.success?(D({title:"Nota actualizada",description:"La nota ha sido actualizada exitosamente"}),k(null),await I()):D({title:"Error",description:r.error||"Error al actualizar la nota",variant:"destructive"})}catch(e){console.error("Error updating note:",e),D({title:"Error",description:"Error inesperado al actualizar la nota",variant:"destructive"})}},z=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta nota?"))try{let a=await u(e);a.success?(D({title:"Nota eliminada",description:"La nota ha sido eliminada exitosamente"}),await I()):D({title:"Error",description:a.error||"Error al eliminar la nota",variant:"destructive"})}catch(e){console.error("Error deleting note:",e),D({title:"Error",description:"Error inesperado al eliminar la nota",variant:"destructive"})}},L=e=>"publica"===e?(0,t.jsx)(v.A,{className:"h-4 w-4 text-blue-600"}):(0,t.jsx)(h.A,{className:"h-4 w-4 text-gray-600"}),T=e=>"publica"===e?(0,t.jsx)(o.E,{variant:"default",children:"P\xfablica"}):(0,t.jsx)(o.E,{variant:"secondary",children:"Privada"}),F=x?j:j.filter(e=>"publica"===e.tipo);return y?(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-5 w-5"}),"Notas"]})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(f.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"h-5 w-5"}),"Notas (",F.length,")"]}),r&&(0,t.jsxs)(s.$,{size:"sm",onClick:()=>S(!w),disabled:w,children:[(0,t.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Nueva Nota"]})]})}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[w&&r&&(0,t.jsx)(n.Zp,{className:"border-dashed",children:(0,t.jsx)(n.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tipo de nota"}),(0,t.jsxs)("select",{value:A.tipo,onChange:e=>R({...A,tipo:e.target.value}),className:"form-input",children:[(0,t.jsx)("option",{value:"privada",children:"Privada (solo abogados)"}),(0,t.jsx)("option",{value:"publica",children:"P\xfablica (visible para cliente)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Contenido"}),(0,t.jsx)("textarea",{value:A.contenido,onChange:e=>R({...A,contenido:e.target.value}),placeholder:"Escribe tu nota aqu\xed...",rows:4,className:"form-input"})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(s.$,{variant:"outline",onClick:()=>{S(!1),R({tipo:"privada",contenido:""})},children:"Cancelar"}),(0,t.jsx)(s.$,{onClick:M,children:"Crear Nota"})]})]})})}),(0,t.jsx)("div",{className:"space-y-3",children:F.map(e=>(0,t.jsx)(_,{note:e,canEdit:c,isEditing:C===e.id,onEdit:()=>k(e.id),onCancelEdit:()=>k(null),onSave:a=>q(e.id,a),onDelete:()=>z(e.id),getTypeIcon:L,getTypeBadge:T},e.id))}),0===F.length&&(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(g.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"No hay notas para este caso"}),r&&(0,t.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Nota" para agregar la primera nota'})]})]})]})}function _(e){var a;let{note:r,canEdit:o,isEditing:l,onEdit:c,onCancelEdit:d,onSave:p,onDelete:m,getTypeIcon:u,getTypeBadge:v}=e,[h,g]=(0,i.useState)(r.contenido);return(0,t.jsx)(n.Zp,{className:"border-l-4 border-l-blue-500",children:(0,t.jsxs)(n.Wu,{className:"pt-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[u(r.tipo),v(r.tipo),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["por ",(null==(a=r.author)?void 0:a.nombre)||"Usuario"]}),(0,t.jsx)("span",{className:"text-sm text-gray-400",children:(0,x.fw)(r.created_at)})]}),o&&(0,t.jsx)("div",{className:"flex items-center gap-1",children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.$,{variant:"ghost",size:"sm",onClick:d,children:"Cancelar"}),(0,t.jsx)(s.$,{size:"sm",onClick:()=>{h.trim()&&p(h)},children:"Guardar"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.$,{variant:"ghost",size:"sm",onClick:c,children:(0,t.jsx)(j.A,{className:"h-4 w-4"})}),(0,t.jsx)(s.$,{variant:"ghost",size:"sm",onClick:m,children:(0,t.jsx)(N.A,{className:"h-4 w-4"})})]})})]}),l?(0,t.jsx)("textarea",{value:h,onChange:e=>g(e.target.value),rows:4,className:"form-input w-full"}):(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)("p",{className:"whitespace-pre-wrap text-gray-700",children:r.contenido})})]})})}},68630:(e,a,r)=>{r.d(a,{dj:()=>p});var t=r(97451);let i=0,s=new Map,n=e=>{if(s.has(e))return;let a=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,a)},o=[],l={toasts:[]};function c(e){l=((e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=a;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}})(l,e),o.forEach(e=>{e(l)})}function d(e){let{...a}=e,r=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),t=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...a,id:r,open:!0,onOpenChange:e=>{e||t()}}}),{id:r,dismiss:t,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function p(){let[e,a]=t.useState(l);return t.useEffect(()=>(o.push(a),()=>{let e=o.indexOf(a);e>-1&&o.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>c(e?{type:"DISMISS_TOAST",toastId:e}:{type:"DISMISS_TOAST"})}}},68668:(e,a,r)=>{r.d(a,{B:()=>h});var t=r(11291),i=r(97451),s=r(59030);let n=(0,s.createServerReference)("40117251fa73708d6ea58a8a7fc4a4d3f84edd2290",s.callServer,void 0,s.findSourceMapURL,"sendCaseMessage"),o=(0,s.createServerReference)("6033992cdb782388fc84bef8a2922fd17c703a695a",s.callServer,void 0,s.findSourceMapURL,"listCaseMessages");var l=r(90718),c=r(848),d=r(82596),p=r(9983),m=r(93293),u=r(23403),x=r(49833),v=r(68630);function h(e){let{caseId:a,initialMessages:r,currentProfileId:s,allowSend:h=!0}=e,[g,f]=(0,i.useState)(r),[b,j]=(0,i.useState)(""),[N,y]=(0,i.useTransition)(),[_,E]=(0,i.useState)(!1),{toast:w}=(0,v.dj)();(0,i.useEffect)(()=>{f(r)},[r,a]),(0,i.useEffect)(()=>{0===r.length&&C()},[a]);let S=(0,i.useMemo)(()=>g.slice().sort((e,a)=>new Date(e.created_at).getTime()-new Date(a.created_at).getTime()),[g]),C=async()=>{E(!0);try{let e=await o(a,{limit:100});f(e)}catch(a){var e;w({title:"Error al actualizar",description:null!=(e=null==a?void 0:a.message)?e:"No fue posible obtener los mensajes.",variant:"destructive"})}finally{E(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-lexser-gray-900",children:"Mensajes del caso"}),(0,t.jsx)(l.$,{variant:"outline",size:"sm",onClick:C,disabled:_,children:_?(0,t.jsx)(u.A,{className:"h-4 w-4 animate-spin"}):"Actualizar"})]}),(0,t.jsx)("div",{className:"space-y-4",children:0===S.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"A\xfan no hay mensajes para este caso."}):S.map(e=>{var a,r,i;let n=e.sender_profile_id===s;return(0,t.jsx)(d.Zp,{className:"border ".concat(n?"border-lexser-blue-200 bg-lexser-blue-50":"border-lexser-gray-100"),children:(0,t.jsxs)(d.Wu,{className:"p-4 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{children:[null!=(i=null==(a=e.sender)?void 0:a.nombre)?i:"Usuario",(null==(r=e.sender)?void 0:r.role)&&(0,t.jsx)(p.E,{variant:"outline",className:"ml-2 capitalize text-[10px]",children:e.sender.role})]}),(0,t.jsx)("span",{children:(0,m.r6)(e.created_at)})]}),(0,t.jsx)("p",{className:"text-sm text-lexser-gray-900 whitespace-pre-wrap",children:e.contenido}),e.attachment_url&&(0,t.jsx)("a",{href:e.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs font-medium text-lexser-blue-600 hover:text-lexser-blue-700",children:"Ver adjunto"})]})},e.id)})}),h&&(0,t.jsxs)("div",{className:"rounded-lg border border-lexser-gray-200 p-4 space-y-3",children:[(0,t.jsx)(c.T,{placeholder:"Escribe un mensaje para tu cliente o equipo...",value:b,onChange:e=>j(e.target.value),disabled:N,className:"min-h-[120px]"}),(0,t.jsx)("div",{className:"flex items-center justify-end",children:(0,t.jsxs)(l.$,{onClick:()=>{if(!b.trim())return void w({title:"Mensaje vac\xedo",description:"Escribe un mensaje antes de enviarlo.",variant:"destructive"});y(async()=>{try{let e=await n({caseId:a,contenido:b.trim()});f(a=>[...a,e]),j("")}catch(a){var e;w({title:"No se pudo enviar",description:null!=(e=null==a?void 0:a.message)?e:"Intenta nuevamente en unos minutos.",variant:"destructive"})}})},disabled:N,children:[N?(0,t.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"Enviar"]})})]})]})}},82596:(e,a,r)=>{r.d(a,{Wu:()=>c,ZB:()=>l,Zp:()=>n,aR:()=>o});var t=r(11291),i=r(97451),s=r(93293);let n=i.forwardRef((e,a)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,s.cn)("rounded-3xl border border-white/20 bg-white/70 text-card-foreground shadow-xl backdrop-blur-xl transition-colors",r),...i})});n.displayName="Card";let o=i.forwardRef((e,a)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 px-6 py-5",r),...i})});o.displayName="CardHeader";let l=i.forwardRef((e,a)=>{let{className:r,...i}=e;return(0,t.jsx)("h3",{ref:a,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",r),...i})});l.displayName="CardTitle",i.forwardRef((e,a)=>{let{className:r,...i}=e;return(0,t.jsx)("p",{ref:a,className:(0,s.cn)("text-sm text-muted-foreground",r),...i})}).displayName="CardDescription";let c=i.forwardRef((e,a)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,s.cn)("px-6 pb-6 pt-0 text-sm text-foreground/80",r),...i})});c.displayName="CardContent",i.forwardRef((e,a)=>{let{className:r,...i}=e;return(0,t.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",r),...i})}).displayName="CardFooter"},90718:(e,a,r)=>{r.d(a,{$:()=>c});var t=r(11291),i=r(97451),s=r(26809),n=r(11263),o=r(93293);let l=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-2xl text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ring-offset-transparent",{variants:{variant:{default:"border border-white/30 bg-white/70 text-foreground shadow-sm backdrop-blur-xl hover:bg-white/90 focus-visible:ring-primary/40 focus-visible:ring-offset-transparent",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/90 focus-visible:ring-destructive/40 focus-visible:ring-offset-transparent",outline:"border border-white/30 bg-transparent text-foreground/80 hover:bg-white/10 focus-visible:ring-primary/30 focus-visible:ring-offset-transparent",secondary:"border border-transparent bg-primary text-primary-foreground shadow-lg hover:bg-primary/90 focus-visible:ring-primary/40 focus-visible:ring-offset-transparent",ghost:"border border-transparent bg-transparent text-foreground/70 hover:bg-white/10",link:"text-primary underline-offset-4 hover:underline hover:text-primary/80"},size:{default:"h-10 px-5",sm:"h-9 rounded-xl px-3.5",lg:"h-12 rounded-2xl px-8 text-base",icon:"h-10 w-10 rounded-xl"}},defaultVariants:{variant:"default",size:"default"}}),c=i.forwardRef((e,a)=>{let{className:r,variant:i,size:n,asChild:c=!1,...d}=e,p=c?s.DX:"button";return(0,t.jsx)(p,{className:(0,o.cn)(l({variant:i,size:n,className:r})),ref:a,...d})});c.displayName="Button"},93293:(e,a,r)=>{r.d(a,{IM:()=>x,Yq:()=>c,cn:()=>o,fw:()=>m,kz:()=>d,m7:()=>v,nr:()=>u,qA:()=>g,r6:()=>p,v7:()=>h,vv:()=>l});var t=r(41111),i=r(98358);function s(e){return null!=e?e:""}function n(e){if(!e)return new Date("Invalid Date");let a="string"==typeof e?new Date(e):e;return isNaN(a.getTime())?new Date("Invalid Date"):a}function o(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,i.QP)((0,t.$)(a))}function l(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(e)}function c(e){let a=n(null!=e?e:null);return isNaN(a.getTime())?"":new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"long",day:"numeric"}).format(a)}function d(e){let a=n(null!=e?e:null);return isNaN(a.getTime())?"":new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"2-digit",day:"2-digit"}).format(a)}function p(e){let a=n(null!=e?e:null);return isNaN(a.getTime())?"":new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(a)}function m(e){let a=n(null!=e?e:null);if(isNaN(a.getTime()))return"Fecha inv\xe1lida";let r=(Date.now()-a.getTime())/1e3;return r<60?"hace unos segundos":r<3600?"hace ".concat(Math.floor(r/60)," minutos"):r<86400?"hace ".concat(Math.floor(r/3600)," horas"):r<2592e3?"hace ".concat(Math.floor(r/86400)," d\xedas"):r<31104e3?"hace ".concat(Math.floor(r/2592e3)," meses"):"hace ".concat(Math.floor(r/31104e3)," a\xf1os")}function u(e){let a=s(e).replace(/[^0-9kK]/g,"");if(a.length<8)return a;let r=a.slice(0,-1),t=a.slice(-1),i=r.replace(/\B(?=(\d{3})+(?!\d))/g,".");return"".concat(i,"-").concat(t)}function x(e){let a=s(e).trim();return a?a.split(/\s+/).map(e=>e[0]).join("").toUpperCase().slice(0,2):""}function v(e){let a=n(null!=e?e:null);if(isNaN(a.getTime()))return!1;let r=new Date;r.setHours(0,0,0,0);let t=new Date(a);return t.setHours(0,0,0,0),t<r}function h(e){let a="number"!=typeof e||isNaN(e)?0:e;if(a<=0)return"0 Bytes";let r=["Bytes","KB","MB","GB"],t=Math.min(Math.floor(Math.log(a)/Math.log(1024)),r.length-1),i=(a/Math.pow(1024,t)).toFixed(2);return"".concat(i," ").concat(r[t])}function g(e){let a=s(e),r=0;for(let e=0;e<a.length;e++)r=a.charCodeAt(e)+((r<<5)-r);let t=(r%360+360)%360;return"hsl(".concat(t,", 70%, 50%)")}}}]);