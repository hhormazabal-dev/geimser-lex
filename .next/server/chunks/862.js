"use strict";exports.id=862,exports.ids=[862],exports.modules={8618:(a,b,c)=>{c.d(b,{Wu:()=>j,ZB:()=>i,Zp:()=>g,aR:()=>h});var d=c(59356),e=c(56389),f=c(16815);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("rounded-3xl border border-white/20 bg-white/70 text-card-foreground shadow-xl backdrop-blur-xl transition-colors",a),...b}));g.displayName="Card";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex flex-col space-y-1.5 px-6 py-5",a),...b}));h.displayName="CardHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h3",{ref:c,className:(0,f.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));i.displayName="CardTitle",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("p",{ref:c,className:(0,f.cn)("text-sm text-muted-foreground",a),...b})).displayName="CardDescription";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("px-6 pb-6 pt-0 text-sm text-foreground/80",a),...b}));j.displayName="CardContent",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter"},60619:(a,b,c)=>{c.d(b,{Nf:()=>i,Rk:()=>g,oC:()=>h});var d=c(83273);let e={admin:"admin_firma",admin_firma:"admin_firma",adminfirma:"admin_firma","admin-firma":"admin_firma",adminlex:"admin_firma",firma_admin:"admin_firma",abogado:"abogado",analista:"analista",cliente:"cliente"};async function f(){let a=await (0,d.R)(),{data:b,error:c}=await a.auth.getUser();if(c||!b?.user)return console.warn("[AUTH] No hay usuario autenticado:",c),null;let f=b.user,g=f.id,h=function(a){let b=[],c=a.app_metadata??{},d=a.user_metadata??{};for(let a of(b.push(c.role,c.roles?.[0],c.user_role),b.push(d.role,d.roles?.[0],d.user_role),b.push(d.perfil_rol,d.profile_role,d.tipo,d.rol),(!0===c.claims_admin||!0===d.is_admin)&&b.push("admin_firma"),b)){let b=function a(b){if(null==b)return null;if(Array.isArray(b))return b.length?a(b[0]):null;if("boolean"==typeof b)return b?"admin_firma":null;let c=String(b).trim();return c?e[c.toLowerCase().replace(/[\s-]+/g,"_")]??null:null}(a);if(b)return b}return null}(f),{data:i,error:j}=await a.from("profiles").select("*").eq("id",g).maybeSingle();if(j)return console.error("[AUTH] Error seleccionando profiles por id:",j),null;if(i){let b=f.email??i.email??"";if(b&&b!==i.email){let{error:c}=await a.from("profiles").update({email:b}).eq("id",g);c&&console.warn("[AUTH] No se pudo sincronizar email en profiles:",c)}let c=f.user_metadata?.nombre??f.user_metadata?.name??null;if(c&&c!==i.nombre){let{error:b}=await a.from("profiles").update({nombre:String(c)}).eq("id",g);if(b)console.warn("[AUTH] No se pudo sincronizar nombre en profiles:",b);else{let{data:b}=await a.from("profiles").select("*").eq("id",g).maybeSingle();if(b){let a=h&&h!==b.role?h:null;return{...b,_role_override:a}}let c=h&&h!==i.role?h:null;return{...i,_role_override:c}}}if(h&&h!==i.role){let{data:b,error:c}=await a.from("profiles").update({role:h}).eq("id",g).select("*").maybeSingle();return c?(console.warn("[AUTH] No se pudo sincronizar rol en profiles:",c),{...i,_role_override:h??null}):b?{...b,_role_override:null}:(console.warn("[AUTH] Actualizaci\xf3n de rol no devolvi\xf3 datos, usando override local"),{...i,_role_override:h??null})}let d=h&&h!==i.role?h:null;return{...i,_role_override:d}}let k=f.user_metadata?.nombre??f.user_metadata?.name??(f.email??"").split("@")[0]??"Usuario",l={id:g,user_id:g,email:f.email??"",nombre:String(k),role:h??"cliente",activo:!0},{data:m,error:n}=await a.from("profiles").insert(l).select("*").maybeSingle();if(n)return console.error("[AUTH] Error creando perfil por primera vez:",n),null;if(console.info("[AUTH] Perfil creado autom\xe1ticamente:",{id:m?.id,email:m?.email,role:m?.role,metadataRole:h}),!m)return null;let o=h&&h!==m.role?h:null;return{...m,_role_override:o}}async function g(){let a=await f();if(!a)return null;let b=a._role_override,c=b??a.role??"cliente"??"cliente";return console.warn("[ROLE DEBUG] getCurrentProfile()",{auth_id:a.id,table_user_id:a.user_id,email:a.email,role_db:a.role,role_override:b,role_effective:c}),{...a,role:c}}async function h(a){let b=await g();if(!b)throw Error("No autenticado");let c=b.role;if(!a)return{...b,role:c};if(!(Array.isArray(a)?a:[a]).includes(c))throw Error("Sin permisos");return{...b,role:c}}async function i(a){return!0}},62481:(a,b,c)=>{c.d(b,{Ao:()=>j,NX:()=>m,Ud:()=>f,VX:()=>g,YN:()=>l,hd:()=>k,xp:()=>n});var d=c(73771),e=c(88852);function f(a){if("string"!=typeof a||0===a.trim().length)return!0;let b=a.replace(/[^0-9kK]/g,"");if(b.length<8||b.length>9)return!1;let c=b.slice(0,-1),d=b.slice(-1).toUpperCase(),e=0,f=2;for(let a=c.length-1;a>=0;a--)e+=parseInt(c[a],10)*f,f=7===f?2:f+1;let g=11-e%11;return d===(11===g?"0":10===g?"K":String(g))}let g=d.Yj().optional().refine(f,{message:"RUT inv\xe1lido"}),h=d.Ik({numero_causa:d.Yj().optional(),caratulado:d.Yj().min(1,"El caratulado es requerido").max(500,"El caratulado no puede exceder 500 caracteres"),materia:d.Yj().min(1,"La materia es requerida").max(1e3,"La materia no puede exceder 1000 caracteres"),tribunal:d.Yj().optional(),region:d.Yj().optional(),comuna:d.Yj().optional(),rut_cliente:g,nombre_cliente:d.Yj().min(1,"El nombre del cliente es requerido").max(1e3,"El nombre no puede exceder 1000 caracteres"),contraparte:d.Yj().optional(),etapa_actual:d.Yj().default("Ingreso Demanda"),estado:d.k5(["activo","suspendido","archivado","terminado"]).default("activo"),fecha_inicio:d.Yj().optional(),abogado_responsable:d.Yj().uuid("ID de abogado inv\xe1lido").optional(),analista_id:d.Yj().uuid("ID de analista inv\xe1lido").optional(),cliente_principal_id:d.Yj().uuid("ID de cliente inv\xe1lido"),workflow_state:d.k5(["preparacion","en_revision","activo","cerrado"]).default("preparacion"),prioridad:d.k5(["baja","media","alta","urgente"]).default("media"),valor_estimado:d.ai().positive("El valor debe ser positivo").optional(),honorario_total_uf:d.ai().nonnegative("El honorario total debe ser positivo").optional(),honorario_pagado_uf:d.ai().nonnegative("El monto pagado debe ser positivo").optional(),honorario_variable_porcentaje:d.ai().min(0,"El porcentaje variable debe ser positivo").max(100,"El porcentaje variable no puede superar 100%").optional(),honorario_variable_base:d.Yj().max(1e3,"La base variable no puede exceder 1000 caracteres").optional(),honorario_moneda:d.k5(["UF","CLP","USD"]).default("UF"),modalidad_cobro:d.k5(["prepago","postpago","mixto"]).default("prepago"),honorario_notas:d.Yj().max(2e3,"Las notas no pueden exceder 2000 caracteres").optional(),tarifa_referencia:d.Yj().max(1e3,"El identificador de tarifa no puede exceder 1000 caracteres").optional(),alcance_cliente_solicitado:d.ai().int("El alcance solicitado debe ser un n\xfamero entero").min(0,"El alcance solicitado no puede ser negativo").max(100,"El alcance solicitado no puede exceder 100 etapas").optional(),alcance_cliente_autorizado:d.ai().int("El alcance autorizado debe ser un n\xfamero entero").min(0,"El alcance autorizado no puede ser negativo").max(100,"El alcance autorizado no puede exceder 100 etapas").optional(),observaciones:d.Yj().optional(),descripcion_inicial:d.Yj().min(20,"Describe el contexto del caso con al menos 20 caracteres").max(2e3,"La descripci\xf3n inicial no puede exceder 2000 caracteres"),objetivo_cliente:d.Yj().max(1e3,"El objetivo del cliente no puede exceder 1000 caracteres").optional(),documentacion_recibida:d.Yj().max(2e3,"El listado de documentaci\xf3n no puede exceder 2000 caracteres").optional(),validado_at:d.Yj().optional().nullable(),marcar_validado:d.zM().optional()});function i(a,b){a.marcar_validado&&(a.abogado_responsable||b.addIssue({code:e.eq.custom,message:"Debes asignar un abogado responsable para validar el caso",path:["abogado_responsable"]}),a.cliente_principal_id||b.addIssue({code:e.eq.custom,message:"Debes vincular al menos un cliente principal para validar el caso",path:["cliente_principal_id"]}))}let j=h.superRefine((a,b)=>{i(a,b),a.cliente_principal_id||b.addIssue({code:e.eq.custom,message:"Selecciona un cliente principal antes de crear el caso.",path:["cliente_principal_id"]}),"number"==typeof a.honorario_total_uf&&"number"==typeof a.honorario_pagado_uf&&a.honorario_pagado_uf>a.honorario_total_uf&&b.addIssue({code:e.eq.custom,message:"El monto pagado no puede superar el honorario total.",path:["honorario_pagado_uf"]}),void 0!==a.alcance_cliente_autorizado&&void 0!==a.alcance_cliente_solicitado&&a.alcance_cliente_autorizado>a.alcance_cliente_solicitado&&b.addIssue({code:e.eq.custom,message:"El alcance autorizado no puede superar al alcance solicitado por el cliente.",path:["alcance_cliente_autorizado"]})}),k=h.partial().superRefine((a,b)=>{i(a,b),void 0!==a.honorario_total_uf&&void 0!==a.honorario_pagado_uf&&a.honorario_pagado_uf>(a.honorario_total_uf??0)&&b.addIssue({code:e.eq.custom,message:"El monto pagado no puede superar el honorario total.",path:["honorario_pagado_uf"]}),void 0!==a.alcance_cliente_autorizado&&void 0!==a.alcance_cliente_solicitado&&a.alcance_cliente_autorizado>(a.alcance_cliente_solicitado??0)&&b.addIssue({code:e.eq.custom,message:"El alcance autorizado no puede superar al alcance solicitado por el cliente.",path:["alcance_cliente_autorizado"]})}),l=d.Ik({brief:d.Yj().min(10,"El brief debe tener al menos 10 caracteres").max(2e3,"El brief no puede exceder 2000 caracteres"),overrides:h.partial().optional()}),m=d.Ik({case_id:d.Yj().uuid("ID de caso inv\xe1lido"),abogado_id:d.Yj().uuid("ID de abogado inv\xe1lido")}),n=d.Ik({estado:d.k5(["activo","suspendido","archivado","terminado"]).optional(),prioridad:d.k5(["baja","media","alta","urgente"]).optional(),abogado_responsable:d.Yj().uuid().optional(),materia:d.Yj().optional(),fecha_inicio_desde:d.Yj().optional(),fecha_inicio_hasta:d.Yj().optional(),search:d.Yj().optional(),page:d.ai().min(1).default(1),limit:d.ai().min(1).max(100).default(10)});d.Ik({abogado_id:d.Yj().uuid().optional(),fecha_desde:d.Yj().optional(),fecha_hasta:d.Yj().optional()})},83273:(a,b,c)=>{c.d(b,{R:()=>i,r:()=>j});var d=c(88239),e=c(33294),f=c(5232);let g="https://xsvvdshbhaheqymquzjl.supabase.co",h=process.env.SUPABASE_SERVICE_ROLE_KEY;async function i(){let a=await (0,d.UL)();return(0,e.createServerClient)(g,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzdnZkc2hiaGFoZXF5bXF1empsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MDUxMTMsImV4cCI6MjA3NTA4MTExM30.exy4Scb4paVi8tGs_-FXuHpIW9OFsbCS5sC8J_XdLv8",{cookies:{get:b=>a.get(b)?.value,set(b,c,d){try{d?a.set(b,c,d):a.set(b,c)}catch{}},remove(b,c){try{c?a.set(b,"",{...c,expires:new Date(0)}):a.set(b,"",{expires:new Date(0)})}catch{}}}})}function j(){return(0,f.UU)(g,h,{auth:{persistSession:!1}})}}};