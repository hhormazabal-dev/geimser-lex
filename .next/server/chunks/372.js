"use strict";exports.id=372,exports.ids=[372],exports.modules={8618:(a,b,c)=>{c.d(b,{Wu:()=>j,ZB:()=>i,Zp:()=>g,aR:()=>h});var d=c(59356),e=c(56389),f=c(16815);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));g.displayName="Card";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex flex-col space-y-1.5 p-6",a),...b}));h.displayName="CardHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h3",{ref:c,className:(0,f.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));i.displayName="CardTitle",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("p",{ref:c,className:(0,f.cn)("text-sm text-muted-foreground",a),...b})).displayName="CardDescription";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("p-6 pt-0",a),...b}));j.displayName="CardContent",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter"},23024:(a,b,c)=>{c.d(b,{CT:()=>j,ON:()=>e,T4:()=>h,l6:()=>f,rw:()=>g});var d=c(73771);let e=d.Ik({case_id:d.Yj().uuid("ID de caso inv\xe1lido"),etapa:d.Yj().min(1,"El nombre de la etapa es requerido").max(100,"El nombre no puede exceder 100 caracteres"),descripcion:d.Yj().optional(),fecha_programada:d.Yj().optional(),fecha_completada:d.Yj().optional(),estado:d.k5(["pendiente","en_proceso","completado"]).default("pendiente"),es_publica:d.zM().default(!0),orden:d.ai().int().positive("El orden debe ser un n\xfamero positivo"),responsable_id:d.Yj().uuid("ID de responsable inv\xe1lido").optional()}),f=e.partial().omit({case_id:!0}),g=d.Ik({fecha_completada:d.Yj().optional(),observaciones:d.Yj().optional()}),h=d.Ik({case_id:d.Yj().uuid().optional(),estado:d.k5(["pendiente","en_proceso","completado"]).optional(),responsable_id:d.Yj().uuid().optional(),es_publica:d.zM().optional(),fecha_desde:d.Yj().optional(),fecha_hasta:d.Yj().optional(),page:d.ai().min(1).default(1),limit:d.ai().min(1).max(100).default(20)}),i={Civil:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda con antecedentes y revisi\xf3n formal del tribunal.",diasEstimados:0},{etapa:"Notificaci\xf3n a la contraparte",descripcion:"Gestiones de notificaci\xf3n personal o por c\xe9dula al demandado.",diasEstimados:30},{etapa:"Contestaci\xf3n de la demanda",descripcion:"Plazo legal para que la contraparte conteste y proponga excepciones.",diasEstimados:20},{etapa:"R\xe9plicas y d\xfaplicas",descripcion:"Intercambio de escritos aclarando puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia preparatoria",descripcion:"Fijaci\xf3n de puntos de prueba y acuerdos probatorios.",diasEstimados:30},{etapa:"Periodo probatorio",descripcion:"Recepci\xf3n de declaraciones, oficios, peritajes y documental.",diasEstimados:45},{etapa:"Alegatos y vista de la causa",descripcion:"Audiencia de cierre donde las partes exponen sus argumentos finales.",diasEstimados:20},{etapa:"Sentencia de primera instancia",descripcion:"Redacci\xf3n y publicaci\xf3n del fallo por el tribunal.",diasEstimados:60},{etapa:"Recursos y cumplimiento",descripcion:"Interposici\xf3n de recursos o cumplimiento voluntario/forzado.",diasEstimados:30}],Comercial:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda y verificaci\xf3n formal.",diasEstimados:0},{etapa:"Notificaci\xf3n demandado",descripcion:"Gesti\xf3n de notificaci\xf3n a la contraparte y acreditaci\xf3n en autos.",diasEstimados:20},{etapa:"Contestaci\xf3n y reconvenci\xf3n",descripcion:"Respuesta del demandado y eventuales reconvenciones.",diasEstimados:20},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de hechos a probar y medios de prueba.",diasEstimados:25},{etapa:"Prueba y alegatos",descripcion:"Producci\xf3n de prueba documental, testimonial y alegatos finales.",diasEstimados:40},{etapa:"Sentencia",descripcion:"Decisi\xf3n del tribunal y notificaci\xf3n a las partes.",diasEstimados:45},{etapa:"Ejecuci\xf3n o recursos",descripcion:"Cumplimiento del fallo o tramitaci\xf3n de recursos.",diasEstimados:30}],Laboral:[{etapa:"Ingreso tutela o demanda laboral",descripcion:"Ingreso del escrito y asignaci\xf3n de audiencia preliminar.",diasEstimados:0},{etapa:"Citaciones y notificaci\xf3n empleador",descripcion:"Notificaci\xf3n de la demanda y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Intento de conciliaci\xf3n y fijaci\xf3n de puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Producci\xf3n de prueba y alegatos finales.",diasEstimados:20},{etapa:"Sentencia laboral",descripcion:"Pronunciamiento del tribunal y notificaci\xf3n a las partes.",diasEstimados:15},{etapa:"Cumplimiento / Recurso de nulidad",descripcion:"Tramitaci\xf3n de recursos o ejecuci\xf3n de la sentencia.",diasEstimados:20}],Familia:[{etapa:"Ingreso demanda o escrito inicial",descripcion:"Ingreso de medida de protecci\xf3n o demanda ante tribunal de familia.",diasEstimados:0},{etapa:"Notificaci\xf3n y citaci\xf3n a audiencia",descripcion:"Notificaci\xf3n a la contraparte y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de puntos controvertidos y acumulaci\xf3n de prueba.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Presentaci\xf3n de prueba, declaraciones y alegatos.",diasEstimados:20},{etapa:"Sentencia",descripcion:"Redacci\xf3n y comunicaci\xf3n del fallo.",diasEstimados:20},{etapa:"Cumplimiento y seguimiento",descripcion:"Ejecuci\xf3n de medidas decretadas y seguimiento del cumplimiento.",diasEstimados:25}]};function j(a){if(!a)return i.Civil;let b=a.toLowerCase(),c=Object.keys(i).find(a=>a.toLowerCase()===b);return c?i[c]:i.Civil}},38388:(a,b,c)=>{c.d(b,{$:()=>j});var d=c(59356),e=c(56389),f=c(67339),g=c(28321),h=c(16815);let i=(0,g.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),j=e.forwardRef(({className:a,variant:b,size:c,asChild:e=!1,...g},j)=>{let k=e?f.DX:"button";return(0,d.jsx)(k,{className:(0,h.cn)(i({variant:b,size:c,className:a})),ref:j,...g})});j.displayName="Button"},56931:(a,b,c)=>{c.d(b,{UU:()=>h});var d=c(61776);c(70958);var e=c(88239),f=c(83273),g=c(60619);async function h(a){try{let b=await (0,g.Rk)();if(!b)return void console.warn("Attempted to log audit action without authenticated user");let c=await (0,f.R)(),d=await (0,e.b3)(),h={action:a.action,actor_id:b.id,entity_type:a.entity_type,entity_id:a.entity_id??null,diff_json:a.diff_json,ip_address:d.get("x-forwarded-for")??d.get("x-real-ip")??"unknown",user_agent:d.get("user-agent")??"unknown"},{error:i}=await c.from("audit_log").insert(h);i&&console.error("Error logging audit action:",i)}catch(a){console.error("Error in logAuditAction:",a)}}async function i(a,b){try{let c=await (0,g.Rk)();if(!c||"admin_firma"!==c.role)throw Error("Sin permisos para ver auditor\xeda");let d=await (0,f.R)(),{data:e,error:h}=await d.from("audit_log").select(`
        *,
        actor:profiles(nombre)
      `).eq("entity_type",a).eq("entity_id",b).order("created_at",{ascending:!1});if(h)throw console.error("Error fetching audit history:",h),Error("Error al obtener historial de auditor\xeda");return{success:!0,logs:e||[]}}catch(a){return console.error("Error in getAuditHistory:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",logs:[]}}}async function j(a=30){try{let b=await (0,g.Rk)();if(!b||"admin_firma"!==b.role)throw Error("Sin permisos para ver estad\xedsticas de auditor\xeda");let c=await (0,f.R)(),d=new Date;d.setDate(d.getDate()-a);let{data:e,error:h}=await c.from("audit_log").select("action, entity_type, created_at").gte("created_at",d.toISOString());if(h)throw console.error("Error fetching audit stats:",h),Error("Error al obtener estad\xedsticas de auditor\xeda");let i={},j={},k={};return(e??[]).forEach(a=>{if(a.action&&(i[a.action]=(i[a.action]||0)+1),a.entity_type&&(j[a.entity_type]=(j[a.entity_type]||0)+1),a.created_at){let b=new Date(a.created_at),c=isNaN(b.getTime())?null:b.toISOString().split("T")[0];c&&(k[c]=(k[c]||0)+1)}}),{success:!0,stats:{totalActions:e?.length||0,actionCounts:i,entityCounts:j,dailyActivity:k}}}catch(a){return console.error("Error in getAuditStats:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",stats:null}}}(0,c(92714).D)([h,i,j]),(0,d.A)(h,"40bbe3e656245168542fd3a8033360a3153f7866c7",null),(0,d.A)(i,"607d1dca140ba92578dd984fe3dafe6a69aef5ba12",null),(0,d.A)(j,"40955eb8801a00741395ef4acde4fdb9f61977fcfa",null)},60619:(a,b,c)=>{c.d(b,{Nf:()=>i,Rk:()=>g,oC:()=>h});var d=c(83273);let e={admin:"admin_firma",admin_firma:"admin_firma",adminfirma:"admin_firma","admin-firma":"admin_firma",adminlex:"admin_firma",firma_admin:"admin_firma",abogado:"abogado",analista:"analista",cliente:"cliente"};async function f(){let a=await (0,d.R)(),{data:b,error:c}=await a.auth.getUser();if(c||!b?.user)return console.warn("[AUTH] No hay usuario autenticado:",c),null;let f=b.user,g=f.id,h=function(a){let b=[],c=a.app_metadata??{},d=a.user_metadata??{};for(let a of(b.push(c.role,c.roles?.[0],c.user_role),b.push(d.role,d.roles?.[0],d.user_role),b.push(d.perfil_rol,d.profile_role,d.tipo,d.rol),(!0===c.claims_admin||!0===d.is_admin)&&b.push("admin_firma"),b)){let b=function a(b){if(null==b)return null;if(Array.isArray(b))return b.length?a(b[0]):null;if("boolean"==typeof b)return b?"admin_firma":null;let c=String(b).trim();return c?e[c.toLowerCase().replace(/[\s-]+/g,"_")]??null:null}(a);if(b)return b}return null}(f),{data:i,error:j}=await a.from("profiles").select("*").eq("id",g).maybeSingle();if(j)return console.error("[AUTH] Error seleccionando profiles por id:",j),null;if(i){let b=f.email??i.email??"";if(b&&b!==i.email){let{error:c}=await a.from("profiles").update({email:b}).eq("id",g);c&&console.warn("[AUTH] No se pudo sincronizar email en profiles:",c)}let c=f.user_metadata?.nombre??f.user_metadata?.name??null;if(c&&c!==i.nombre){let{error:b}=await a.from("profiles").update({nombre:String(c)}).eq("id",g);if(b)console.warn("[AUTH] No se pudo sincronizar nombre en profiles:",b);else{let{data:b}=await a.from("profiles").select("*").eq("id",g).maybeSingle();if(b){let a=h&&h!==b.role?h:null;return{...b,_role_override:a}}let c=h&&h!==i.role?h:null;return{...i,_role_override:c}}}if(h&&h!==i.role){let{data:b,error:c}=await a.from("profiles").update({role:h}).eq("id",g).select("*").maybeSingle();return c?(console.warn("[AUTH] No se pudo sincronizar rol en profiles:",c),{...i,_role_override:h??null}):b?{...b,_role_override:null}:(console.warn("[AUTH] Actualizaci\xf3n de rol no devolvi\xf3 datos, usando override local"),{...i,_role_override:h??null})}let d=h&&h!==i.role?h:null;return{...i,_role_override:d}}let k=f.user_metadata?.nombre??f.user_metadata?.name??(f.email??"").split("@")[0]??"Usuario",l={id:g,user_id:g,email:f.email??"",nombre:String(k),role:h??"cliente",activo:!0},{data:m,error:n}=await a.from("profiles").insert(l).select("*").maybeSingle();if(n)return console.error("[AUTH] Error creando perfil por primera vez:",n),null;if(console.info("[AUTH] Perfil creado autom\xe1ticamente:",{id:m?.id,email:m?.email,role:m?.role,metadataRole:h}),!m)return null;let o=h&&h!==m.role?h:null;return{...m,_role_override:o}}async function g(){let a=await f();if(!a)return null;let b=a._role_override,c=b??a.role??"cliente"??"cliente";return console.warn("[ROLE DEBUG] getCurrentProfile()",{auth_id:a.id,table_user_id:a.user_id,email:a.email,role_db:a.role,role_override:b,role_effective:c}),{...a,role:c}}async function h(a){let b=await g();if(!b)throw Error("No autenticado");let c=b.role;if(!a)return{...b,role:c};if(!(Array.isArray(a)?a:[a]).includes(c))throw Error("Sin permisos");return{...b,role:c}}async function i(a){return!0}},83273:(a,b,c)=>{c.d(b,{R:()=>i,r:()=>j});var d=c(88239),e=c(33294),f=c(5232);let g="https://xsvvdshbhaheqymquzjl.supabase.co",h=process.env.SUPABASE_SERVICE_ROLE_KEY;async function i(){let a=await (0,d.UL)();return(0,e.createServerClient)(g,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzdnZkc2hiaGFoZXF5bXF1empsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MDUxMTMsImV4cCI6MjA3NTA4MTExM30.exy4Scb4paVi8tGs_-FXuHpIW9OFsbCS5sC8J_XdLv8",{cookies:{get:b=>a.get(b)?.value,set(b,c,d){try{d?a.set(b,c,d):a.set(b,c)}catch{}},remove(b,c){try{c?a.set(b,"",{...c,expires:new Date(0)}):a.set(b,"",{expires:new Date(0)})}catch{}}}})}function j(){return(0,f.UU)(g,h,{auth:{persistSession:!1}})}}};