"use strict";exports.id=21,exports.ids=[21],exports.modules={66569:(a,b,c)=>{c.d(b,{CT:()=>g,E5:()=>i,Od:()=>h,pp:()=>j});var d=c(82968);d.Ik({case_id:d.Yj().uuid("ID de caso inv\xe1lido"),etapa:d.Yj().min(1,"El nombre de la etapa es requerido").max(1e3,"El nombre no puede exceder 1000 caracteres"),descripcion:d.Yj().optional(),fecha_programada:d.Yj().optional(),fecha_completada:d.Yj().optional(),estado:d.k5(["pendiente","en_proceso","completado"]).default("pendiente"),es_publica:d.zM().default(!0),orden:d.ai().int().positive("El orden debe ser un n\xfamero positivo"),responsable_id:d.Yj().uuid("ID de responsable inv\xe1lido").optional(),audiencia_tipo:d.k5(["preparatoria","juicio"]).optional(),requiere_testigos:d.zM().default(!1),requiere_pago:d.zM().default(!1),costo_uf:d.ai().min(0,"El costo debe ser positivo").optional(),porcentaje_variable:d.ai().min(0,"El porcentaje debe ser positivo").max(100,"El porcentaje no puede exceder 100").optional(),estado_pago:d.k5(["pendiente","en_proceso","parcial","pagado","vencido"]).default("pendiente"),enlace_pago:d.Yj().url("Debe ser una URL v\xe1lida").optional(),notas_pago:d.Yj().max(1e3,"Las notas no pueden exceder 1000 caracteres").optional(),monto_variable_base:d.Yj().optional(),monto_pagado_uf:d.ai().min(0,"El monto pagado debe ser positivo").optional()}).partial().omit({case_id:!0}),d.Ik({fecha_completada:d.Yj().optional(),observaciones:d.Yj().optional()}),d.Ik({case_id:d.Yj().uuid().optional(),estado:d.k5(["pendiente","en_proceso","completado"]).optional(),responsable_id:d.Yj().uuid().optional(),es_publica:d.zM().optional(),fecha_desde:d.Yj().optional(),fecha_hasta:d.Yj().optional(),page:d.ai().min(1).default(1),limit:d.ai().min(1).max(100).default(20)});let e={Civil:[.15,.1,.1,.1,.15,.2,.1,.05,.05],Comercial:[.2,.15,.15,.2,.15,.1,.05],Laboral:[.2,.2,.2,.2,.1,.1],Familia:[.2,.15,.15,.15,.2,.15]},f={Civil:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda con antecedentes y revisi\xf3n formal del tribunal.",diasEstimados:0},{etapa:"Notificaci\xf3n a la contraparte",descripcion:"Gestiones de notificaci\xf3n personal o por c\xe9dula al demandado.",diasEstimados:30},{etapa:"Contestaci\xf3n de la demanda",descripcion:"Plazo legal para que la contraparte conteste y proponga excepciones.",diasEstimados:20},{etapa:"R\xe9plicas y d\xfaplicas",descripcion:"Intercambio de escritos aclarando puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia preparatoria",descripcion:"Fijaci\xf3n de puntos de prueba y acuerdos probatorios.",diasEstimados:30},{etapa:"Periodo probatorio",descripcion:"Recepci\xf3n de declaraciones, oficios, peritajes y documental.",diasEstimados:45},{etapa:"Alegatos y vista de la causa",descripcion:"Audiencia de cierre donde las partes exponen sus argumentos finales.",diasEstimados:20},{etapa:"Sentencia de primera instancia",descripcion:"Redacci\xf3n y publicaci\xf3n del fallo por el tribunal.",diasEstimados:60},{etapa:"Recursos y cumplimiento",descripcion:"Interposici\xf3n de recursos o cumplimiento voluntario/forzado.",diasEstimados:30}],Comercial:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda y verificaci\xf3n formal.",diasEstimados:0},{etapa:"Notificaci\xf3n demandado",descripcion:"Gesti\xf3n de notificaci\xf3n a la contraparte y acreditaci\xf3n en autos.",diasEstimados:20},{etapa:"Contestaci\xf3n y reconvenci\xf3n",descripcion:"Respuesta del demandado y eventuales reconvenciones.",diasEstimados:20},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de hechos a probar y medios de prueba.",diasEstimados:25},{etapa:"Prueba y alegatos",descripcion:"Producci\xf3n de prueba documental, testimonial y alegatos finales.",diasEstimados:40},{etapa:"Sentencia",descripcion:"Decisi\xf3n del tribunal y notificaci\xf3n a las partes.",diasEstimados:45},{etapa:"Ejecuci\xf3n o recursos",descripcion:"Cumplimiento del fallo o tramitaci\xf3n de recursos.",diasEstimados:30}],Laboral:[{etapa:"Ingreso tutela o demanda laboral",descripcion:"Ingreso del escrito y asignaci\xf3n de audiencia preliminar.",diasEstimados:0},{etapa:"Citaciones y notificaci\xf3n empleador",descripcion:"Notificaci\xf3n de la demanda y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Intento de conciliaci\xf3n y fijaci\xf3n de puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Producci\xf3n de prueba y alegatos finales.",diasEstimados:20},{etapa:"Sentencia laboral",descripcion:"Pronunciamiento del tribunal y notificaci\xf3n a las partes.",diasEstimados:15},{etapa:"Cumplimiento / Recurso de nulidad",descripcion:"Tramitaci\xf3n de recursos o ejecuci\xf3n de la sentencia.",diasEstimados:20}],Familia:[{etapa:"Ingreso demanda o escrito inicial",descripcion:"Ingreso de medida de protecci\xf3n o demanda ante tribunal de familia.",diasEstimados:0},{etapa:"Notificaci\xf3n y citaci\xf3n a audiencia",descripcion:"Notificaci\xf3n a la contraparte y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de puntos controvertidos y acumulaci\xf3n de prueba.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Presentaci\xf3n de prueba, declaraciones y alegatos.",diasEstimados:20},{etapa:"Sentencia",descripcion:"Redacci\xf3n y comunicaci\xf3n del fallo.",diasEstimados:20},{etapa:"Cumplimiento y seguimiento",descripcion:"Ejecuci\xf3n de medidas decretadas y seguimiento del cumplimiento.",diasEstimados:25}]};function g(a){if(!a)return f.Civil;let b=a.toLowerCase(),c=Object.keys(f).find(a=>a.toLowerCase()===b),d=c?f[c]:f.Civil,g=c&&e[c]?e[c]:e.Civil??[];return d.map((a,b)=>({...a,porcentajeHonorario:g[b]??0}))}let h=[{value:"preparatoria",label:"Audiencia preparatoria"},{value:"juicio",label:"Audiencia de juicio"}],i=[{value:"pendiente",label:"Pendiente",color:"gray"},{value:"en_proceso",label:"En Proceso",color:"blue"},{value:"completado",label:"Completado",color:"green"}],j=[{value:"pendiente",label:"Pendiente",color:"gray"},{value:"solicitado",label:"Solicitado por cliente",color:"blue"},{value:"en_proceso",label:"En proceso",color:"amber"},{value:"parcial",label:"Pago parcial",color:"blue"},{value:"pagado",label:"Pagado",color:"green"},{value:"vencido",label:"Vencido",color:"red"}]},83527:(a,b,c)=>{c.d(b,{X:()=>e});var d=c(30724);let e=(0,d.createServerReference)("4075c1ceb223881a0e7965a110fc966b45d5dff05e",d.callServer,void 0,d.findSourceMapURL,"uploadDocument")},88932:(a,b,c)=>{c.d(b,{Nn:()=>p,_L:()=>r,Pe:()=>s,HK:()=>q,lU:()=>o,XX:()=>n});var d=c(61776);c(70958);var e=c(46221),f=c(83273),g=c(60619),h=c(56931),i=c(73771);let j=i.Ik({case_id:i.Yj().uuid("ID de caso inv\xe1lido"),nombre:i.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres"),visibilidad:i.k5(["privado","cliente"]).default("privado"),file:i.bz().optional()}),k=i.Ik({nombre:i.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres").optional(),visibilidad:i.k5(["privado","cliente"]).optional()}),l=i.Ik({case_id:i.Yj().uuid().optional(),visibilidad:i.k5(["privado","cliente"]).optional(),uploader_id:i.Yj().uuid().optional(),tipo_mime:i.Yj().optional(),search:i.Yj().optional(),page:i.ai().min(1).default(1),limit:i.ai().min(1).max(100).default(20)});i.Ik({maxFileSize:i.ai().default(0x1400000),allowedTypes:i.YO(i.Yj()).default(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/gif","text/plain"])});let m={"application/pdf":{extension:"pdf",icon:"\uD83D\uDCC4",name:"PDF"},"application/msword":{extension:"doc",icon:"\uD83D\uDCDD",name:"Word"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{extension:"docx",icon:"\uD83D\uDCDD",name:"Word"},"image/jpeg":{extension:"jpg",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/png":{extension:"png",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/gif":{extension:"gif",icon:"\uD83D\uDDBC️",name:"Imagen"},"text/plain":{extension:"txt",icon:"\uD83D\uDCC4",name:"Texto"}};async function n(a){try{let b=await (0,g.oC)(),c=a.get("case_id"),d=a.get("nombre"),i=a.get("visibilidad"),k=a.get("file");if(!k)throw Error("No se ha seleccionado ning\xfan archivo");let l=j.parse({case_id:c,nombre:d&&d.trim()||k.name,visibilidad:i||"privado"});if(!await (0,g.Nf)(l.case_id))throw Error("Sin permisos para acceder a este caso");if(k.size>0x1400000)throw Error(`El archivo es demasiado grande. M\xe1ximo ${Math.floor(20)}MB`);if(!Object.prototype.hasOwnProperty.call(m,k.type))throw Error("Tipo de archivo no permitido");let n=await (0,f.r)(),o=k.name.includes(".")?k.name.split(".").pop():"",p=Math.random().toString(36).slice(2,9),q=`${Date.now()}-${p}${o?"."+o:""}`,r=`cases/${l.case_id}/${q}`,{error:s}=await n.storage.from("documents").upload(r,k,{cacheControl:"3600",upsert:!1});if(s)throw console.error("Error uploading file:",s),Error("Error al subir el archivo");let{data:t}=n.storage.from("documents").getPublicUrl(r),u={case_id:l.case_id,uploader_id:b.id,nombre:l.nombre,tipo_mime:k.type,size_bytes:k.size,url:t.publicUrl,visibilidad:l.visibilidad},{data:v,error:w}=await n.from("documents").insert(u).select(`
        *,
        uploader:profiles(nombre),
        case:cases(caratulado)
      `).single();if(w)throw console.error("Error saving document metadata:",w),await n.storage.from("documents").remove([r]).catch(()=>{}),Error("Error al guardar los metadatos del documento");return await (0,h.UU)({action:"UPLOAD",entity_type:"document",entity_id:v.id,diff_json:{uploaded:u}}),(0,e.revalidatePath)(`/cases/${l.case_id}`),{success:!0,document:v}}catch(a){return console.error("Error in uploadDocument:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function o(a,b){try{let c=await (0,g.oC)(),d=k.parse(b),i=await (0,f.R)(),{data:j,error:l}=await i.from("documents").select("*").eq("id",a).single();if(l||!j)throw Error("Documento no encontrado");if("admin_firma"!==c.role&&j.uploader_id!==c.id)if("abogado"===c.role){if(!await (0,g.Nf)(j.case_id))throw Error("Sin permisos para editar este documento")}else throw Error("Sin permisos para editar este documento");let m={...void 0!==d.nombre&&{nombre:d.nombre},...void 0!==d.visibilidad&&{visibilidad:d.visibilidad}},{data:n,error:o}=await i.from("documents").update(m).eq("id",a).select(`
        *,
        uploader:profiles(nombre),
        case:cases(caratulado)
      `).single();if(o)throw console.error("Error updating document:",o),Error("Error al actualizar el documento");return await (0,h.UU)({action:"UPDATE",entity_type:"document",entity_id:a,diff_json:{from:j,to:n}}),(0,e.revalidatePath)(`/cases/${j.case_id}`),{success:!0,document:n}}catch(a){return console.error("Error in updateDocument:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function p(a){try{let b=await (0,g.oC)(),c=await (0,f.r)(),{data:d,error:i}=await c.from("documents").select("*").eq("id",a).single();if(i||!d)throw Error("Documento no encontrado");if("admin_firma"!==b.role&&d.uploader_id!==b.id)if("abogado"===b.role){if(!await (0,g.Nf)(d.case_id))throw Error("Sin permisos para eliminar este documento")}else throw Error("Sin permisos para eliminar este documento");let j=d.url.split("/").slice(-2).join("/"),{error:k}=await c.storage.from("documents").remove([j]);k&&console.error("Error deleting file from storage:",k);let{error:l}=await c.from("documents").delete().eq("id",a);if(l)throw console.error("Error deleting document metadata:",l),Error("Error al eliminar el documento");return await (0,h.UU)({action:"DELETE",entity_type:"document",entity_id:a,diff_json:{deleted:d}}),(0,e.revalidatePath)(`/cases/${d.case_id}`),{success:!0}}catch(a){return console.error("Error in deleteDocument:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function q(a={}){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c={...a??{}};null==c.page&&(c.page=1),null==c.limit&&(c.limit=10);let d=l.parse(c),e=await (0,f.R)(),h=e.from("documents").select(`
        *,
        uploader:profiles(id, nombre),
        case:cases(id, caratulado)
      `,{count:"exact"});if("cliente"===b.role){h=h.eq("visibilidad","cliente");let{data:a}=await e.from("case_clients").select("case_id").eq("client_profile_id",b.id),c=a?.map(a=>a.case_id)||[];if(0===c.length)return{success:!0,documents:[],total:0,page:d.page,limit:d.limit};h=h.in("case_id",c)}else if("abogado"===b.role){let{data:a}=await e.from("cases").select("id").eq("abogado_responsable",b.id),c=a?.map(a=>a.id)||[];if(0===c.length)return{success:!0,documents:[],total:0,page:d.page,limit:d.limit};h=h.in("case_id",c)}if(d.case_id){if(!await (0,g.Nf)(d.case_id))throw Error("Sin permisos para acceder a este caso");h=h.eq("case_id",d.case_id)}d.visibilidad&&(h=h.eq("visibilidad",d.visibilidad)),d.uploader_id&&(h=h.eq("uploader_id",d.uploader_id)),d.tipo_mime&&(h=h.eq("tipo_mime",d.tipo_mime)),d.search&&(h=h.ilike("nombre",`%${d.search}%`));let i=(d.page-1)*d.limit,j=i+d.limit-1,{data:k,error:m,count:n}=await h.range(i,j).order("created_at",{ascending:!1});if(m)throw console.error("Error fetching documents:",m),Error("Error al obtener documentos");return{success:!0,documents:k||[],total:n||0,page:d.page,limit:d.limit}}catch(a){return console.error("Error in getDocuments:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",documents:[],total:0}}}async function r(a){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c=await (0,f.R)(),{data:d,error:e}=await c.from("documents").select(`
        *,
        uploader:profiles(id, nombre),
        case:cases(id, caratulado)
      `).eq("id",a).single();if(e||!d)throw Error("Documento no encontrado");if(!await (0,g.Nf)(d.case_id)||"cliente"===b.role&&"privado"===d.visibilidad)throw Error("Sin permisos para ver este documento");return{success:!0,document:d}}catch(a){return console.error("Error in getDocumentById:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function s(a){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c=await (0,f.r)(),{data:d,error:e}=await c.from("documents").select("*").eq("id",a).single();if(e||!d)throw Error("Documento no encontrado");if(!await (0,g.Nf)(d.case_id)||"cliente"===b.role&&"privado"===d.visibilidad)throw Error("Sin permisos para descargar este documento");let i=null;try{let a=new URL(d.url),b="/storage/v1/object/public/";if(a.pathname.startsWith(b)){let[c,...d]=decodeURIComponent(a.pathname.slice(b.length)).split("/");"documents"===c&&d.length>0&&(i=d.join("/")||null)}}catch(a){console.warn("[documents] No se pudo parsear URL p\xfablica",a)}if(!i){let a=d.url.split("/documents/");2===a.length&&(i=a[1]||null)}if(!i)throw console.error("No se pudo resolver la ruta del archivo",d.url),Error("Error al preparar la descarga del documento");let{data:j,error:k}=await c.storage.from("documents").createSignedUrl(i,3600);if(k)throw console.error("Error creating signed URL:",k),Error("Error al generar URL de descarga");return await (0,h.UU)({action:"DOWNLOAD",entity_type:"document",entity_id:a,diff_json:{downloaded:!0}}),{success:!0,url:j.signedUrl}}catch(a){return console.error("Error in getDocumentDownloadUrl:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}(0,c(92714).D)([n,o,p,q,r,s]),(0,d.A)(n,"4075c1ceb223881a0e7965a110fc966b45d5dff05e",null),(0,d.A)(o,"60a05bb0cd24233599cf9f92c53da27432d198f23b",null),(0,d.A)(p,"40a5ed4d1a022e18d6d1f8ccc8da589a299ef3c127",null),(0,d.A)(q,"4068b2aad6bb5abca1df8e575b8900239c3f91e123",null),(0,d.A)(r,"402455740852fa04db8e397aa0d590c0a325656989",null),(0,d.A)(s,"404011b5219b751b45cbe3934d0daa074a2cfba13f",null)},98558:(a,b,c)=>{c.d(b,{T:()=>g});var d=c(59356),e=c(56389),f=c(16815);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("textarea",{ref:c,className:(0,f.cn)("flex min-h-[100px] w-full rounded-2xl border border-white/30 bg-white/70 px-4 py-3 text-sm text-foreground/80 shadow-inner transition-all placeholder:text-foreground/40 focus-visible:border-primary focus-visible:bg-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30 disabled:cursor-not-allowed disabled:opacity-60",a),...b}));g.displayName="Textarea"}};