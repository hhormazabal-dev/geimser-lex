"use strict";exports.id=433,exports.ids=[433],exports.modules={5358:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},6997:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},9562:(a,b,c)=>{c.d(b,{p4:()=>m,Iy:()=>o,jU:()=>q,CS:()=>p,w3:()=>n});var d=c(61776);c(70958);var e=c(46221),f=c(83273),g=c(60619),h=c(56931),i=c(73771);let j=i.Ik({case_id:i.Yj().uuid("ID de caso inv\xe1lido"),tipo:i.k5(["privada","publica"]).default("privada"),contenido:i.Yj().min(1,"El contenido es requerido").max(1e4,"El contenido no puede exceder 10,000 caracteres")}),k=i.Ik({tipo:i.k5(["privada","publica"]).optional(),contenido:i.Yj().min(1,"El contenido es requerido").max(1e4,"El contenido no puede exceder 10,000 caracteres").optional()}),l=i.Ik({case_id:i.Yj().uuid().optional(),tipo:i.k5(["privada","publica"]).optional(),author_id:i.Yj().uuid().optional(),search:i.Yj().optional(),page:i.ai().min(1).default(1),limit:i.ai().min(1).max(100).default(20)});async function m(a){try{let b=await (0,g.oC)(),c=j.parse(a);if(!await (0,g.Nf)(c.case_id))throw Error("Sin permisos para acceder a este caso");if("cliente"===b.role)throw Error("Sin permisos para crear notas");let d=await (0,f.R)(),i={...c,author_id:b.id},{data:k,error:l}=await d.from("notes").insert(i).select(`
        *,
        author:profiles(nombre),
        case:cases(caratulado)
      `).single();if(l)throw console.error("Error creating note:",l),Error("Error al crear la nota");return await (0,h.UU)({action:"CREATE",entity_type:"note",entity_id:k.id,diff_json:{created:i}}),c.tipo,(0,e.revalidatePath)(`/cases/${c.case_id}`),{success:!0,note:k}}catch(a){return console.error("Error in createNote:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function n(a,b){try{let c=await (0,g.oC)(),d=k.parse(b),i=await (0,f.R)(),{data:j,error:l}=await i.from("notes").select("*, case:cases(id)").eq("id",a).single();if(l||!j)throw Error("Nota no encontrada");if("admin_firma"!==c.role&&j.author_id!==c.id)throw Error("Sin permisos para editar esta nota");if(!await (0,g.Nf)(j.case_id))throw Error("Sin permisos para acceder a este caso");let m={};void 0!==d.contenido&&(m.contenido=d.contenido),void 0!==d.tipo&&(m.tipo=d.tipo);let{data:n,error:o}=await i.from("notes").update(m).eq("id",a).select(`
        *,
        author:profiles(nombre),
        case:cases(caratulado)
      `).single();if(o)throw console.error("Error updating note:",o),Error("Error al actualizar la nota");return await (0,h.UU)({action:"UPDATE",entity_type:"note",entity_id:a,diff_json:{from:j,to:n}}),(0,e.revalidatePath)(`/cases/${j.case_id}`),{success:!0,note:n}}catch(a){return console.error("Error in updateNote:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function o(a){try{let b=await (0,g.oC)(),c=await (0,f.R)(),{data:d,error:i}=await c.from("notes").select("*").eq("id",a).single();if(i||!d)throw Error("Nota no encontrada");if("admin_firma"!==b.role&&d.author_id!==b.id)throw Error("Sin permisos para eliminar esta nota");if(!await (0,g.Nf)(d.case_id))throw Error("Sin permisos para acceder a este caso");let{error:j}=await c.from("notes").delete().eq("id",a);if(j)throw console.error("Error deleting note:",j),Error("Error al eliminar la nota");return await (0,h.UU)({action:"DELETE",entity_type:"note",entity_id:a,diff_json:{deleted:d}}),(0,e.revalidatePath)(`/cases/${d.case_id}`),{success:!0}}catch(a){return console.error("Error in deleteNote:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function p(a){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c={page:1,limit:20,...a??{}},d=l.parse(c),e=await (0,f.R)(),h=e.from("notes").select(`
        *,
        author:profiles(id, nombre),
        case:cases(id, caratulado)
      `,{count:"exact"});if("cliente"===b.role){h=h.eq("tipo","publica");let{data:a}=await e.from("case_clients").select("case_id").eq("client_profile_id",b.id),c=a?.map(a=>a.case_id)||[];if(0===c.length)return{success:!0,notes:[],total:0,page:d.page,limit:d.limit};h=h.in("case_id",c)}else if("abogado"===b.role){let{data:a}=await e.from("cases").select("id").eq("abogado_responsable",b.id),c=a?.map(a=>a.id)||[];if(0===c.length)return{success:!0,notes:[],total:0,page:d.page,limit:d.limit};h=h.in("case_id",c)}if(d.case_id){if(!await (0,g.Nf)(d.case_id))throw Error("Sin permisos para acceder a este caso");h=h.eq("case_id",d.case_id)}d.tipo&&(h=h.eq("tipo",d.tipo)),d.author_id&&(h=h.eq("author_id",d.author_id)),d.search&&(h=h.ilike("contenido",`%${d.search}%`));let i=(d.page-1)*d.limit,j=i+d.limit-1,{data:k,error:m,count:n}=await h.range(i,j).order("created_at",{ascending:!1});if(m)throw console.error("Error fetching notes:",m),Error("Error al obtener notas");return{success:!0,notes:k||[],total:n||0,page:d.page,limit:d.limit}}catch(a){return console.error("Error in getNotes:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",notes:[],total:0}}}async function q(a){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c=await (0,f.R)(),{data:d,error:e}=await c.from("notes").select(`
        *,
        author:profiles(id, nombre),
        case:cases(id, caratulado)
      `).eq("id",a).single();if(e||!d)throw Error("Nota no encontrada");if(!await (0,g.Nf)(d.case_id)||"cliente"===b.role&&"privada"===d.tipo)throw Error("Sin permisos para ver esta nota");return{success:!0,note:d}}catch(a){return console.error("Error in getNoteById:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}(0,c(92714).D)([m,n,o,p,q]),(0,d.A)(m,"404363690534c2998b66a11f263b62b36e34dad7a0",null),(0,d.A)(n,"608003ec4135bd8a3f48d78862a427b9d9f7e694e7",null),(0,d.A)(o,"403a9e16c07af6b299c708c6b20892839c7f8aa116",null),(0,d.A)(p,"40f45b0ba7869e5efca05903df5bae73716a441e60",null),(0,d.A)(q,"409389a43284207355a01e228a335b269972e2153b",null)},18137:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},20048:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},28482:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},28900:(a,b,c)=>{c.d(b,{_:()=>x});var d=c(59356),e=c(56389),f=c(38388),g=c(8618),h=c(88275),i=c(9256),j=c(30724);let k=(0,j.createServerReference)("40f45b0ba7869e5efca05903df5bae73716a441e60",j.callServer,void 0,j.findSourceMapURL,"getNotes"),l=(0,j.createServerReference)("404363690534c2998b66a11f263b62b36e34dad7a0",j.callServer,void 0,j.findSourceMapURL,"createNote"),m=(0,j.createServerReference)("608003ec4135bd8a3f48d78862a427b9d9f7e694e7",j.callServer,void 0,j.findSourceMapURL,"updateNote"),n=(0,j.createServerReference)("403a9e16c07af6b299c708c6b20892839c7f8aa116",j.callServer,void 0,j.findSourceMapURL,"deleteNote");var o=c(16815),p=c(49798),q=c(97145);let r=(0,q.A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),s=(0,q.A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var t=c(72895),u=c(91775),v=c(28482),w=c(44878);function x({caseId:a,canCreateNotes:b=!1,canEditNotes:c=!1,showPrivateNotes:j=!0}){let[o,q]=(0,e.useState)([]),[v,w]=(0,e.useState)(!0),[x,z]=(0,e.useState)(!1),[A,B]=(0,e.useState)(null),[C,D]=(0,e.useState)({tipo:"privada",contenido:""}),{toast:E}=(0,i.dj)(),F=async()=>{w(!0);try{let b=await k({case_id:a,page:1,limit:50});b.success?q(b.notes):E({title:"Error",description:b.error||"Error al cargar notas",variant:"destructive"})}catch(a){console.error("Error loading notes:",a),E({title:"Error",description:"Error inesperado al cargar notas",variant:"destructive"})}finally{w(!1)}},G=async()=>{if(!C.contenido.trim())return void E({title:"Error",description:"El contenido de la nota es requerido",variant:"destructive"});z(!0);try{let b={case_id:a,tipo:C.tipo,contenido:C.contenido.trim()},c=await l(b);c.success?(E({title:"Nota creada",description:"La nota ha sido creada exitosamente"}),D({tipo:"privada",contenido:""}),await F()):E({title:"Error",description:c.error||"Error al crear la nota",variant:"destructive"})}catch(a){console.error("Error creating note:",a),E({title:"Error",description:"Error inesperado al crear la nota",variant:"destructive"})}finally{z(!1)}},H=async(a,b)=>{try{let c=await m(a,{contenido:b.trim()});c.success?(E({title:"Nota actualizada",description:"La nota ha sido actualizada exitosamente"}),B(null),await F()):E({title:"Error",description:c.error||"Error al actualizar la nota",variant:"destructive"})}catch(a){console.error("Error updating note:",a),E({title:"Error",description:"Error inesperado al actualizar la nota",variant:"destructive"})}},I=async a=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta nota?"))try{let b=await n(a);b.success?(E({title:"Nota eliminada",description:"La nota ha sido eliminada exitosamente"}),await F()):E({title:"Error",description:b.error||"Error al eliminar la nota",variant:"destructive"})}catch(a){console.error("Error deleting note:",a),E({title:"Error",description:"Error inesperado al eliminar la nota",variant:"destructive"})}},J=a=>"publica"===a?(0,d.jsx)(p.A,{className:"h-4 w-4 text-blue-600"}):(0,d.jsx)(r,{className:"h-4 w-4 text-gray-600"}),K=a=>"publica"===a?(0,d.jsx)(h.E,{variant:"default",children:"P\xfablica"}):(0,d.jsx)(h.E,{variant:"secondary",children:"Privada"}),L=j?o:o.filter(a=>"publica"===a.tipo);return v?(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(s,{className:"h-5 w-5"}),"Notas"]})}),(0,d.jsx)(g.Wu,{children:(0,d.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,d.jsx)(t.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(s,{className:"h-5 w-5"}),"Notas (",L.length,")"]}),b&&(0,d.jsxs)(f.$,{size:"sm",onClick:()=>z(!x),disabled:x,children:[(0,d.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Nueva Nota"]})]})}),(0,d.jsxs)(g.Wu,{className:"space-y-4",children:[x&&b&&(0,d.jsx)(g.Zp,{className:"border-dashed",children:(0,d.jsx)(g.Wu,{className:"pt-6",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tipo de nota"}),(0,d.jsxs)("select",{value:C.tipo,onChange:a=>D({...C,tipo:a.target.value}),className:"form-input",children:[(0,d.jsx)("option",{value:"privada",children:"Privada (solo abogados)"}),(0,d.jsx)("option",{value:"publica",children:"P\xfablica (visible para cliente)"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Contenido"}),(0,d.jsx)("textarea",{value:C.contenido,onChange:a=>D({...C,contenido:a.target.value}),placeholder:"Escribe tu nota aqu\xed...",rows:4,className:"form-input"})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,d.jsx)(f.$,{variant:"outline",onClick:()=>{z(!1),D({tipo:"privada",contenido:""})},children:"Cancelar"}),(0,d.jsx)(f.$,{onClick:G,children:"Crear Nota"})]})]})})}),(0,d.jsx)("div",{className:"space-y-3",children:L.map(a=>(0,d.jsx)(y,{note:a,canEdit:c,isEditing:A===a.id,onEdit:()=>B(a.id),onCancelEdit:()=>B(null),onSave:b=>H(a.id,b),onDelete:()=>I(a.id),getTypeIcon:J,getTypeBadge:K},a.id))}),0===L.length&&(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)(s,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,d.jsx)("p",{children:"No hay notas para este caso"}),b&&(0,d.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Nota" para agregar la primera nota'})]})]})]})}function y({note:a,canEdit:b,isEditing:c,onEdit:h,onCancelEdit:i,onSave:j,onDelete:k,getTypeIcon:l,getTypeBadge:m}){let[n,p]=(0,e.useState)(a.contenido);return(0,d.jsx)(g.Zp,{className:"border-l-4 border-l-blue-500",children:(0,d.jsxs)(g.Wu,{className:"pt-4",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[l(a.tipo),m(a.tipo),(0,d.jsxs)("span",{className:"text-sm text-gray-500",children:["por ",a.author?.nombre||"Usuario"]}),(0,d.jsx)("span",{className:"text-sm text-gray-400",children:(0,o.fw)(a.created_at)})]}),b&&(0,d.jsx)("div",{className:"flex items-center gap-1",children:c?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.$,{variant:"ghost",size:"sm",onClick:i,children:"Cancelar"}),(0,d.jsx)(f.$,{size:"sm",onClick:()=>{n.trim()&&j(n)},children:"Guardar"})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.$,{variant:"ghost",size:"sm",onClick:h,children:(0,d.jsx)(v.A,{className:"h-4 w-4"})}),(0,d.jsx)(f.$,{variant:"ghost",size:"sm",onClick:k,children:(0,d.jsx)(w.A,{className:"h-4 w-4"})})]})})]}),c?(0,d.jsx)("textarea",{value:n,onChange:a=>p(a.target.value),rows:4,className:"form-input w-full"}):(0,d.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,d.jsx)("p",{className:"whitespace-pre-wrap text-gray-700",children:a.contenido})})]})})}},35787:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},36205:(a,b,c)=>{c.d(b,{S:()=>B});var d=c(59356),e=c(56389),f=c(38388),g=c(8618),h=c(88275),i=c(9256),j=c(30724);let k=(0,j.createServerReference)("401ae8f39de269ce4e02eb6353c902e2e4fa2c442b",j.callServer,void 0,j.findSourceMapURL,"getStages"),l=(0,j.createServerReference)("40a895831a1d42497e891995e8bb197427428e9822",j.callServer,void 0,j.findSourceMapURL,"createStage"),m=(0,j.createServerReference)("60dfcfc9f2200e619dc6aa201aa596300c289585fd",j.callServer,void 0,j.findSourceMapURL,"completeStage"),n=(0,j.createServerReference)("404a3ab7425ff7aa7340e79f8aac62f9e31f63a2cc",j.callServer,void 0,j.findSourceMapURL,"deleteStage");var o=c(16815),p=c(20048),q=c(88237);let r=(0,c(97145).A)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var s=c(72895),t=c(91775),u=c(58637),v=c(45324),w=c(28482),x=c(44878),y=c(82968);y.Ik({case_id:y.Yj().uuid("ID de caso inv\xe1lido"),etapa:y.Yj().min(1,"El nombre de la etapa es requerido").max(100,"El nombre no puede exceder 100 caracteres"),descripcion:y.Yj().optional(),fecha_programada:y.Yj().optional(),fecha_completada:y.Yj().optional(),estado:y.k5(["pendiente","en_proceso","completado"]).default("pendiente"),es_publica:y.zM().default(!0),orden:y.ai().int().positive("El orden debe ser un n\xfamero positivo"),responsable_id:y.Yj().uuid("ID de responsable inv\xe1lido").optional()}).partial().omit({case_id:!0}),y.Ik({fecha_completada:y.Yj().optional(),observaciones:y.Yj().optional()}),y.Ik({case_id:y.Yj().uuid().optional(),estado:y.k5(["pendiente","en_proceso","completado"]).optional(),responsable_id:y.Yj().uuid().optional(),es_publica:y.zM().optional(),fecha_desde:y.Yj().optional(),fecha_hasta:y.Yj().optional(),page:y.ai().min(1).default(1),limit:y.ai().min(1).max(100).default(20)});let z={Civil:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda con antecedentes y revisi\xf3n formal del tribunal.",diasEstimados:0},{etapa:"Notificaci\xf3n a la contraparte",descripcion:"Gestiones de notificaci\xf3n personal o por c\xe9dula al demandado.",diasEstimados:30},{etapa:"Contestaci\xf3n de la demanda",descripcion:"Plazo legal para que la contraparte conteste y proponga excepciones.",diasEstimados:20},{etapa:"R\xe9plicas y d\xfaplicas",descripcion:"Intercambio de escritos aclarando puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia preparatoria",descripcion:"Fijaci\xf3n de puntos de prueba y acuerdos probatorios.",diasEstimados:30},{etapa:"Periodo probatorio",descripcion:"Recepci\xf3n de declaraciones, oficios, peritajes y documental.",diasEstimados:45},{etapa:"Alegatos y vista de la causa",descripcion:"Audiencia de cierre donde las partes exponen sus argumentos finales.",diasEstimados:20},{etapa:"Sentencia de primera instancia",descripcion:"Redacci\xf3n y publicaci\xf3n del fallo por el tribunal.",diasEstimados:60},{etapa:"Recursos y cumplimiento",descripcion:"Interposici\xf3n de recursos o cumplimiento voluntario/forzado.",diasEstimados:30}],Comercial:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda y verificaci\xf3n formal.",diasEstimados:0},{etapa:"Notificaci\xf3n demandado",descripcion:"Gesti\xf3n de notificaci\xf3n a la contraparte y acreditaci\xf3n en autos.",diasEstimados:20},{etapa:"Contestaci\xf3n y reconvenci\xf3n",descripcion:"Respuesta del demandado y eventuales reconvenciones.",diasEstimados:20},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de hechos a probar y medios de prueba.",diasEstimados:25},{etapa:"Prueba y alegatos",descripcion:"Producci\xf3n de prueba documental, testimonial y alegatos finales.",diasEstimados:40},{etapa:"Sentencia",descripcion:"Decisi\xf3n del tribunal y notificaci\xf3n a las partes.",diasEstimados:45},{etapa:"Ejecuci\xf3n o recursos",descripcion:"Cumplimiento del fallo o tramitaci\xf3n de recursos.",diasEstimados:30}],Laboral:[{etapa:"Ingreso tutela o demanda laboral",descripcion:"Ingreso del escrito y asignaci\xf3n de audiencia preliminar.",diasEstimados:0},{etapa:"Citaciones y notificaci\xf3n empleador",descripcion:"Notificaci\xf3n de la demanda y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Intento de conciliaci\xf3n y fijaci\xf3n de puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Producci\xf3n de prueba y alegatos finales.",diasEstimados:20},{etapa:"Sentencia laboral",descripcion:"Pronunciamiento del tribunal y notificaci\xf3n a las partes.",diasEstimados:15},{etapa:"Cumplimiento / Recurso de nulidad",descripcion:"Tramitaci\xf3n de recursos o ejecuci\xf3n de la sentencia.",diasEstimados:20}],Familia:[{etapa:"Ingreso demanda o escrito inicial",descripcion:"Ingreso de medida de protecci\xf3n o demanda ante tribunal de familia.",diasEstimados:0},{etapa:"Notificaci\xf3n y citaci\xf3n a audiencia",descripcion:"Notificaci\xf3n a la contraparte y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de puntos controvertidos y acumulaci\xf3n de prueba.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Presentaci\xf3n de prueba, declaraciones y alegatos.",diasEstimados:20},{etapa:"Sentencia",descripcion:"Redacci\xf3n y comunicaci\xf3n del fallo.",diasEstimados:20},{etapa:"Cumplimiento y seguimiento",descripcion:"Ejecuci\xf3n de medidas decretadas y seguimiento del cumplimiento.",diasEstimados:25}]},A=[{value:"pendiente",label:"Pendiente",color:"gray"},{value:"en_proceso",label:"En Proceso",color:"blue"},{value:"completado",label:"Completado",color:"green"}];function B({caseId:a,caseMateria:b="Civil",canManageStages:c=!1,showPrivateStages:j=!0}){let[y,B]=(0,e.useState)([]),[C,D]=(0,e.useState)(!0),[E,F]=(0,e.useState)(!1),[G,H]=(0,e.useState)(null),[I,J]=(0,e.useState)(!1),[K,L]=(0,e.useState)({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1}),{toast:M}=(0,i.dj)(),N=async()=>{D(!0);try{let b=await k({case_id:a,page:1,limit:50});b.success?B(b.stages):M({title:"Error",description:b.error||"Error al cargar etapas",variant:"destructive"})}catch(a){console.error("Error loading stages:",a),M({title:"Error",description:"Error inesperado al cargar etapas",variant:"destructive"})}finally{D(!1)}},O=async()=>{if(!K.etapa.trim())return void M({title:"Error",description:"El nombre de la etapa es requerido",variant:"destructive"});F(!0);try{let b=Math.max(...y.map(a=>a.orden||0),0),c={case_id:a,etapa:K.etapa.trim(),descripcion:K.descripcion.trim()||void 0,fecha_programada:K.fecha_programada||void 0,es_publica:K.es_publica,estado:"pendiente",orden:b+1},d=await l(c);d.success?(M({title:"Etapa creada",description:"La etapa ha sido creada exitosamente"}),L({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1}),J(!1),await N()):M({title:"Error",description:d.error||"Error al crear la etapa",variant:"destructive"})}catch(a){console.error("Error creating stage:",a),M({title:"Error",description:"Error inesperado al crear la etapa",variant:"destructive"})}finally{F(!1)}},P=async a=>{try{let b=await m(a);b.success?(M({title:"Etapa completada",description:"La etapa ha sido marcada como completada"}),await N()):M({title:"Error",description:b.error||"Error al completar la etapa",variant:"destructive"})}catch(a){console.error("Error completing stage:",a),M({title:"Error",description:"Error inesperado al completar la etapa",variant:"destructive"})}},Q=async a=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta etapa?"))try{let b=await n(a);b.success?(M({title:"Etapa eliminada",description:"La etapa ha sido eliminada exitosamente"}),await N()):M({title:"Error",description:b.error||"Error al eliminar la etapa",variant:"destructive"})}catch(a){console.error("Error deleting stage:",a),M({title:"Error",description:"Error inesperado al eliminar la etapa",variant:"destructive"})}},R=j?y:y.filter(a=>a.es_publica),S=function(a){if(!a)return z.Civil;let b=a.toLowerCase(),c=Object.keys(z).find(a=>a.toLowerCase()===b);return c?z[c]:z.Civil}(b);return C?(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(q.A,{className:"h-5 w-5"}),"Timeline Procesal"]})}),(0,d.jsx)(g.Wu,{children:(0,d.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,d.jsx)(s.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(q.A,{className:"h-5 w-5"}),"Timeline Procesal (",R.length,")"]}),c&&(0,d.jsxs)(f.$,{size:"sm",onClick:()=>J(!I),disabled:E,children:[(0,d.jsx)(t.A,{className:"h-4 w-4 mr-2"}),"Nueva Etapa"]})]})}),(0,d.jsxs)(g.Wu,{className:"space-y-6",children:[I&&c&&(0,d.jsx)(g.Zp,{className:"border-dashed",children:(0,d.jsx)(g.Wu,{className:"pt-6",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Etapa"}),(0,d.jsxs)("select",{value:K.isCustom?"custom":K.etapa,onChange:a=>{let b=a.target.value;if("custom"===b)return void L({...K,etapa:"",descripcion:"",isCustom:!0});let c=S.find(a=>a.etapa===b);L({...K,etapa:b,descripcion:c?.descripcion||K.descripcion,isCustom:!1})},className:"form-input",children:[(0,d.jsx)("option",{value:"",children:"Seleccionar etapa"}),S.map(a=>(0,d.jsxs)("option",{value:a.etapa,children:[a.etapa," ",a.diasEstimados?`(≈ ${a.diasEstimados} d\xedas)`:""]},a.etapa)),(0,d.jsx)("option",{value:"custom",children:"Etapa personalizada..."})]}),K.isCustom&&(0,d.jsx)("input",{type:"text",placeholder:"Nombre de la etapa personalizada",value:K.etapa,onChange:a=>L({...K,etapa:a.target.value}),className:"form-input mt-2"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Descripci\xf3n (opcional)"}),(0,d.jsx)("textarea",{value:K.descripcion,onChange:a=>L({...K,descripcion:a.target.value}),placeholder:"Descripci\xf3n de la etapa...",rows:3,className:"form-input"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fecha programada (opcional)"}),(0,d.jsx)("input",{type:"date",value:K.fecha_programada,onChange:a=>L({...K,fecha_programada:a.target.value}),className:"form-input"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Visibilidad"}),(0,d.jsxs)("select",{value:K.es_publica?"publica":"privada",onChange:a=>L({...K,es_publica:"publica"===a.target.value}),className:"form-input",children:[(0,d.jsx)("option",{value:"publica",children:"P\xfablica (visible para cliente)"}),(0,d.jsx)("option",{value:"privada",children:"Privada (solo abogados)"})]})]})]}),(0,d.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,d.jsx)(f.$,{variant:"outline",onClick:()=>{J(!1),L({etapa:"",descripcion:"",fecha_programada:"",es_publica:!0,isCustom:!1})},disabled:E,children:"Cancelar"}),(0,d.jsx)(f.$,{onClick:O,disabled:E,children:E?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Creando..."]}):"Crear Etapa"})]})]})})}),(0,d.jsx)("div",{className:"relative",children:R.map((a,b)=>{let e=a.responsable;return(0,d.jsxs)("div",{className:"relative flex items-start space-x-4 pb-8",children:[b<R.length-1&&(0,d.jsx)("div",{className:"absolute left-2.5 top-8 w-0.5 h-full bg-gray-200"}),(0,d.jsx)("div",{className:"relative z-10 flex-shrink-0",children:(a=>{switch(a){case"completado":return(0,d.jsx)(p.A,{className:"h-5 w-5 text-green-600"});case"en_proceso":return(0,d.jsx)(q.A,{className:"h-5 w-5 text-blue-600"});default:return(0,d.jsx)(r,{className:"h-5 w-5 text-gray-400"})}})(a.estado||"pendiente")}),(0,d.jsx)("div",{className:"flex-1 min-w-0",children:(0,d.jsx)(g.Zp,{className:`${"completado"===a.estado?"bg-green-50":""}`,children:(0,d.jsxs)(g.Wu,{className:"pt-4",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("h4",{className:"font-medium text-gray-900",children:a.etapa}),a.descripcion&&(0,d.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:a.descripcion})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(a=>{let b=A.find(b=>b.value===a);return b?(0,d.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${{gray:"bg-gray-100 text-gray-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",red:"bg-red-100 text-red-800"}[b.color]}`,children:b.label}):null})(a.estado||"pendiente"),!a.es_publica&&(0,d.jsx)(h.E,{variant:"outline",children:"Privada"})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[a.fecha_programada&&(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(u.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:(0,o.m7)(a.fecha_programada)&&"completado"!==a.estado?"text-red-600 font-medium":"",children:(0,o.Yq)(a.fecha_programada)})]}),e?.nombre&&(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(v.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:e.nombre})]}),a.fecha_cumplida&&(0,d.jsxs)("div",{className:"text-green-600",children:["Completado ",(0,o.fw)(a.fecha_cumplida)]})]}),c&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:["completado"!==a.estado&&(0,d.jsxs)(f.$,{size:"sm",variant:"outline",onClick:()=>P(a.id),children:[(0,d.jsx)(p.A,{className:"h-4 w-4 mr-1"}),"Completar"]}),(0,d.jsx)(f.$,{size:"sm",variant:"ghost",onClick:()=>H(a.id),children:(0,d.jsx)(w.A,{className:"h-4 w-4"})}),(0,d.jsx)(f.$,{size:"sm",variant:"ghost",onClick:()=>Q(a.id),children:(0,d.jsx)(x.A,{className:"h-4 w-4"})})]})]})})})]},a.id)})}),0===R.length&&(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)(q.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,d.jsx)("p",{children:"No hay etapas definidas para este caso"}),c&&(0,d.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Etapa" para agregar la primera etapa'})]}),S.length>0&&(0,d.jsxs)("div",{className:"border-t pt-4 mt-2",children:[(0,d.jsxs)("h3",{className:"text-sm font-semibold text-gray-700",children:["Plan estimado de referencia para materia ",b||"Civil"]}),(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Duraciones aproximadas en d\xedas a partir del inicio del caso."}),(0,d.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-gray-600",children:S.map((a,b)=>(0,d.jsxs)("li",{className:"flex items-start gap-2",children:[(0,d.jsx)("span",{className:"mt-1 h-2 w-2 rounded-full bg-blue-500 flex-shrink-0"}),(0,d.jsxs)("span",{children:[(0,d.jsx)("span",{className:"font-medium text-gray-800",children:a.etapa}),(0,d.jsxs)("span",{className:"block text-gray-500",children:[a.descripcion,a.diasEstimados?` \xb7 ≈ ${a.diasEstimados} d\xedas`:""]})]})]},`${a.etapa}-${b}`))})]})]})]})}},39309:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]])},45324:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},49798:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},58637:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},64713:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]])},67942:(a,b,c)=>{c.d(b,{$:()=>C});var d=c(59356),e=c(56389),f=c(38388),g=c(8618),h=c(88275),i=c(9256),j=c(30724);let k=(0,j.createServerReference)("401c3e5e9fb1d5c2bc713922df9b49cc9506e4102a",j.callServer,void 0,j.findSourceMapURL,"getDocuments");var l=c(7515);let m=(0,j.createServerReference)("609d6fde2046d1536a173ef6460e6019ebe636596d",j.callServer,void 0,j.findSourceMapURL,"updateDocument"),n=(0,j.createServerReference)("406044a123b8b7a5866f2f5f01cf370cbf6075392d",j.callServer,void 0,j.findSourceMapURL,"deleteDocument"),o=(0,j.createServerReference)("4042a9d932eaf5c250a1d37041a85d12b5ce6080a7",j.callServer,void 0,j.findSourceMapURL,"getDocumentDownloadUrl");var p=c(16815),q=c(5358),r=c(97145);let s=(0,r.A)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);var t=c(18137),u=c(72895),v=c(91775);let w=(0,r.A)("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),x=(0,r.A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var y=c(28482),z=c(44878),A=c(82968);A.Ik({case_id:A.Yj().uuid("ID de caso inv\xe1lido"),nombre:A.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres"),visibilidad:A.k5(["privado","cliente"]).default("privado"),file:A.bz().optional()}),A.Ik({nombre:A.Yj().min(1,"El nombre del archivo es requerido").max(255,"El nombre no puede exceder 255 caracteres").optional(),visibilidad:A.k5(["privado","cliente"]).optional()}),A.Ik({case_id:A.Yj().uuid().optional(),visibilidad:A.k5(["privado","cliente"]).optional(),uploader_id:A.Yj().uuid().optional(),tipo_mime:A.Yj().optional(),search:A.Yj().optional(),page:A.ai().min(1).default(1),limit:A.ai().min(1).max(100).default(20)}),A.Ik({maxFileSize:A.ai().default(0x1400000),allowedTypes:A.YO(A.Yj()).default(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png","image/gif","text/plain"])});let B={"application/pdf":{extension:"pdf",icon:"\uD83D\uDCC4",name:"PDF"},"application/msword":{extension:"doc",icon:"\uD83D\uDCDD",name:"Word"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{extension:"docx",icon:"\uD83D\uDCDD",name:"Word"},"image/jpeg":{extension:"jpg",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/png":{extension:"png",icon:"\uD83D\uDDBC️",name:"Imagen"},"image/gif":{extension:"gif",icon:"\uD83D\uDDBC️",name:"Imagen"},"text/plain":{extension:"txt",icon:"\uD83D\uDCC4",name:"Texto"}};function C({caseId:a,canUpload:b=!1,canEdit:c=!1,canDelete:j=!1,showPrivateDocuments:p=!0}){let[r,x]=(0,e.useState)([]),[y,z]=(0,e.useState)(!0),[A,C]=(0,e.useState)(!1),[E,F]=(0,e.useState)(null),[G,H]=(0,e.useState)(!1),I=(0,e.useRef)(null),{toast:J}=(0,i.dj)(),K=async()=>{z(!0);try{let b=await k({case_id:a,page:1,limit:50});b.success?x(b.documents):J({title:"Error",description:b.error||"Error al cargar documentos",variant:"destructive"})}catch(a){console.error("Error loading documents:",a),J({title:"Error",description:"Error inesperado al cargar documentos",variant:"destructive"})}finally{z(!1)}},L=async b=>{let c=b.target.files?.[0];if(c){if(c.size>0x1400000)return void J({title:"Archivo demasiado grande",description:"El archivo debe ser menor a 20MB",variant:"destructive"});if(!Object.keys(B).includes(c.type))return void J({title:"Tipo de archivo no permitido",description:"Solo se permiten archivos PDF, Word, im\xe1genes y texto",variant:"destructive"});C(!0);try{let b=new FormData;b.append("file",c),b.append("case_id",a),b.append("nombre",c.name),b.append("visibilidad","privado");let d=await (0,l.X)(b);d.success?(J({title:"Documento subido",description:"El documento ha sido subido exitosamente"}),H(!1),await K()):J({title:"Error",description:d.error||"Error al subir el documento",variant:"destructive"})}catch(a){console.error("Error uploading document:",a),J({title:"Error",description:"Error inesperado al subir el documento",variant:"destructive"})}finally{C(!1),I.current&&(I.current.value="")}}},M=async(a,b)=>{try{let c=await m(a,b);c.success?(J({title:"Documento actualizado",description:"El documento ha sido actualizado exitosamente"}),F(null),await K()):J({title:"Error",description:c.error||"Error al actualizar el documento",variant:"destructive"})}catch(a){console.error("Error updating document:",a),J({title:"Error",description:"Error inesperado al actualizar el documento",variant:"destructive"})}},N=async a=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar este documento?"))try{let b=await n(a);b.success?(J({title:"Documento eliminado",description:"El documento ha sido eliminado exitosamente"}),await K()):J({title:"Error",description:b.error||"Error al eliminar el documento",variant:"destructive"})}catch(a){console.error("Error deleting document:",a),J({title:"Error",description:"Error inesperado al eliminar el documento",variant:"destructive"})}},O=async(a,b)=>{try{let c=await o(a);if(c.success&&c.url){let a=document.createElement("a");a.href=c.url,a.download=b,document.body.appendChild(a),a.click(),document.body.removeChild(a),J({title:"Descarga iniciada",description:"El documento se est\xe1 descargando"})}else J({title:"Error",description:c.error||"Error al generar enlace de descarga",variant:"destructive"})}catch(a){console.error("Error downloading document:",a),J({title:"Error",description:"Error inesperado al descargar el documento",variant:"destructive"})}},P=a=>{let b=B[a];return b?b.icon:"\uD83D\uDCC4"},Q=a=>"cliente"===a?(0,d.jsx)(q.A,{className:"h-4 w-4 text-blue-600"}):(0,d.jsx)(s,{className:"h-4 w-4 text-gray-600"}),R=a=>"cliente"===a?(0,d.jsx)(h.E,{variant:"default",children:"Cliente"}):(0,d.jsx)(h.E,{variant:"secondary",children:"Privado"}),S=p?r:r.filter(a=>"cliente"===a.visibilidad);return y?(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(t.A,{className:"h-5 w-5"}),"Documentos"]})}),(0,d.jsx)(g.Wu,{children:(0,d.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,d.jsx)(u.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(t.A,{className:"h-5 w-5"}),"Documentos (",S.length,")"]}),b&&(0,d.jsxs)(f.$,{size:"sm",onClick:()=>H(!G),disabled:A,children:[(0,d.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Subir Documento"]})]})}),(0,d.jsxs)(g.Wu,{className:"space-y-4",children:[G&&b&&(0,d.jsx)(g.Zp,{className:"border-dashed",children:(0,d.jsx)(g.Wu,{className:"pt-6",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Seleccionar archivo"}),(0,d.jsx)("input",{ref:I,type:"file",onChange:L,accept:Object.keys(B).join(","),className:"form-input",disabled:A}),(0,d.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["M\xe1ximo ",20,"MB. Formatos: PDF, Word, im\xe1genes, texto"]})]}),A&&(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,d.jsx)(u.A,{className:"h-4 w-4 animate-spin"}),"Subiendo archivo..."]}),(0,d.jsx)("div",{className:"flex justify-end space-x-2",children:(0,d.jsx)(f.$,{variant:"outline",onClick:()=>H(!1),disabled:A,children:"Cancelar"})})]})})}),(0,d.jsx)("div",{className:"space-y-3",children:S.map(a=>(0,d.jsx)(D,{document:a,canEdit:c,canDelete:j,isEditing:E===a.id,onEdit:()=>F(a.id),onCancelEdit:()=>F(null),onSave:b=>M(a.id,b),onDelete:()=>N(a.id),onDownload:()=>O(a.id,a.nombre),getFileIcon:P,getVisibilityIcon:Q,getVisibilityBadge:R},a.id))}),0===S.length&&(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)(w,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,d.jsx)("p",{children:"No hay documentos para este caso"}),b&&(0,d.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Subir Documento" para agregar el primer documento'})]})]})]})}function D({document:a,canEdit:b,canDelete:c,isEditing:h,onEdit:i,onCancelEdit:j,onSave:k,onDelete:l,onDownload:m,getFileIcon:n,getVisibilityIcon:o,getVisibilityBadge:q}){let[r,s]=(0,e.useState)({nombre:a.nombre,visibilidad:a.visibilidad});return(0,d.jsx)(g.Zp,{className:"border-l-4 border-l-green-500",children:(0,d.jsx)(g.Wu,{className:"pt-4",children:(0,d.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("span",{className:"text-2xl",children:n(a.tipo_mime||"")}),(0,d.jsxs)("div",{children:[h?(0,d.jsx)("input",{type:"text",value:r.nombre,onChange:a=>s({...r,nombre:a.target.value}),className:"form-input text-sm"}):(0,d.jsx)("h4",{className:"font-medium text-gray-900",children:a.nombre}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[o(a.visibilidad||"privado"),h?(0,d.jsxs)("select",{value:r.visibilidad,onChange:a=>s({...r,visibilidad:a.target.value}),className:"form-input text-xs",children:[(0,d.jsx)("option",{value:"privado",children:"Privado"}),(0,d.jsx)("option",{value:"cliente",children:"Cliente"})]}):q(a.visibilidad||"privado"),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:(0,p.v7)(a.size_bytes||0)})]}),(0,d.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["Subido por ",a.uploader?.nombre||"Usuario"," • ",(0,p.fw)(a.created_at)]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(f.$,{variant:"ghost",size:"sm",onClick:m,children:(0,d.jsx)(x,{className:"h-4 w-4"})}),b&&(0,d.jsx)(d.Fragment,{children:h?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(f.$,{variant:"ghost",size:"sm",onClick:j,children:"Cancelar"}),(0,d.jsx)(f.$,{size:"sm",onClick:()=>{r.nombre.trim()&&k(r)},children:"Guardar"})]}):(0,d.jsx)(f.$,{variant:"ghost",size:"sm",onClick:i,children:(0,d.jsx)(y.A,{className:"h-4 w-4"})})}),c&&!h&&(0,d.jsx)(f.$,{variant:"ghost",size:"sm",onClick:l,children:(0,d.jsx)(z.A,{className:"h-4 w-4"})})]})]})})})}},71095:(a,b,c)=>{c.d(b,{e2:()=>s,Qw:()=>p,iI:()=>u,F8:()=>t,tT:()=>r,Z0:()=>q});var d=c(61776);c(70958);var e=c(46221),f=c(83273),g=c(60619),h=c(56931),i=c(73771);let j=i.Ik({case_id:i.Yj().uuid("ID de caso inv\xe1lido"),titulo:i.Yj().min(1,"El t\xedtulo es requerido").max(200,"El t\xedtulo no puede exceder 200 caracteres"),descripcion:i.Yj().min(1,"La descripci\xf3n es requerida").max(2e3,"La descripci\xf3n no puede exceder 2000 caracteres"),tipo:i.k5(["documento","informacion","reunion","otro"]).default("informacion"),prioridad:i.k5(["baja","media","alta","urgente"]).default("media"),fecha_limite:i.Yj().optional(),es_publica:i.zM().default(!0)}),k=j.partial().omit({case_id:!0}),l=i.Ik({respuesta:i.Yj().min(1,"La respuesta es requerida").max(2e3,"La respuesta no puede exceder 2000 caracteres"),archivo_adjunto:i.Yj().optional()}),m=i.Ik({case_id:i.Yj().uuid().optional(),estado:i.k5(["pendiente","en_revision","respondida","cerrada"]).optional(),tipo:i.k5(["documento","informacion","reunion","otro"]).optional(),prioridad:i.k5(["baja","media","alta","urgente"]).optional(),creador_id:i.Yj().uuid().optional(),es_publica:i.zM().optional(),fecha_desde:i.Yj().optional(),fecha_hasta:i.Yj().optional(),search:i.Yj().optional(),page:i.ai().min(1).default(1),limit:i.ai().min(1).max(100).default(20)});function n(a,b,c){void 0!==c&&(a[b]=c)}function o(a){return a?a.trim()||null:null}async function p(a){try{let b=await (0,g.oC)(),c=j.parse(a);if(!await (0,g.Nf)(c.case_id))throw Error("Sin permisos para acceder a este caso");let d=await (0,f.R)(),i={case_id:c.case_id,creador_id:b.id,titulo:c.titulo,descripcion:c.descripcion,tipo:c.tipo,prioridad:c.prioridad,es_publica:c.es_publica??!0,fecha_limite:o(c.fecha_limite)},{data:k,error:l}=await d.from("info_requests").insert(i).select(`
        *,
        creador:profiles!info_requests_creador_id_fkey(id, nombre),
        case:cases(id, caratulado)
      `).single();if(l)throw console.error("createInfoRequest insert error:",l),Error("Error al crear la solicitud");return await (0,h.UU)({action:"CREATE",entity_type:"info_request",entity_id:k.id,diff_json:{created:i}}),(0,e.revalidatePath)(`/cases/${c.case_id}`),{success:!0,request:k}}catch(a){return console.error("Error in createInfoRequest:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function q(a,b){try{let c=await (0,g.oC)(),d=k.parse(b),i=await (0,f.R)(),{data:j,error:l}=await i.from("info_requests").select("*").eq("id",a).single();if(l||!j)throw Error("Solicitud no encontrada");if(!await (0,g.Nf)(j.case_id))throw Error("Sin permisos para acceder a este caso");if("admin_firma"!==c.role&&j.creador_id!==c.id)if("abogado"===c.role){let{data:a}=await i.from("cases").select("abogado_responsable").eq("id",j.case_id).single();if(!a||a.abogado_responsable!==c.id)throw Error("Sin permisos para editar esta solicitud")}else throw Error("Sin permisos para editar esta solicitud");let m={};n(m,"titulo",d.titulo),n(m,"descripcion",d.descripcion),n(m,"tipo",d.tipo),n(m,"prioridad",d.prioridad),n(m,"es_publica",d.es_publica),n(m,"fecha_limite",o(d.fecha_limite));let{data:p,error:q}=await i.from("info_requests").update(m).eq("id",a).select(`
        *,
        creador:profiles!info_requests_creador_id_fkey(id, nombre),
        case:cases(id, caratulado)
      `).single();if(q)throw console.error("updateInfoRequest update error:",q),Error("Error al actualizar la solicitud");return await (0,h.UU)({action:"UPDATE",entity_type:"info_request",entity_id:a,diff_json:{from:j,to:p}}),(0,e.revalidatePath)(`/cases/${j.case_id}`),{success:!0,request:p}}catch(a){return console.error("Error in updateInfoRequest:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function r(a,b){try{let c=await (0,g.oC)(),d=l.parse(b),i=await (0,f.R)(),{data:j,error:k}=await i.from("info_requests").select("*").eq("id",a).single();if(k||!j)throw Error("Solicitud no encontrada");if(!await (0,g.Nf)(j.case_id))throw Error("Sin permisos para acceder a este caso");if("cliente"===c.role)throw Error("Sin permisos para responder solicitudes");let m=new Date().toISOString(),n={respuesta:d.respuesta,archivo_adjunto:b?.archivo_adjunto??null,respondido_por:c.id,respondido_at:m,estado:"respondida"},{data:o,error:p}=await i.from("info_requests").update(n).eq("id",a).select(`
        *,
        creador:profiles!info_requests_creador_id_fkey(id, nombre),
        respondido_por_profile:profiles!info_requests_respondido_por_fkey(id, nombre),
        case:cases(id, caratulado)
      `).single();if(p)throw console.error("respondInfoRequest update error:",p),Error("Error al responder la solicitud");return await (0,h.UU)({action:"RESPOND",entity_type:"info_request",entity_id:a,diff_json:{response:n}}),(0,e.revalidatePath)(`/cases/${j.case_id}`),{success:!0,request:o}}catch(a){return console.error("Error in respondInfoRequest:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function s(a){try{let b=await (0,g.oC)(),c=await (0,f.R)(),{data:d,error:i}=await c.from("info_requests").select("*").eq("id",a).single();if(i||!d)throw Error("Solicitud no encontrada");if(!await (0,g.Nf)(d.case_id))throw Error("Sin permisos para acceder a este caso");if("admin_firma"!==b.role&&d.creador_id!==b.id)if("abogado"===b.role){let{data:a}=await c.from("cases").select("abogado_responsable").eq("id",d.case_id).single();if(!a||a.abogado_responsable!==b.id)throw Error("Sin permisos para cerrar esta solicitud")}else throw Error("Sin permisos para cerrar esta solicitud");let{data:j,error:k}=await c.from("info_requests").update({estado:"cerrada"}).eq("id",a).select(`
        *,
        creador:profiles!info_requests_creador_id_fkey(id, nombre),
        case:cases(id, caratulado)
      `).single();if(k)throw console.error("closeInfoRequest update error:",k),Error("Error al cerrar la solicitud");return await (0,h.UU)({action:"CLOSE",entity_type:"info_request",entity_id:a,diff_json:{closed:!0}}),(0,e.revalidatePath)(`/cases/${d.case_id}`),{success:!0,request:j}}catch(a){return console.error("Error in closeInfoRequest:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function t(a={page:1,limit:20}){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c=m.parse(a),d=await (0,f.R)(),e=d.from("info_requests").select(`
        *,
        creador:profiles!info_requests_creador_id_fkey(id, nombre),
        respondido_por_profile:profiles!info_requests_respondido_por_fkey(id, nombre),
        case:cases(id, caratulado)
        `,{count:"exact"});if("cliente"===b.role){e=e.or(`creador_id.eq.${b.id},es_publica.eq.true`);let{data:a}=await d.from("case_clients").select("case_id").eq("client_profile_id",b.id),c=a?.map(a=>a.case_id)||[];if(0===c.length)return{success:!0,requests:[],total:0};e=e.in("case_id",c)}else if("abogado"===b.role){let{data:a}=await d.from("cases").select("id").eq("abogado_responsable",b.id),c=a?.map(a=>a.id)||[];if(0===c.length)return{success:!0,requests:[],total:0};e=e.in("case_id",c)}if(c.case_id){if(!await (0,g.Nf)(c.case_id))throw Error("Sin permisos para acceder a este caso");e=e.eq("case_id",c.case_id)}c.estado&&(e=e.eq("estado",c.estado)),c.tipo&&(e=e.eq("tipo",c.tipo)),c.prioridad&&(e=e.eq("prioridad",c.prioridad)),c.creador_id&&(e=e.eq("creador_id",c.creador_id)),void 0!==c.es_publica&&(e=e.eq("es_publica",c.es_publica)),c.search&&(e=e.or(`titulo.ilike.%${c.search}%,descripcion.ilike.%${c.search}%`));let h=(c.page-1)*c.limit,i=h+c.limit-1,{data:j,error:k,count:l}=await e.range(h,i).order("created_at",{ascending:!1});if(k)throw console.error("getInfoRequests query error:",k),Error("Error al obtener solicitudes");return{success:!0,requests:j||[],total:l??j?.length??0,page:c.page,limit:c.limit}}catch(a){return console.error("Error in getInfoRequests:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",requests:[],total:0}}}async function u(a){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c=await (0,f.R)(),{data:d,error:e}=await c.from("info_requests").select(`
        *,
        creador:profiles!info_requests_creador_id_fkey(id, nombre),
        respondido_por_profile:profiles!info_requests_respondido_por_fkey(id, nombre),
        case:cases(id, caratulado)
      `).eq("id",a).single();if(e||!d)throw Error("Solicitud no encontrada");if(!await (0,g.Nf)(d.case_id)||"cliente"===b.role&&!d.es_publica&&d.creador_id!==b.id)throw Error("Sin permisos para ver esta solicitud");return{success:!0,request:d}}catch(a){return console.error("Error in getInfoRequestById:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}(0,c(92714).D)([p,q,r,s,t,u]),(0,d.A)(p,"406ff704c3af861ff370fa8797d3545de42fb3fb94",null),(0,d.A)(q,"601cd9d7d2e24e8fe7c2cef3317d10d56a76c1b3b4",null),(0,d.A)(r,"60b3aa380a402bca113b72383818a3cf7c2e1f96d0",null),(0,d.A)(s,"402c4cf049c9145bbd61609694edd7c54aa095d765",null),(0,d.A)(t,"40a587fb7794c6b2018479cc7c785562ff1a08b62a",null),(0,d.A)(u,"40d28aef7c4af8f419d65ea48c84edff368638c0ba",null)},73376:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},76835:(a,b,c)=>{c.d(b,{B:()=>q});var d=c(59356),e=c(56389),f=c(30724);let g=(0,f.createServerReference)("409f00fb61c08a8235ef06aa2d1964f04327fc3767",f.callServer,void 0,f.findSourceMapURL,"sendCaseMessage"),h=(0,f.createServerReference)("60983053161faf835386084ba34bfbbdf11cdcee2d",f.callServer,void 0,f.findSourceMapURL,"listCaseMessages");var i=c(38388),j=c(98558),k=c(8618),l=c(88275),m=c(16815),n=c(72895),o=c(6997),p=c(9256);function q({caseId:a,initialMessages:b,currentProfileId:c,allowSend:f=!0}){let[q,r]=(0,e.useState)(b),[s,t]=(0,e.useState)(""),[u,v]=(0,e.useTransition)(),[w,x]=(0,e.useState)(!1),{toast:y}=(0,p.dj)(),z=(0,e.useMemo)(()=>q.slice().sort((a,b)=>new Date(a.created_at).getTime()-new Date(b.created_at).getTime()),[q]),A=async()=>{x(!0);try{let b=await h(a,{limit:100});r(b)}catch(a){y({title:"Error al actualizar",description:a?.message??"No fue posible obtener los mensajes.",variant:"destructive"})}finally{x(!1)}};return(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-lexser-gray-900",children:"Mensajes del caso"}),(0,d.jsx)(i.$,{variant:"outline",size:"sm",onClick:A,disabled:w,children:w?(0,d.jsx)(n.A,{className:"h-4 w-4 animate-spin"}):"Actualizar"})]}),(0,d.jsx)("div",{className:"space-y-4",children:0===z.length?(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"A\xfan no hay mensajes para este caso."}):z.map(a=>{let b=a.sender_profile_id===c;return(0,d.jsx)(k.Zp,{className:`border ${b?"border-lexser-blue-200 bg-lexser-blue-50":"border-lexser-gray-100"}`,children:(0,d.jsxs)(k.Wu,{className:"p-4 space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[(0,d.jsxs)("span",{children:[a.sender?.nombre??"Usuario",a.sender?.role&&(0,d.jsx)(l.E,{variant:"outline",className:"ml-2 capitalize text-[10px]",children:a.sender.role})]}),(0,d.jsx)("span",{children:(0,m.r6)(a.created_at)})]}),(0,d.jsx)("p",{className:"text-sm text-lexser-gray-900 whitespace-pre-wrap",children:a.contenido}),a.attachment_url&&(0,d.jsx)("a",{href:a.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs font-medium text-lexser-blue-600 hover:text-lexser-blue-700",children:"Ver adjunto"})]})},a.id)})}),f&&(0,d.jsxs)("div",{className:"rounded-lg border border-lexser-gray-200 p-4 space-y-3",children:[(0,d.jsx)(j.T,{placeholder:"Escribe un mensaje para tu cliente o equipo...",value:s,onChange:a=>t(a.target.value),disabled:u,className:"min-h-[120px]"}),(0,d.jsx)("div",{className:"flex items-center justify-end",children:(0,d.jsxs)(i.$,{onClick:()=>{if(!s.trim())return void y({title:"Mensaje vac\xedo",description:"Escribe un mensaje antes de enviarlo.",variant:"destructive"});v(async()=>{try{let b=await g({caseId:a,contenido:s.trim()});r(a=>[...a,b]),t("")}catch(a){y({title:"No se pudo enviar",description:a?.message??"Intenta nuevamente en unos minutos.",variant:"destructive"})}})},disabled:u,children:[u?(0,d.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,d.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Enviar"]})})]})]})}},77198:(a,b,c)=>{c.d(b,{L:()=>E});var d=c(59356),e=c(56389),f=c(38388),g=c(8618),h=c(88275),i=c(9256),j=c(30724);let k=(0,j.createServerReference)("40a587fb7794c6b2018479cc7c785562ff1a08b62a",j.callServer,void 0,j.findSourceMapURL,"getInfoRequests"),l=(0,j.createServerReference)("406ff704c3af861ff370fa8797d3545de42fb3fb94",j.callServer,void 0,j.findSourceMapURL,"createInfoRequest"),m=(0,j.createServerReference)("60b3aa380a402bca113b72383818a3cf7c2e1f96d0",j.callServer,void 0,j.findSourceMapURL,"respondInfoRequest"),n=(0,j.createServerReference)("402c4cf049c9145bbd61609694edd7c54aa095d765",j.callServer,void 0,j.findSourceMapURL,"closeInfoRequest");var o=c(16815),p=c(20048),q=c(88237),r=c(9239),s=c(39309),t=c(72895),u=c(91775),v=c(87114),w=c(45324),x=c(58637);let y=(0,c(97145).A)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var z=c(6997),A=c(82968);A.Ik({case_id:A.Yj().uuid("ID de caso inv\xe1lido"),titulo:A.Yj().min(1,"El t\xedtulo es requerido").max(200,"El t\xedtulo no puede exceder 200 caracteres"),descripcion:A.Yj().min(1,"La descripci\xf3n es requerida").max(2e3,"La descripci\xf3n no puede exceder 2000 caracteres"),tipo:A.k5(["documento","informacion","reunion","otro"]).default("informacion"),prioridad:A.k5(["baja","media","alta","urgente"]).default("media"),fecha_limite:A.Yj().optional(),es_publica:A.zM().default(!0)}).partial().omit({case_id:!0}),A.Ik({respuesta:A.Yj().min(1,"La respuesta es requerida").max(2e3,"La respuesta no puede exceder 2000 caracteres"),archivo_adjunto:A.Yj().optional()}),A.Ik({case_id:A.Yj().uuid().optional(),estado:A.k5(["pendiente","en_revision","respondida","cerrada"]).optional(),tipo:A.k5(["documento","informacion","reunion","otro"]).optional(),prioridad:A.k5(["baja","media","alta","urgente"]).optional(),creador_id:A.Yj().uuid().optional(),es_publica:A.zM().optional(),fecha_desde:A.Yj().optional(),fecha_hasta:A.Yj().optional(),search:A.Yj().optional(),page:A.ai().min(1).default(1),limit:A.ai().min(1).max(100).default(20)});let B=[{value:"documento",label:"Documento",description:"Solicitud de documentos espec\xedficos"},{value:"informacion",label:"Informaci\xf3n",description:"Solicitud de informaci\xf3n general"},{value:"reunion",label:"Reuni\xf3n",description:"Solicitud de reuni\xf3n o cita"},{value:"otro",label:"Otro",description:"Otro tipo de solicitud"}],C=[{value:"pendiente",label:"Pendiente",color:"yellow"},{value:"en_revision",label:"En Revisi\xf3n",color:"blue"},{value:"respondida",label:"Respondida",color:"green"},{value:"cerrada",label:"Cerrada",color:"gray"}],D=[{value:"baja",label:"Baja",color:"gray"},{value:"media",label:"Media",color:"blue"},{value:"alta",label:"Alta",color:"orange"},{value:"urgente",label:"Urgente",color:"red"}];function E({caseId:a,canCreateRequests:b=!1,canRespondRequests:c=!1,showPrivateRequests:h=!0}){let[j,o]=(0,e.useState)([]),[v,w]=(0,e.useState)(!0),[x,y]=(0,e.useState)(!1),[z,A]=(0,e.useState)(null),[E,G]=(0,e.useState)(!1),[H,I]=(0,e.useState)({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0}),[J,K]=(0,e.useState)({respuesta:"",archivo_adjunto:""}),{toast:L}=(0,i.dj)(),M=async()=>{w(!0);try{let b=await k({case_id:a,page:1,limit:50});b.success?o(b.requests):L({title:"Error",description:b.error||"Error al cargar solicitudes",variant:"destructive"})}catch(a){console.error("Error loading requests:",a),L({title:"Error",description:"Error inesperado al cargar solicitudes",variant:"destructive"})}finally{w(!1)}},N=async()=>{if(!H.titulo.trim()||!H.descripcion.trim())return void L({title:"Error",description:"El t\xedtulo y la descripci\xf3n son requeridos",variant:"destructive"});y(!0);try{let b={case_id:a,titulo:H.titulo.trim(),descripcion:H.descripcion.trim(),tipo:H.tipo,prioridad:H.prioridad,fecha_limite:H.fecha_limite||void 0,es_publica:H.es_publica},c=await l(b);c.success?(L({title:"Solicitud creada",description:"La solicitud ha sido creada exitosamente"}),I({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0}),G(!1),await M()):L({title:"Error",description:c.error||"Error al crear la solicitud",variant:"destructive"})}catch(a){console.error("Error creating request:",a),L({title:"Error",description:"Error inesperado al crear la solicitud",variant:"destructive"})}finally{y(!1)}},O=async a=>{if(!J.respuesta.trim())return void L({title:"Error",description:"La respuesta es requerida",variant:"destructive"});try{let b={respuesta:J.respuesta.trim(),archivo_adjunto:J.archivo_adjunto||void 0},c=await m(a,b);c.success?(L({title:"Respuesta enviada",description:"La respuesta ha sido enviada exitosamente"}),K({respuesta:"",archivo_adjunto:""}),A(null),await M()):L({title:"Error",description:c.error||"Error al enviar la respuesta",variant:"destructive"})}catch(a){console.error("Error responding to request:",a),L({title:"Error",description:"Error inesperado al enviar la respuesta",variant:"destructive"})}},P=async a=>{try{let b=await n(a);b.success?(L({title:"Solicitud cerrada",description:"La solicitud ha sido cerrada"}),await M()):L({title:"Error",description:b.error||"Error al cerrar la solicitud",variant:"destructive"})}catch(a){console.error("Error closing request:",a),L({title:"Error",description:"Error inesperado al cerrar la solicitud",variant:"destructive"})}},Q=a=>{switch(a){case"respondida":return(0,d.jsx)(p.A,{className:"h-5 w-5 text-green-600"});case"en_revision":return(0,d.jsx)(q.A,{className:"h-5 w-5 text-blue-600"});case"cerrada":return(0,d.jsx)(r.A,{className:"h-5 w-5 text-gray-600"});default:return(0,d.jsx)(s.A,{className:"h-5 w-5 text-yellow-600"})}},R=a=>{let b=C.find(b=>b.value===a);return b?(0,d.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${{yellow:"bg-yellow-100 text-yellow-800",blue:"bg-blue-100 text-blue-800",green:"bg-green-100 text-green-800",gray:"bg-gray-100 text-gray-800"}[b.color]}`,children:b.label}):null},S=a=>{let b=D.find(b=>b.value===a);return b?(0,d.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${{gray:"bg-gray-100 text-gray-800",blue:"bg-blue-100 text-blue-800",orange:"bg-orange-100 text-orange-800",red:"bg-red-100 text-red-800"}[b.color]}`,children:b.label}):null},T=a=>{let b=B.find(b=>b.value===a);return b?b.label:a},U=h?j:j.filter(a=>a.es_publica);return v?(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(s.A,{className:"h-5 w-5"}),"Solicitudes de Informaci\xf3n"]})}),(0,d.jsx)(g.Wu,{children:(0,d.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,d.jsx)(t.A,{className:"h-6 w-6 animate-spin"})})})]}):(0,d.jsxs)(g.Zp,{children:[(0,d.jsx)(g.aR,{children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(g.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(s.A,{className:"h-5 w-5"}),"Solicitudes de Informaci\xf3n (",U.length,")"]}),b&&(0,d.jsxs)(f.$,{size:"sm",onClick:()=>G(!E),disabled:x,children:[(0,d.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Nueva Solicitud"]})]})}),(0,d.jsxs)(g.Wu,{className:"space-y-4",children:[E&&b&&(0,d.jsx)(g.Zp,{className:"border-dashed",children:(0,d.jsx)(g.Wu,{className:"pt-6",children:(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"T\xedtulo *"}),(0,d.jsx)("input",{type:"text",value:H.titulo,onChange:a=>I({...H,titulo:a.target.value}),placeholder:"T\xedtulo de la solicitud",className:"form-input"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Descripci\xf3n *"}),(0,d.jsx)("textarea",{value:H.descripcion,onChange:a=>I({...H,descripcion:a.target.value}),placeholder:"Describe detalladamente lo que necesitas...",rows:4,className:"form-input"})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tipo"}),(0,d.jsx)("select",{value:H.tipo,onChange:a=>I({...H,tipo:a.target.value}),className:"form-input",children:B.map(a=>(0,d.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prioridad"}),(0,d.jsx)("select",{value:H.prioridad,onChange:a=>I({...H,prioridad:a.target.value}),className:"form-input",children:D.map(a=>(0,d.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fecha l\xedmite (opcional)"}),(0,d.jsx)("input",{type:"date",value:H.fecha_limite,onChange:a=>I({...H,fecha_limite:a.target.value}),className:"form-input"})]})]}),(0,d.jsx)("div",{children:(0,d.jsxs)("label",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:H.es_publica,onChange:a=>I({...H,es_publica:a.target.checked})}),(0,d.jsx)("span",{className:"text-sm",children:"Visible para el abogado"})]})}),(0,d.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,d.jsx)(f.$,{variant:"outline",onClick:()=>{G(!1),I({titulo:"",descripcion:"",tipo:"informacion",prioridad:"media",fecha_limite:"",es_publica:!0})},disabled:x,children:"Cancelar"}),(0,d.jsx)(f.$,{onClick:N,disabled:x,children:x?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(t.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Creando..."]}):"Crear Solicitud"})]})]})})}),(0,d.jsx)("div",{className:"space-y-3",children:U.map(a=>(0,d.jsx)(F,{request:a,canRespond:c,isResponding:z===a.id,response:J,onStartResponding:()=>A(a.id),onCancelResponding:()=>{A(null),K({respuesta:"",archivo_adjunto:""})},onResponseChange:K,onSendResponse:()=>O(a.id),onClose:()=>P(a.id),getStatusIcon:Q,getStatusBadge:R,getPriorityBadge:S,getTypeIcon:T},a.id))}),0===U.length&&(0,d.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,d.jsx)(s.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,d.jsx)("p",{children:"No hay solicitudes de informaci\xf3n"}),b&&(0,d.jsx)("p",{className:"text-sm mt-2",children:'Haz clic en "Nueva Solicitud" para crear la primera solicitud'})]})]})]})}function F({request:a,canRespond:b,isResponding:c,response:e,onStartResponding:i,onCancelResponding:j,onResponseChange:k,onSendResponse:l,onClose:m,getStatusIcon:n,getStatusBadge:p,getPriorityBadge:q,getTypeIcon:s}){let t=a.fecha_limite&&(0,o.m7)(a.fecha_limite)&&"respondida"!==a.estado&&"cerrada"!==a.estado;return(0,d.jsx)(g.Zp,{className:`border-l-4 ${t?"border-l-red-500":"border-l-blue-500"}`,children:(0,d.jsxs)(g.Wu,{className:"pt-4",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[n(a.estado||"pendiente"),(0,d.jsxs)("div",{children:[(0,d.jsx)("h4",{className:"font-medium text-gray-900",children:a.titulo}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[p(a.estado||"pendiente"),q(a.prioridad||"media"),(0,d.jsx)(h.E,{variant:"outline",children:s(a.tipo||"informacion")}),!a.es_publica&&(0,d.jsx)(h.E,{variant:"outline",children:"Privada"})]})]})]}),t&&(0,d.jsx)(v.A,{className:"h-5 w-5 text-red-500"})]}),(0,d.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:a.descripcion}),(0,d.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(w.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:a.creador?.nombre||"Usuario"})]}),(0,d.jsx)("span",{children:(0,o.fw)(a.created_at)}),a.fecha_limite&&(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(x.A,{className:"h-4 w-4"}),(0,d.jsxs)("span",{className:t?"text-red-600 font-medium":"",children:["L\xedmite: ",new Date(a.fecha_limite).toLocaleDateString("es-CL")]})]})]}),a.respuesta&&(0,d.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,d.jsx)(y,{className:"h-4 w-4 text-blue-600"}),(0,d.jsxs)("span",{className:"text-sm font-medium",children:["Respuesta de ",a.respondido_por_profile?.nombre||"Abogado"]}),(0,d.jsx)("span",{className:"text-xs text-gray-500",children:a.respondido_at&&(0,o.fw)(a.respondido_at)})]}),(0,d.jsx)("p",{className:"text-sm text-gray-700",children:a.respuesta}),a.archivo_adjunto&&(0,d.jsx)("a",{href:a.archivo_adjunto,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline mt-2 inline-block",children:"Ver archivo adjunto"})]}),c&&(0,d.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mb-3",children:(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("textarea",{value:e.respuesta,onChange:a=>k({...e,respuesta:a.target.value}),placeholder:"Escribe tu respuesta...",rows:3,className:"form-input"}),(0,d.jsx)("input",{type:"url",value:e.archivo_adjunto,onChange:a=>k({...e,archivo_adjunto:a.target.value}),placeholder:"URL del archivo adjunto (opcional)",className:"form-input"}),(0,d.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,d.jsx)(f.$,{size:"sm",variant:"outline",onClick:j,children:"Cancelar"}),(0,d.jsxs)(f.$,{size:"sm",onClick:l,children:[(0,d.jsx)(z.A,{className:"h-4 w-4 mr-1"}),"Enviar Respuesta"]})]})]})}),b&&"cerrada"!==a.estado&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:["respondida"!==a.estado&&!c&&(0,d.jsxs)(f.$,{size:"sm",variant:"outline",onClick:i,children:[(0,d.jsx)(y,{className:"h-4 w-4 mr-1"}),"Responder"]}),"respondida"===a.estado&&(0,d.jsxs)(f.$,{size:"sm",variant:"outline",onClick:m,children:[(0,d.jsx)(r.A,{className:"h-4 w-4 mr-1"}),"Cerrar"]})]})]})})}},87114:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},88237:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},88275:(a,b,c)=>{c.d(b,{E:()=>h});var d=c(59356);c(56389);var e=c(28321),f=c(16815);let g=(0,e.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800 hover:bg-green-200",warning:"border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",info:"border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200"}},defaultVariants:{variant:"default"}});function h({className:a,variant:b,...c}){return(0,d.jsx)("div",{className:(0,f.cn)(g({variant:b}),a),...c})}},91775:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},98366:(a,b,c)=>{c.d(b,{Io:()=>l,Ku:()=>n,Mf:()=>m,ai:()=>o,xS:()=>k});var d=c(61776);c(70958);var e=c(46221),f=c(83273),g=c(60619),h=c(56931),i=c(23024);function j(a,b,c,d,e){if(a&&Object.prototype.hasOwnProperty.call(a,c)){let f=a[c];b[d]=e?e(f):f}}async function k(a){try{let b=await (0,g.oC)(),c=i.ON.parse(a);if(!await (0,g.Nf)(c.case_id))throw Error("Sin permisos para acceder a este caso");if("cliente"===b.role)throw Error("Sin permisos para crear etapas");let d=await (0,f.R)(),j={case_id:c.case_id,etapa:c.etapa,orden:c.orden,estado:c.estado,es_publica:c.es_publica,responsable_id:c.responsable_id??b.id,descripcion:c.descripcion??null,fecha_programada:c.fecha_programada??null,fecha_cumplida:c.fecha_completada??null},{data:k,error:l}=await d.from("case_stages").insert(j).select(`
        *,
        responsable:profiles(nombre),
        case:cases(caratulado)
      `).single();if(l)throw Error("Error al crear la etapa");return await (0,h.UU)({action:"CREATE",entity_type:"case_stage",entity_id:k.id,diff_json:{created:j}}),(0,e.revalidatePath)(`/cases/${c.case_id}`),{success:!0,stage:k}}catch(a){return console.error("Error in createStage:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function l(a,b){try{let c=await (0,g.oC)(),d=i.l6.parse(b),k=await (0,f.R)(),{data:l,error:m}=await k.from("case_stages").select("*").eq("id",a).single();if(m||!l)throw Error("Etapa no encontrada");if(!await (0,g.Nf)(l.case_id))throw Error("Sin permisos para acceder a este caso");if("cliente"===c.role)throw Error("Sin permisos para editar etapas");if("abogado"===c.role&&l.responsable_id!==c.id)throw Error("Solo puedes editar etapas de las que eres responsable");let n={};j(d,n,"etapa","etapa"),j(d,n,"orden","orden"),j(d,n,"estado","estado"),j(d,n,"es_publica","es_publica"),j(d,n,"responsable_id","responsable_id"),j(d,n,"descripcion","descripcion",a=>a??null),j(d,n,"fecha_programada","fecha_programada",a=>a??null),j(d,n,"fecha_completada","fecha_cumplida",a=>a??null);let{data:o,error:p}=await k.from("case_stages").update(n).eq("id",a).select(`
        *,
        responsable:profiles(nombre),
        case:cases(caratulado)
      `).single();if(p)throw Error("Error al actualizar la etapa");return await (0,h.UU)({action:"UPDATE",entity_type:"case_stage",entity_id:a,diff_json:{from:l,to:o}}),(0,e.revalidatePath)(`/cases/${l.case_id}`),{success:!0,stage:o}}catch(a){return console.error("Error in updateStage:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function m(a,b={}){try{let c=await (0,g.oC)(),d=i.rw.parse(b),k=await (0,f.R)(),{data:l,error:m}=await k.from("case_stages").select("*").eq("id",a).single();if(m||!l)throw Error("Etapa no encontrada");if(!await (0,g.Nf)(l.case_id))throw Error("Sin permisos para acceder a este caso");if("cliente"===c.role)throw Error("Sin permisos para completar etapas");if("abogado"===c.role&&l.responsable_id!==c.id)throw Error("Solo puedes completar etapas de las que eres responsable");let n=d.fecha_completada||new Date().toISOString(),o={estado:"completado",fecha_cumplida:n};j(d,o,"observaciones","descripcion",a=>a??null);let{data:q,error:r}=await k.from("case_stages").update(o).eq("id",a).select(`
        *,
        responsable:profiles(nombre),
        case:cases(caratulado)
      `).single();if(r)throw Error("Error al completar la etapa");return await p(l.case_id),await (0,h.UU)({action:"COMPLETE",entity_type:"case_stage",entity_id:a,diff_json:{completed:o}}),(0,e.revalidatePath)(`/cases/${l.case_id}`),{success:!0,stage:q}}catch(a){return console.error("Error in completeStage:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function n(a){try{let b=await (0,g.oC)(),c=await (0,f.R)(),{data:d,error:i}=await c.from("case_stages").select("*").eq("id",a).single();if(i||!d)throw Error("Etapa no encontrada");if(!await (0,g.Nf)(d.case_id))throw Error("Sin permisos para acceder a este caso");if("admin_firma"!==b.role)throw Error("Sin permisos para eliminar etapas");let{error:j}=await c.from("case_stages").delete().eq("id",a);if(j)throw Error("Error al eliminar la etapa");return await (0,h.UU)({action:"DELETE",entity_type:"case_stage",entity_id:a,diff_json:{deleted:d}}),(0,e.revalidatePath)(`/cases/${d.case_id}`),{success:!0}}catch(a){return console.error("Error in deleteStage:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function o(a){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c={page:1,limit:20,...a??{}},d=i.T4.parse(c),e=await (0,f.R)(),h=e.from("case_stages").select(`
        *,
        responsable:profiles(id, nombre),
        case:cases(id, caratulado)
      `,{count:"exact"});if("cliente"===b.role){h=h.eq("es_publica",!0);let{data:a}=await e.from("case_clients").select("case_id").eq("client_profile_id",b.id),c=a?.map(a=>a.case_id)||[];if(0===c.length)return{success:!0,stages:[],total:0,page:d.page,limit:d.limit};h=h.in("case_id",c)}else if("abogado"===b.role){let{data:a}=await e.from("cases").select("id").eq("abogado_responsable",b.id),c=a?.map(a=>a.id)||[];if(0===c.length)return{success:!0,stages:[],total:0,page:d.page,limit:d.limit};h=h.in("case_id",c)}if(d.case_id){if(!await (0,g.Nf)(d.case_id))throw Error("Sin permisos para acceder a este caso");h=h.eq("case_id",d.case_id)}d.estado&&(h=h.eq("estado",d.estado)),d.responsable_id&&(h=h.eq("responsable_id",d.responsable_id)),void 0!==d.es_publica&&(h=h.eq("es_publica",d.es_publica)),d.fecha_desde&&(h=h.gte("fecha_programada",d.fecha_desde)),d.fecha_hasta&&(h=h.lte("fecha_programada",d.fecha_hasta));let j=(d.page-1)*d.limit,k=j+d.limit-1,{data:l,error:m,count:n}=await h.range(j,k).order("orden",{ascending:!0});if(m)throw Error("Error al obtener etapas");return{success:!0,stages:l||[],total:n||0,page:d.page,limit:d.limit}}catch(a){return console.error("Error in getStages:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",stages:[],total:0}}}async function p(a){let b=await (0,f.R)(),{data:c}=await b.from("case_stages").select("etapa").eq("case_id",a).eq("estado","pendiente").order("orden",{ascending:!0}).limit(1).maybeSingle(),d=c?.etapa??null;d&&await b.from("cases").update({etapa_actual:d}).eq("id",a)}(0,c(92714).D)([k,l,m,n,o]),(0,d.A)(k,"40a895831a1d42497e891995e8bb197427428e9822",null),(0,d.A)(l,"603c8c009a7c84bb476ed66b6019fa2d338b799f08",null),(0,d.A)(m,"60dfcfc9f2200e619dc6aa201aa596300c289585fd",null),(0,d.A)(n,"404a3ab7425ff7aa7340e79f8aac62f9e31f63a2cc",null),(0,d.A)(o,"401ae8f39de269ce4e02eb6353c902e2e4fa2c442b",null)}};