exports.id=236,exports.ids=[236],exports.modules={850:(a,b,c)=>{Promise.resolve().then(c.bind(c,54009))},5263:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>s,dynamic:()=>p,fetchCache:()=>r,revalidate:()=>q});var d=c(39322),e=c(63521),f=c(54009),g=c(47550),h=c(61878),i=c(10994),j=c(77649),k=c(12499),l=c(10168),m=c(59285),n=c(80555),o=c(74076);let p="force-dynamic",q=0,r="force-no-store";async function s({children:a}){let b=await (0,g.Rk)();b||(0,e.redirect)("/login");let c=b._role_override??b.role,p="admin_firma"===c?[{href:"/dashboard/admin",label:"Panel ejecutivo",description:"Indicadores clave de la firma",icon:(0,d.jsx)(h.A,{className:"h-4 w-4"})},{href:"/cases",label:"Casos de la firma",description:"Visi\xf3n global de expedientes activos",icon:(0,d.jsx)(i.A,{className:"h-4 w-4"})},{href:"/dashboard/admin/users",label:"Equipo y permisos",description:"Roles, accesos y estados",icon:(0,d.jsx)(j.A,{className:"h-4 w-4"})},{href:"/admin/security",label:"Seguridad",description:"Auditor\xeda y alertas cr\xedticas",icon:(0,d.jsx)(k.A,{className:"h-4 w-4"}),badge:"Nuevo"},{href:"/settings",label:"Configuraci\xf3n",description:"Preferencias, cat\xe1logos y plantillas",icon:(0,d.jsx)(l.A,{className:"h-4 w-4"})}]:"abogado"===c?[{href:"/dashboard/abogado",label:"Mi tablero",description:"Resumen diario y vencimientos pr\xf3ximos",icon:(0,d.jsx)(h.A,{className:"h-4 w-4"})},{href:"/cases",label:"Mis casos",description:"Gestiona expedientes asignados",icon:(0,d.jsx)(m.A,{className:"h-4 w-4"})},{href:"/cases/new",label:"Registrar caso",description:"Crea un nuevo expediente para la firma",icon:(0,d.jsx)(n.A,{className:"h-4 w-4"})}]:"analista"===c?[{href:"/dashboard/analista",label:"Bandeja de analista",description:"Priorizaci\xf3n de ingresos y validaci\xf3n",icon:(0,d.jsx)(h.A,{className:"h-4 w-4"})},{href:"/cases",label:"Casos en preparaci\xf3n",description:"Seguimiento de expedientes asignados",icon:(0,d.jsx)(o.A,{className:"h-4 w-4"})},{href:"/cases/new",label:"Nuevo caso",description:"Inicia la recopilaci\xf3n y asignaci\xf3n",icon:(0,d.jsx)(n.A,{className:"h-4 w-4"})}]:[{href:"/dashboard/cliente",label:"Portal cliente",description:"Seguimiento de tus procesos y avances",icon:(0,d.jsx)(h.A,{className:"h-4 w-4"})},{href:"/cases",label:"Documentos y expedientes",description:"Consulta los casos compartidos con tu firma",icon:(0,d.jsx)(i.A,{className:"h-4 w-4"})}],q=(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-foreground",children:"\xbfNecesitas soporte?"}),(0,d.jsxs)("p",{className:"text-xs leading-relaxed text-foreground/70",children:["Escr\xedbenos a ",(0,d.jsx)("span",{className:"font-medium text-primary",children:"soporte@xelchile.cl"})," o agenda una asesor\xeda onboarding desde tu dashboard."]})]}),r={nombre:b.nombre,role:c,email:b?.email??null};return(0,d.jsxs)("div",{className:"relative isolate min-h-screen bg-transparent",children:[(0,d.jsx)("div",{className:"pointer-events-none fixed inset-0 -z-10 bg-[radial-gradient(circle_at_top,_rgba(148,163,184,0.14),_transparent_55%),radial-gradient(circle_at_bottom,_rgba(59,130,246,0.12),_transparent_50%)]"}),(0,d.jsx)("div",{className:"absolute inset-x-0 top-0 -z-10 mx-auto h-32 w-full max-w-5xl rounded-full bg-white/50 blur-3xl opacity-70"}),(0,d.jsxs)("div",{className:"relative flex min-h-screen flex-col lg:flex-row",children:[(0,d.jsx)(f.AppSidebar,{items:p,profile:r,footer:q}),(0,d.jsx)("main",{className:"relative flex-1 lg:pl-0",children:(0,d.jsx)("div",{className:"pb-12 pt-8 sm:pt-10 lg:pt-0",children:(0,d.jsx)("div",{className:"mx-auto w-full max-w-5xl px-4 sm:px-5 lg:px-8",children:a})})})]})]})}},15352:(a,b,c)=>{"use strict";c.d(b,{R:()=>i,r:()=>j});var d=c(79106),e=c(57626),f=c(55124);let g="https://xsvvdshbhaheqymquzjl.supabase.co",h=process.env.SUPABASE_SERVICE_ROLE_KEY;async function i(){let a=await (0,d.UL)();return(0,e.createServerClient)(g,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzdnZkc2hiaGFoZXF5bXF1empsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MDUxMTMsImV4cCI6MjA3NTA4MTExM30.exy4Scb4paVi8tGs_-FXuHpIW9OFsbCS5sC8J_XdLv8",{cookies:{get:b=>a.get(b)?.value,set(b,c,d){try{d?a.set(b,c,d):a.set(b,c)}catch{}},remove(b,c){try{c?a.set(b,"",{...c,expires:new Date(0)}):a.set(b,"",{expires:new Date(0)})}catch{}}}})}function j(){return(0,f.UU)(g,h,{auth:{persistSession:!1}})}},24410:(a,b,c)=>{Promise.resolve().then(c.bind(c,61755))},38388:(a,b,c)=>{"use strict";c.d(b,{$:()=>j});var d=c(59356),e=c(56389),f=c(67339),g=c(28321),h=c(16815);let i=(0,g.F)("inline-flex items-center justify-center whitespace-nowrap rounded-2xl text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ring-offset-transparent",{variants:{variant:{default:"border border-white/30 bg-white/70 text-foreground shadow-sm backdrop-blur-xl hover:bg-white/90 focus-visible:ring-primary/40 focus-visible:ring-offset-transparent",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/90 focus-visible:ring-destructive/40 focus-visible:ring-offset-transparent",outline:"border border-white/30 bg-transparent text-foreground/80 hover:bg-white/10 focus-visible:ring-primary/30 focus-visible:ring-offset-transparent",secondary:"border border-transparent bg-primary text-primary-foreground shadow-lg hover:bg-primary/90 focus-visible:ring-primary/40 focus-visible:ring-offset-transparent",ghost:"border border-transparent bg-transparent text-foreground/70 hover:bg-white/10",link:"text-primary underline-offset-4 hover:underline hover:text-primary/80"},size:{default:"h-10 px-5",sm:"h-9 rounded-xl px-3.5",lg:"h-12 rounded-2xl px-8 text-base",icon:"h-10 w-10 rounded-xl"}},defaultVariants:{variant:"default",size:"default"}}),j=e.forwardRef(({className:a,variant:b,size:c,asChild:e=!1,...g},j)=>{let k=e?f.DX:"button";return(0,d.jsx)(k,{className:(0,h.cn)(i({variant:b,size:c,className:a})),ref:j,...g})});j.displayName="Button"},47550:(a,b,c)=>{"use strict";c.d(b,{Nf:()=>i,Rk:()=>g,oC:()=>h});var d=c(15352);let e={admin:"admin_firma",admin_firma:"admin_firma",adminfirma:"admin_firma","admin-firma":"admin_firma",adminlex:"admin_firma",firma_admin:"admin_firma",abogado:"abogado",analista:"analista",cliente:"cliente"};async function f(){let a=await (0,d.R)(),{data:b,error:c}=await a.auth.getUser();if(c||!b?.user)return console.warn("[AUTH] No hay usuario autenticado:",c),null;let f=b.user,g=f.id,h=function(a){let b=[],c=a.app_metadata??{},d=a.user_metadata??{};for(let a of(b.push(c.role,c.roles?.[0],c.user_role),b.push(d.role,d.roles?.[0],d.user_role),b.push(d.perfil_rol,d.profile_role,d.tipo,d.rol),(!0===c.claims_admin||!0===d.is_admin)&&b.push("admin_firma"),b)){let b=function a(b){if(null==b)return null;if(Array.isArray(b))return b.length?a(b[0]):null;if("boolean"==typeof b)return b?"admin_firma":null;let c=String(b).trim();return c?e[c.toLowerCase().replace(/[\s-]+/g,"_")]??null:null}(a);if(b)return b}return null}(f),{data:i,error:j}=await a.from("profiles").select("*").eq("id",g).maybeSingle();if(j)return console.error("[AUTH] Error seleccionando profiles por id:",j),null;if(i){let b=f.email??i.email??"";if(b&&b!==i.email){let{error:c}=await a.from("profiles").update({email:b}).eq("id",g);c&&console.warn("[AUTH] No se pudo sincronizar email en profiles:",c)}let c=f.user_metadata?.nombre??f.user_metadata?.name??null;if(c&&c!==i.nombre){let{error:b}=await a.from("profiles").update({nombre:String(c)}).eq("id",g);if(b)console.warn("[AUTH] No se pudo sincronizar nombre en profiles:",b);else{let{data:b}=await a.from("profiles").select("*").eq("id",g).maybeSingle();if(b){let a=h&&h!==b.role?h:null;return{...b,_role_override:a}}let c=h&&h!==i.role?h:null;return{...i,_role_override:c}}}if(h&&h!==i.role){let{data:b,error:c}=await a.from("profiles").update({role:h}).eq("id",g).select("*").maybeSingle();return c?(console.warn("[AUTH] No se pudo sincronizar rol en profiles:",c),{...i,_role_override:h??null}):b?{...b,_role_override:null}:(console.warn("[AUTH] Actualizaci\xf3n de rol no devolvi\xf3 datos, usando override local"),{...i,_role_override:h??null})}let d=h&&h!==i.role?h:null;return{...i,_role_override:d}}let k=f.user_metadata?.nombre??f.user_metadata?.name??(f.email??"").split("@")[0]??"Usuario",l={id:g,user_id:g,email:f.email??"",nombre:String(k),role:h??"cliente",activo:!0},{data:m,error:n}=await a.from("profiles").insert(l).select("*").maybeSingle();if(n)return console.error("[AUTH] Error creando perfil por primera vez:",n),null;if(console.info("[AUTH] Perfil creado autom\xe1ticamente:",{id:m?.id,email:m?.email,role:m?.role,metadataRole:h}),!m)return null;let o=h&&h!==m.role?h:null;return{...m,_role_override:o}}async function g(){let a=await f();if(!a)return null;let b=a._role_override,c=b??a.role??"cliente"??"cliente";return console.warn("[ROLE DEBUG] getCurrentProfile()",{auth_id:a.id,table_user_id:a.user_id,email:a.email,role_db:a.role,role_override:b,role_effective:c}),{...a,role:c}}async function h(a){let b=await g();if(!b)throw Error("No autenticado");let c=b.role;if(!a)return{...b,role:c};if(!(Array.isArray(a)?a:[a]).includes(c))throw Error("Sin permisos");return{...b,role:c}}async function i(a){return!0}},54009:(a,b,c)=>{"use strict";c.d(b,{AppSidebar:()=>d});let d=(0,c(73106).registerClientReference)(function(){throw Error("Attempted to call AppSidebar() from the server but AppSidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/hh/Downloads/lexchile/src/components/layout/AppSidebar.tsx","AppSidebar")},61755:(a,b,c)=>{"use strict";c.d(b,{AppSidebar:()=>l});var d=c(59356),e=c(81647),f=c.n(e),g=c(5074),h=c(16815),i=c(87879),j=c(50848),k=c(56389);function l({items:a,profile:b,footer:c}){let e=(0,g.usePathname)(),[l,m]=(0,k.useState)(!1),n=a=>{let b=e===a.href||e.startsWith(`${a.href}/`);return(0,d.jsxs)(f(),{href:a.href,onClick:()=>m(!1),className:(0,h.cn)("group relative flex items-start gap-3 rounded-2xl border border-white/10 bg-white/20 px-4 py-3 transition-all hover:border-primary/30 hover:bg-primary/10",b&&"border-primary/40 bg-primary/15 text-primary shadow"),children:[(0,d.jsx)("span",{className:"mt-0.5 inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/20 bg-white/50 text-foreground/70",children:a.icon}),(0,d.jsxs)("span",{className:"flex-1 text-sm leading-snug",children:[(0,d.jsxs)("span",{className:"font-medium flex items-center gap-2",children:[a.label,a.badge&&(0,d.jsx)("span",{className:"rounded-full bg-primary/15 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wider text-primary",children:a.badge})]}),a.description&&(0,d.jsx)("span",{className:"mt-0.5 block text-xs text-foreground/60",children:a.description})]})]},a.href)};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("aside",{className:"hidden h-full min-h-screen w-64 flex-col gap-6 border-r border-white/15 bg-white/55 px-5 py-6 shadow-xl backdrop-blur-2xl lg:flex",children:[(0,d.jsx)("div",{className:"space-y-8",children:(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-foreground/50",children:"Navegaci\xf3n"}),(0,d.jsx)("div",{className:"mt-4 space-y-2",children:a.map(n)})]})}),(0,d.jsxs)("div",{className:"rounded-2xl border border-white/20 bg-white/40 px-4 py-3 text-sm text-foreground/70",children:[(0,d.jsx)("p",{className:"font-medium text-foreground",children:b.nombre}),(0,d.jsx)("p",{className:"text-xs uppercase tracking-wide text-foreground/50",children:b.role.replace("_"," ")}),b.email&&(0,d.jsx)("p",{className:"mt-1 text-xs text-foreground/50",children:b.email}),(0,d.jsx)("div",{className:"mt-3",children:(0,d.jsx)(i.default,{})})]}),c&&(0,d.jsx)("div",{className:"rounded-2xl border border-dashed border-white/30 bg-white/20 px-4 py-4 text-xs text-foreground/60",children:c})]}),(0,d.jsxs)("div",{className:"sticky top-0 z-30 flex items-center justify-between border-b border-white/20 bg-white/70 px-4 py-3 backdrop-blur-xl lg:hidden",children:[(0,d.jsx)("button",{type:"button",onClick:()=>m(a=>!a),className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-white/30 bg-white/60 text-foreground shadow",children:(0,d.jsx)(j.A,{className:"h-5 w-5"})}),(0,d.jsxs)("div",{className:"text-right text-xs text-foreground/60",children:[(0,d.jsx)("p",{className:"font-semibold text-foreground",children:b.nombre}),(0,d.jsx)("p",{children:b.role.replace("_"," ")})]})]}),l&&(0,d.jsxs)("div",{className:"fixed inset-x-4 top-20 z-30 rounded-3xl border border-white/20 bg-white/80 p-4 shadow-2xl backdrop-blur-2xl lg:hidden",children:[(0,d.jsx)("div",{className:"space-y-2",children:a.map(n)}),(0,d.jsxs)("div",{className:"mt-4 rounded-2xl border border-white/20 bg-white/40 px-4 py-3 text-sm text-foreground/70",children:[(0,d.jsx)("p",{className:"font-medium text-foreground",children:b.nombre}),(0,d.jsx)("p",{className:"text-xs uppercase tracking-wide text-foreground/50",children:b.role.replace("_"," ")}),b.email&&(0,d.jsx)("p",{className:"mt-1 text-xs text-foreground/50",children:b.email}),(0,d.jsx)("div",{className:"mt-3",children:(0,d.jsx)(i.default,{})})]}),c&&(0,d.jsx)("div",{className:"mt-4 rounded-2xl border border-dashed border-white/30 bg-white/20 px-4 py-3 text-xs text-foreground/60",children:c})]})]})}},87879:(a,b,c)=>{"use strict";c.d(b,{default:()=>h});var d=c(59356),e=c(56389),f=c(5074),g=c(38388);function h(){let[a,b]=(0,e.useState)(!1),c=(0,f.useRouter)(),h=async()=>{b(!0);try{await fetch("/api/logout",{method:"POST"}),c.replace("/login")}finally{b(!1)}};return(0,d.jsx)(g.$,{variant:"ghost",onClick:h,disabled:a,children:a?"Saliendoâ€¦":"Cerrar sesi\xf3n"})}}};