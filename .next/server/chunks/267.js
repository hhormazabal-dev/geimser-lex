"use strict";exports.id=267,exports.ids=[267],exports.modules={23024:(a,b,c)=>{c.d(b,{CT:()=>k,ON:()=>e,T4:()=>h,l6:()=>f,rw:()=>g});var d=c(73771);let e=d.Ik({case_id:d.Yj().uuid("ID de caso inv\xe1lido"),etapa:d.Yj().min(1,"El nombre de la etapa es requerido").max(1e3,"El nombre no puede exceder 1000 caracteres"),descripcion:d.Yj().optional(),fecha_programada:d.Yj().optional(),fecha_completada:d.Yj().optional(),estado:d.k5(["pendiente","en_proceso","completado"]).default("pendiente"),es_publica:d.zM().default(!0),orden:d.ai().int().positive("El orden debe ser un n\xfamero positivo"),responsable_id:d.Yj().uuid("ID de responsable inv\xe1lido").optional(),audiencia_tipo:d.k5(["preparatoria","juicio"]).optional(),requiere_testigos:d.zM().default(!1),requiere_pago:d.zM().default(!1),costo_uf:d.ai().min(0,"El costo debe ser positivo").optional(),porcentaje_variable:d.ai().min(0,"El porcentaje debe ser positivo").max(100,"El porcentaje no puede exceder 100").optional(),estado_pago:d.k5(["pendiente","en_proceso","parcial","pagado","vencido"]).default("pendiente"),enlace_pago:d.Yj().url("Debe ser una URL v\xe1lida").optional(),notas_pago:d.Yj().max(1e3,"Las notas no pueden exceder 1000 caracteres").optional(),monto_variable_base:d.Yj().optional(),monto_pagado_uf:d.ai().min(0,"El monto pagado debe ser positivo").optional()}),f=e.partial().omit({case_id:!0}),g=d.Ik({fecha_completada:d.Yj().optional(),observaciones:d.Yj().optional()}),h=d.Ik({case_id:d.Yj().uuid().optional(),estado:d.k5(["pendiente","en_proceso","completado"]).optional(),responsable_id:d.Yj().uuid().optional(),es_publica:d.zM().optional(),fecha_desde:d.Yj().optional(),fecha_hasta:d.Yj().optional(),page:d.ai().min(1).default(1),limit:d.ai().min(1).max(100).default(20)}),i={Civil:[.15,.1,.1,.1,.15,.2,.1,.05,.05],Comercial:[.2,.15,.15,.2,.15,.1,.05],Laboral:[.2,.2,.2,.2,.1,.1],Familia:[.2,.15,.15,.15,.2,.15]},j={Civil:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda con antecedentes y revisi\xf3n formal del tribunal.",diasEstimados:0},{etapa:"Notificaci\xf3n a la contraparte",descripcion:"Gestiones de notificaci\xf3n personal o por c\xe9dula al demandado.",diasEstimados:30},{etapa:"Contestaci\xf3n de la demanda",descripcion:"Plazo legal para que la contraparte conteste y proponga excepciones.",diasEstimados:20},{etapa:"R\xe9plicas y d\xfaplicas",descripcion:"Intercambio de escritos aclarando puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia preparatoria",descripcion:"Fijaci\xf3n de puntos de prueba y acuerdos probatorios.",diasEstimados:30},{etapa:"Periodo probatorio",descripcion:"Recepci\xf3n de declaraciones, oficios, peritajes y documental.",diasEstimados:45},{etapa:"Alegatos y vista de la causa",descripcion:"Audiencia de cierre donde las partes exponen sus argumentos finales.",diasEstimados:20},{etapa:"Sentencia de primera instancia",descripcion:"Redacci\xf3n y publicaci\xf3n del fallo por el tribunal.",diasEstimados:60},{etapa:"Recursos y cumplimiento",descripcion:"Interposici\xf3n de recursos o cumplimiento voluntario/forzado.",diasEstimados:30}],Comercial:[{etapa:"Ingreso Demanda",descripcion:"Presentaci\xf3n de la demanda y verificaci\xf3n formal.",diasEstimados:0},{etapa:"Notificaci\xf3n demandado",descripcion:"Gesti\xf3n de notificaci\xf3n a la contraparte y acreditaci\xf3n en autos.",diasEstimados:20},{etapa:"Contestaci\xf3n y reconvenci\xf3n",descripcion:"Respuesta del demandado y eventuales reconvenciones.",diasEstimados:20},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de hechos a probar y medios de prueba.",diasEstimados:25},{etapa:"Prueba y alegatos",descripcion:"Producci\xf3n de prueba documental, testimonial y alegatos finales.",diasEstimados:40},{etapa:"Sentencia",descripcion:"Decisi\xf3n del tribunal y notificaci\xf3n a las partes.",diasEstimados:45},{etapa:"Ejecuci\xf3n o recursos",descripcion:"Cumplimiento del fallo o tramitaci\xf3n de recursos.",diasEstimados:30}],Laboral:[{etapa:"Ingreso tutela o demanda laboral",descripcion:"Ingreso del escrito y asignaci\xf3n de audiencia preliminar.",diasEstimados:0},{etapa:"Citaciones y notificaci\xf3n empleador",descripcion:"Notificaci\xf3n de la demanda y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Intento de conciliaci\xf3n y fijaci\xf3n de puntos controvertidos.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Producci\xf3n de prueba y alegatos finales.",diasEstimados:20},{etapa:"Sentencia laboral",descripcion:"Pronunciamiento del tribunal y notificaci\xf3n a las partes.",diasEstimados:15},{etapa:"Cumplimiento / Recurso de nulidad",descripcion:"Tramitaci\xf3n de recursos o ejecuci\xf3n de la sentencia.",diasEstimados:20}],Familia:[{etapa:"Ingreso demanda o escrito inicial",descripcion:"Ingreso de medida de protecci\xf3n o demanda ante tribunal de familia.",diasEstimados:0},{etapa:"Notificaci\xf3n y citaci\xf3n a audiencia",descripcion:"Notificaci\xf3n a la contraparte y citaci\xf3n a audiencia preparatoria.",diasEstimados:10},{etapa:"Audiencia preparatoria",descripcion:"Determinaci\xf3n de puntos controvertidos y acumulaci\xf3n de prueba.",diasEstimados:15},{etapa:"Audiencia de juicio",descripcion:"Presentaci\xf3n de prueba, declaraciones y alegatos.",diasEstimados:20},{etapa:"Sentencia",descripcion:"Redacci\xf3n y comunicaci\xf3n del fallo.",diasEstimados:20},{etapa:"Cumplimiento y seguimiento",descripcion:"Ejecuci\xf3n de medidas decretadas y seguimiento del cumplimiento.",diasEstimados:25}]};function k(a){if(!a)return j.Civil;let b=a.toLowerCase(),c=Object.keys(j).find(a=>a.toLowerCase()===b),d=c?j[c]:j.Civil,e=c&&i[c]?i[c]:i.Civil??[];return d.map((a,b)=>({...a,porcentajeHonorario:e[b]??0}))}},56931:(a,b,c)=>{c.d(b,{UU:()=>h});var d=c(61776);c(70958);var e=c(88239),f=c(83273),g=c(60619);async function h(a){try{let b=await (0,g.Rk)();if(!b)return void console.warn("Attempted to log audit action without authenticated user");let c=await (0,f.R)(),d=await (0,e.b3)(),h={action:a.action,actor_id:b.id,entity_type:a.entity_type,entity_id:a.entity_id??null,diff_json:a.diff_json,ip_address:d.get("x-forwarded-for")??d.get("x-real-ip")??"unknown",user_agent:d.get("user-agent")??"unknown"},{error:i}=await c.from("audit_log").insert(h);i&&console.error("Error logging audit action:",i)}catch(a){console.error("Error in logAuditAction:",a)}}async function i(a,b){try{let c=await (0,g.Rk)();if(!c||"admin_firma"!==c.role)throw Error("Sin permisos para ver auditor\xeda");let d=await (0,f.R)(),{data:e,error:h}=await d.from("audit_log").select(`
        *,
        actor:profiles(nombre)
      `).eq("entity_type",a).eq("entity_id",b).order("created_at",{ascending:!1});if(h)throw console.error("Error fetching audit history:",h),Error("Error al obtener historial de auditor\xeda");return{success:!0,logs:e||[]}}catch(a){return console.error("Error in getAuditHistory:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",logs:[]}}}async function j(a=30){try{let b=await (0,g.Rk)();if(!b||"admin_firma"!==b.role)throw Error("Sin permisos para ver estad\xedsticas de auditor\xeda");let c=await (0,f.R)(),d=new Date;d.setDate(d.getDate()-a);let{data:e,error:h}=await c.from("audit_log").select("action, entity_type, created_at").gte("created_at",d.toISOString());if(h)throw console.error("Error fetching audit stats:",h),Error("Error al obtener estad\xedsticas de auditor\xeda");let i={},j={},k={};return(e??[]).forEach(a=>{if(a.action&&(i[a.action]=(i[a.action]||0)+1),a.entity_type&&(j[a.entity_type]=(j[a.entity_type]||0)+1),a.created_at){let b=new Date(a.created_at),c=isNaN(b.getTime())?null:b.toISOString().split("T")[0];c&&(k[c]=(k[c]||0)+1)}}),{success:!0,stats:{totalActions:e?.length||0,actionCounts:i,entityCounts:j,dailyActivity:k}}}catch(a){return console.error("Error in getAuditStats:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido",stats:null}}}(0,c(92714).D)([h,i,j]),(0,d.A)(h,"40282ba09180f9fcc21224d9834d438898694c4c60",null),(0,d.A)(i,"60a477dd19bca3f7aa06246afec74f1a00e9bf2afa",null),(0,d.A)(j,"4056722204401e60a651ebd53b745456b5caeee576",null)},93267:(a,b,c)=>{c.d(b,{cN:()=>v,OV:()=>t,bx:()=>p,$E:()=>q,CH:()=>w,tT:()=>y,Eh:()=>x,nl:()=>u,KQ:()=>s,Gm:()=>r});var d=c(61776);c(70958);var e=c(46221),f=c(83273),g=c(60619),h=c(56931),i=c(62481),j=c(23024);let k=[{codigo:"consulta",titulo:"Honorarios Profesionales - Consulta",items:[{id:"consulta_atencion_personal",nombre:"Consulta profesional (atenci\xf3n personal)",montoUf:1,notas:"Se descuenta del honorario final si el cliente contrata el servicio asociado."},{id:"consulta_informe_escrito",nombre:"Consulta con estudio documental e informe escrito",montoUf:2,notas:"Incluye revisi\xf3n de antecedentes y env\xedo de informe. Se descuenta del honorario final si se contrata el servicio."}]},{codigo:"constitucional",titulo:"Materias Constitucionales",items:[{id:"recurso_proteccion",nombre:"Recurso de protecci\xf3n",montoUf:30,notas:"40 UF si se tramita apelaci\xf3n."},{id:"recurso_proteccion_isapre",nombre:"Recurso de protecci\xf3n por alza de plan de ISAPRE",descripcion:"Cobro de costas de la causa.",notas:"Se facturan las costas procesales obtenidas."},{id:"recurso_amparo",nombre:"Recurso de amparo",montoUf:15,notas:"20 UF si se tramita apelaci\xf3n."}]},{codigo:"civil",titulo:"Materias Civiles",items:[{id:"medidas_prejudiciales",nombre:"Medidas prejudiciales",escalas:[{condicion:"Si con la medida se resuelve el conflicto que motivaba el juicio posterior",montoUf:15},{condicion:"En caso contrario",montoUf:5}]},{id:"juicio_ordinario_mayor_cuantia",nombre:"Juicio ordinario de mayor cuant\xeda",montoUf:30,porcentaje:10,porcentajeSobre:"lo obtenido con la demanda o lo ahorrado por la defensa",notas:"Si hay reconvenci\xf3n: 50 UF + 10% de la demanda principal + 10% de lo obtenido o ahorrado por la reconvenci\xf3n."},{id:"juicio_ordinario_menor_cuantia",nombre:"Juicio ordinario de menor cuant\xeda",montoUf:20,porcentaje:10,porcentajeSobre:"lo obtenido con la demanda o lo ahorrado por la defensa",notas:"Con reconvenci\xf3n: 30 UF + 10% de la demanda principal + 10% de la reconvenci\xf3n."},{id:"juicio_ordinario_minima_cuantia",nombre:"Juicio ordinario de m\xednima cuant\xeda",montoUf:10,porcentaje:10,porcentajeSobre:"lo obtenido con la demanda o lo ahorrado por la defensa"},{id:"preparacion_via_ejecutiva",nombre:"Preparaci\xf3n de la v\xeda ejecutiva",montoUf:10},{id:"juicio_ejecutivo",nombre:"Juicio ejecutivo (principal o incidental)",montoUf:20,porcentaje:10,porcentajeSobre:"lo obtenido con la demanda o lo ahorrado por la defensa"},{id:"tercerias_ejecutivo",nombre:"Tercer\xedas en juicio ejecutivo",escalas:[{condicion:"De dominio o de posesi\xf3n",montoUf:10},{condicion:"De prelaci\xf3n o pago",porcentaje:10,porcentajeSobre:"lo obtenido",minimoUf:10}]},{id:"juicio_sumario",nombre:"Juicio sumario",montoUf:20,porcentaje:10,porcentajeSobre:"lo obtenido o lo ahorrado"},{id:"juicio_arrendamiento",nombre:"Juicio especial de arrendamiento",escalas:[{condicion:"Deuda hasta 50 UF",montoUf:10},{condicion:"Deuda entre 51 y 100 UF",montoUf:15},{condicion:"Deuda superior a 100 UF",montoUf:20}]},{id:"juicio_posesorio",nombre:"Juicio posesorio",montoUf:20},{id:"juicio_interdiccion",nombre:"Juicio de interdicci\xf3n",montoUf:20},{id:"juicio_cuentas",nombre:"Juicio sobre cuentas",escalas:[{condicion:"Sin observaciones",montoUf:10},{condicion:"Con observaciones",montoUf:25}]},{id:"transaccion_previa",nombre:"Transacci\xf3n antes del juicio",porcentaje:25,porcentajeSobre:"del honorario que corresponder\xeda al juicio que se evita"},{id:"pago_consignacion",nombre:"Pago por consignaci\xf3n",montoUf:10,notas:"En la calificaci\xf3n de suficiencia se aplican los honorarios del juicio ordinario."},{id:"retencion_accion_especial",nombre:"Declaraci\xf3n judicial del derecho de retenci\xf3n",montoUf:10},{id:"insinuacion_donaciones",nombre:"Insinuaci\xf3n de donaciones",montoUf:20},{id:"cambio_nombre",nombre:"Cambio de nombre",montoUf:20},{id:"rectificacion_partida_civil",nombre:"Rectificaci\xf3n de partida de estado civil",montoUf:20},{id:"estudio_titulo_bienes_raices",nombre:"Examen o formaci\xf3n de t\xedtulo de bienes ra\xedces",porcentaje:2,porcentajeSobre:"valor del inmueble",minimoUf:5,notas:"No incluye la redacci\xf3n de contratos derivados, que se cobran adicionalmente."},{id:"redaccion_contratos",nombre:"Redacci\xf3n de contratos, convenios o estatutos",porcentaje:2,porcentajeSobre:"valor del negocio",minimoUf:5,notas:"Sin cuant\xeda: 8 UF. Modificaciones: 50% del honorario original con m\xednimo de 4 UF."},{id:"redaccion_testamento",nombre:"Redacci\xf3n de testamento",escalas:[{condicion:"Bienes hasta 1.000 UF",montoUf:20},{condicion:"Bienes superiores a 1.000 UF",porcentaje:5,porcentajeSobre:"del valor de la masa"}]},{id:"muerte_presunta",nombre:"Declaraci\xf3n de muerte presunta",montoUf:20},{id:"herencia_yacente",nombre:"Declaraci\xf3n de herencia yacente",montoUf:20,notas:"Incluye nombramiento de curador."},{id:"apertura_testamento",nombre:"Apertura o publicaci\xf3n de testamento",montoUf:20},{id:"posesion_efectiva_judicial",nombre:"Posesi\xf3n efectiva judicial",montoUf:20},{id:"albaceazgo",nombre:"Albaceazgo",escalas:[{condicion:"Con tenencia de bienes",porcentaje:10,porcentajeSobre:"bienes de la herencia",minimoUf:20},{condicion:"Sin tenencia de bienes",porcentaje:5,porcentajeSobre:"bienes de la herencia",minimoUf:15}]},{id:"gestiones_judiciales_varias",nombre:"Otras gestiones judiciales",escalas:[{condicion:"Nombramiento de guardadores y discernimiento",montoUf:15},{condicion:"Notificaci\xf3n de actos jur\xeddicos a terceros",montoUf:5},{condicion:"Notificaci\xf3n de protestos",montoUf:5},{condicion:"Inscripci\xf3n por negativa del conservador",montoUf:10},{condicion:"Inventario solemne",montoUf:5}]},{id:"expropiacion_utilidad_publica",nombre:"Expropiaci\xf3n de causa de utilidad p\xfablica",escalas:[{condicion:"Hasta 1.000 UF",porcentaje:10,porcentajeSobre:"valor ordenado pagar"},{condicion:"Sobre 1.000 UF",porcentaje:5,porcentajeSobre:"valor ordenado pagar"}],minimoUf:15,notas:"No incluye la suma ofrecida voluntariamente por el expropiante. El m\xednimo es 15 UF."},{id:"materias_aguas",nombre:"Materias de aguas",escalas:[{condicion:"Regularizaci\xf3n art. 1\xb0 transitorio",montoUf:30},{condicion:"Regularizaci\xf3n art. 2\xb0 transitorio",montoUf:40},{condicion:"Otras formas administrativas de regularizaci\xf3n",montoUf:30},{condicion:"Constituci\xf3n o reforma de organizaciones de usuarios",montoUf:30},{condicion:"Juicios sumarios",montoUf:20},{condicion:"Acciones de amparo de aguas",montoUf:20}]},{id:"arbitrajes",nombre:"Arbitrajes",escalas:[{condicion:"Masa hasta 5.000 UF",porcentaje:10,porcentajeSobre:"valor de la masa",minimoUf:30},{condicion:"Masa entre 5.000 y 15.000 UF",porcentaje:6,porcentajeSobre:"valor de la masa"},{condicion:"Masa entre 15.000 y 30.000 UF",porcentaje:4,porcentajeSobre:"valor de la masa"},{condicion:"Exceso sobre 30.000 UF",porcentaje:2,porcentajeSobre:"valor de la masa excedente"}],notas:"Si el \xe1rbitro es administrador com\xfan, aumenta en 25%. Si incluye partici\xf3n de sociedad conyugal y herencia, se incrementa en 15%. Escritura p\xfablica o liquidaci\xf3n por separaci\xf3n de bienes: 50% del honorario indicado."}]},{codigo:"mineria",titulo:"Materias de Miner\xeda",items:[{id:"propiedad_minera_carbon",nombre:"Constituci\xf3n de propiedad minera en yacimientos carbon\xedferos",montoUf:50},{id:"autorizacion_catar_cavar",nombre:"Autorizaci\xf3n judicial para catar y cavar",montoUf:40},{id:"constitucion_propiedad_minera",nombre:"Constituci\xf3n de propiedad minera",montoUf:50},{id:"permiso_exclusivo_explotar",nombre:"Autorizaci\xf3n judicial de permiso exclusivo para explotar",montoUf:50},{id:"oposicion_mensura",nombre:"Juicio de oposici\xf3n o nulidad de mensura",notas:"Entre 50 y 150 UF seg\xfan complejidad."},{id:"administracion_minera",nombre:"Juicios sobre administraci\xf3n del minero o servidumbres mineras",notas:"Entre 50 y 150 UF seg\xfan complejidad."},{id:"internacion_pertenencias",nombre:"Sobre internaci\xf3n de pertenencias",escalas:[{condicion:"Si es susceptible de apreciaci\xf3n pecuniaria",montoUf:30,porcentaje:1,porcentajeSobre:"valor de la pertenencia"},{condicion:"Casos sin apreciaci\xf3n pecuniaria",montoUf:30}]}]},{codigo:"comercial",titulo:"Materias Comerciales",items:[{id:"sociedad_personas",nombre:"Constituci\xf3n de sociedad de personas",porcentaje:10,porcentajeSobre:"capital suscrito",minimoUf:15},{id:"sociedad_capital",nombre:"Constituci\xf3n de sociedad de capital",porcentaje:10,porcentajeSobre:"capital suscrito",minimoUf:30},{id:"constitucion_eirl",nombre:"Constituci\xf3n de EIRL",porcentaje:10,porcentajeSobre:"capital suscrito",minimoUf:15},{id:"modificacion_sociedad",nombre:"Modificaci\xf3n de sociedades o EIRL",notas:"2/3 del honorario m\xednimo fijado para la constituci\xf3n correspondiente."},{id:"quiebras",nombre:"Quiebras",notas:"Defensa del fallido: 50% del honorario del juicio ordinario. Defensa de acreedores: 10% de lo que perciban. Impugnaciones: 10% de la cantidad discutida. Alzamiento o discusi\xf3n de la quiebra: 75% del juicio ordinario. Rehabilitaci\xf3n del fallido: 20 UF. Convenio judicial preventivo o extrajudicial: 10% del pasivo con m\xednimo de 20 UF."},{id:"registro_marcas",nombre:"Registro de marcas",montoUf:15,notas:"Con oposici\xf3n: 30 UF."}]},{codigo:"laboral",titulo:"Materias Laborales",items:[{id:"juicio_laboral_ordinario",nombre:"Juicio laboral ordinario (cobro prestaciones)",notas:"Trabajador: 10 UF + 10% de lo obtenido. Empleador: 20 UF + 20% de lo ahorrado."},{id:"juicio_laboral_monitorio",nombre:"Juicio monitorio laboral",notas:"Trabajador: 15 UF. Empleador: 25 UF."},{id:"juicio_laboral_ejecutivo",nombre:"Juicio ejecutivo laboral",notas:"Trabajador: 10 UF + 10% de lo obtenido. Empleador: 20 UF + 20% de lo ahorrado."},{id:"desafuero",nombre:"Juicios de desafuero",notas:"Trabajador: 15 UF. Empleador: 20 UF."},{id:"amparo_laboral",nombre:"Amparo laboral",notas:"Trabajador: 15 UF. Empleador: 25 UF."},{id:"avenimiento_extrajudicial",nombre:"Avenimiento extrajudicial",notas:"Trabajador: 5 UF + 10% de lo obtenido. Empleador: 10 UF + 20% de lo ahorrado."},{id:"indemnizacion_accidente",nombre:"Indemnizaci\xf3n por accidente del trabajo",notas:"Trabajador: 10 UF + 10% de lo obtenido. Empleador: 20 UF + 20% de lo ahorrado."},{id:"indemnizacion_enfermedad",nombre:"Indemnizaci\xf3n por enfermedad profesional",notas:"Trabajador: 10 UF + 10% de lo obtenido. Empleador: 20 UF + 20% de lo ahorrado."},{id:"constitucion_sindicato",nombre:"Constituci\xf3n de sindicatos",montoUf:30},{id:"constitucion_federaciones",nombre:"Constituci\xf3n de federaciones o confederaciones",montoUf:50},{id:"defensa_sindicato",nombre:"Defensa de sindicato (disoluci\xf3n)",montoUf:30},{id:"defensa_dirigente",nombre:"Defensa de dirigente sindical",montoUf:15},{id:"negociacion_colectiva",nombre:"Negociaci\xf3n colectiva",notas:"Representando a trabajadores: 15 UF + 0,5 UF por trabajador. Representando al empleador: 25 UF + 1 UF por trabajador."},{id:"reclamos_empresa",nombre:"Reclamos por pr\xe1cticas de la empresa",montoUf:15},{id:"reclamos_sindicato",nombre:"Reclamos contra sindicato",montoUf:15},{id:"reclamo_multas",nombre:"Reclamo de multas",montoUf:15},{id:"reclamo_resoluciones",nombre:"Reclamo de otras resoluciones administrativas",montoUf:10},{id:"cobranza_previsional",nombre:"Cobranza previsional",montoUf:15}]},{codigo:"familia",titulo:"Materias de Familia",items:[{id:"cuidado_personal",nombre:"Causas de cuidado personal",montoUf:20},{id:"patria_potestad",nombre:"Ejercicio, suspensi\xf3n o p\xe9rdida de patria potestad",montoUf:15},{id:"alimentos",nombre:"Causas de alimentos",montoUf:15,porcentaje:50,porcentajeSobre:"de la pensi\xf3n demandada"},{id:"disensos",nombre:"Disensos para contraer matrimonio",montoUf:20},{id:"guardas",nombre:"Guardas",montoUf:15},{id:"medidas_proteccion",nombre:"Medidas de protecci\xf3n",montoUf:15},{id:"filiacion",nombre:"Acciones de filiaci\xf3n",montoUf:20},{id:"salida_menor",nombre:"Autorizaci\xf3n de salida del pa\xeds para menores",montoUf:20},{id:"procedimiento_prev_adopcion",nombre:"Procedimientos previos a la adopci\xf3n",montoUf:15},{id:"adopcion",nombre:"Procedimiento de adopci\xf3n",montoUf:20},{id:"regimen_matrimonial",nombre:"Asuntos patrimoniales entre c\xf3nyuges",escalas:[{condicion:"Bienes hasta 1.000 UF",porcentaje:5,porcentajeSobre:"valor de los bienes"},{condicion:"Bienes sobre 1.000 UF",porcentaje:2,porcentajeSobre:"valor de los bienes"}]},{id:"bienes_familiares",nombre:"Declaraci\xf3n o desafectaci\xf3n de bienes familiares",notas:"5% sobre bienes hasta 1.000 UF; 2% sobre el exceso. Se aplica tambi\xe9n a usufructo, uso o habitaci\xf3n."},{id:"separacion_judicial",nombre:"Separaci\xf3n judicial",montoUf:15},{id:"nulidad_matrimonio",nombre:"Nulidad de matrimonio",montoUf:20},{id:"divorcio_culpa",nombre:"Divorcio por culpa",montoUf:30},{id:"divorcio_cese_convivencia",nombre:"Divorcio por cese efectivo de la convivencia",escalas:[{condicion:"Demandado unilateralmente",montoUf:20},{condicion:"Solicitado de com\xfan acuerdo",montoUf:8,notas:"Por cada c\xf3nyuge representado"}]},{id:"interdiccion",nombre:"Declaraci\xf3n de interdicci\xf3n",montoUf:20},{id:"violencia_intrafamiliar",nombre:"Violencia intrafamiliar",montoUf:15},{id:"compensacion_economica",nombre:"Compensaci\xf3n econ\xf3mica en divorcio",porcentaje:10,porcentajeSobre:"de lo obtenido o lo ahorrado",minimoUf:15},{id:"policia_local",nombre:"Materias de polic\xeda local (querellas infraccionales)",montoUf:15},{id:"policia_local_indemnizacion",nombre:"Materias de polic\xeda local (indemnizaci\xf3n de perjuicios)",montoUf:10,porcentaje:10,porcentajeSobre:"de lo obtenido o ahorrado"},{id:"consumidor",nombre:"Demandas ley del consumidor",notas:"Clientes: 10 UF + 10% de lo obtenido. Empresas: 20 UF."}]},{codigo:"penal",titulo:"Materias Penales",items:[{id:"defensa_ordinario",nombre:"Defensa en procedimiento ordinario",escalas:[{condicion:"Termina con salida alternativa",montoUf:15},{condicion:"Termina en juicio abreviado",montoUf:100},{condicion:"Termina en juicio oral",montoUf:150}]},{id:"defensa_simplificado",nombre:"Defensa en procedimiento simplificado",escalas:[{condicion:"Acepta responsabilidad o salida alternativa",montoUf:15},{condicion:"Juicio simplificado efectivo",montoUf:30}]},{id:"querella_ordinario",nombre:"Querella en procedimiento ordinario",montoUf:30},{id:"querella_simplificado",nombre:"Querella en procedimiento simplificado",montoUf:15},{id:"demanda_civil_penal",nombre:"Demanda civil en sede penal",porcentaje:10,porcentajeSobre:"de lo obtenido",minimoUf:15}]},{codigo:"recursos",titulo:"Recursos",items:[{id:"apelacion_casacion",nombre:"Apelaci\xf3n o casaci\xf3n",porcentaje:50,porcentajeSobre:"del arancel de primera instancia"},{id:"nulidad_penal",nombre:"Recurso de nulidad penal",montoUf:50},{id:"nulidad_laboral",nombre:"Recurso de nulidad laboral",notas:"Trabajador: 15 UF. Empleador: 25 UF."},{id:"unificacion_jurisprudencia",nombre:"Recurso de unificaci\xf3n de jurisprudencia (laboral)",montoUf:20},{id:"inaplicabilidad",nombre:"Recurso de inaplicabilidad",montoUf:30},{id:"revision",nombre:"Recurso de revisi\xf3n",montoUf:50}]}];var l=c(92714);async function m(){return process.env.SUPABASE_SERVICE_KEY?(0,f.r)():(0,f.R)()}let n="preparacion";function o(a){return"string"==typeof a&&["activo","preparacion","en_revision","cerrado"].includes(a)?a:n}async function p(a){try{let b=await (0,g.oC)(["abogado","analista"]),{marcar_validado:c,audiencia_inicial_tipo:d,audiencia_inicial_requiere_testigos:f,...j}=i.Ao.parse(a);if(!j.cliente_principal_id)throw Error("Debes seleccionar un cliente principal antes de crear el caso.");let k=await m(),l=new Date().toISOString(),n={caratulado:j.caratulado,nombre_cliente:j.nombre_cliente,numero_causa:j.numero_causa??null,materia:j.materia??null,tribunal:j.tribunal??null,region:j.region??null,comuna:j.comuna??null,rut_cliente:j.rut_cliente??null,contraparte:j.contraparte??null,etapa_actual:j.etapa_actual??null,fecha_inicio:j.fecha_inicio??null,abogado_responsable:j.abogado_responsable??("abogado"===b.role?b.id:null),estado:j.estado??"activo",workflow_state:o(j.workflow_state??(c?"en_revision":"preparacion")),prioridad:j.prioridad??"media",valor_estimado:j.valor_estimado??null,honorario_total_uf:j.honorario_total_uf??null,honorario_variable_porcentaje:j.honorario_variable_porcentaje??null,honorario_variable_base:j.honorario_variable_base??null,honorario_moneda:j.honorario_moneda??"UF",modalidad_cobro:j.modalidad_cobro??"prepago",honorario_notas:j.honorario_notas??null,tarifa_referencia:j.tarifa_referencia??null,honorario_pagado_uf:void 0!==j.honorario_pagado_uf&&null!==j.honorario_pagado_uf?Number(j.honorario_pagado_uf):0,observaciones:j.observaciones??null,alcance_cliente_autorizado:"number"==typeof j.alcance_cliente_autorizado?j.alcance_cliente_autorizado:0,alcance_cliente_solicitado:"number"==typeof j.alcance_cliente_solicitado?j.alcance_cliente_solicitado:0,cliente_principal_id:j.cliente_principal_id??null,descripcion_inicial:j.descripcion_inicial??null,documentacion_recibida:j.documentacion_recibida??null,objetivo_cliente:j.objetivo_cliente??null,created_at:l,updated_at:l,validado_at:c?j.validado_at??l:null},{data:p,error:q}=await k.from("cases").insert(n).select().single();if(q)throw q;return await z(p.id,n.cliente_principal_id),await A(p),d&&await B(p,{audienciaTipo:d,...void 0!==f&&{requiereTestigos:!!f}}),await (0,h.UU)({action:"CREATE",entity_type:"case",entity_id:p.id,diff_json:{created:n}}),(0,e.revalidatePath)("/cases"),(0,e.revalidatePath)("/dashboard"),{success:!0,case:p}}catch(a){return console.error("Error in createCase:",a),{success:!1,error:a.message}}}async function q(a){try{let b=await (0,g.oC)("abogado"),c=i.YN.parse(a),d=await C(c.brief),e=function(a){if(!a)return{};let b={};for(let[c,d]of Object.entries(a))void 0!==d&&(b[c]=d);return b}(c.overrides),f={caratulado:d.caratulado??"Caso generado desde brief",nombre_cliente:d.nombre_cliente??"Cliente por definir",materia:d.materia??"Civil",etapa_actual:d.etapa_actual??"Ingreso Demanda",estado:d.estado??"activo",workflow_state:o(d.workflow_state??n),prioridad:d.prioridad??"media",numero_causa:d.numero_causa??void 0,tribunal:d.tribunal??void 0,region:d.region??void 0,comuna:d.comuna??void 0,contraparte:d.contraparte??void 0,descripcion_inicial:d.descripcion_inicial??"Caso creado desde brief.",documentacion_recibida:d.documentacion_recibida??void 0,objetivo_cliente:d.objetivo_cliente??void 0,observaciones:d.observaciones??`Caso creado desde brief:

${c.brief}`,valor_estimado:d.valor_estimado??void 0,honorario_total_uf:d.honorario_total_uf??void 0,honorario_pagado_uf:d.honorario_pagado_uf??void 0,honorario_variable_porcentaje:d.honorario_variable_porcentaje??void 0,honorario_variable_base:d.honorario_variable_base??void 0,honorario_moneda:d.honorario_moneda??"UF",modalidad_cobro:d.modalidad_cobro??"prepago",honorario_notas:d.honorario_notas??void 0,tarifa_referencia:d.tarifa_referencia??void 0,rut_cliente:d.rut_cliente??void 0,cliente_principal_id:d.cliente_principal_id??void 0,fecha_inicio:d.fecha_inicio??void 0,abogado_responsable:b.id},h=e?.cliente_principal_id??f.cliente_principal_id;if(!h)throw Error("Debes indicar el cliente principal al crear el caso.");let j={...f,...e,workflow_state:o(e?.workflow_state??f.workflow_state),caratulado:e?.caratulado??f.caratulado,nombre_cliente:e?.nombre_cliente??f.nombre_cliente,materia:e?.materia??f.materia,etapa_actual:e?.etapa_actual??f.etapa_actual,estado:e?.estado??f.estado,prioridad:e?.prioridad??f.prioridad,descripcion_inicial:e?.descripcion_inicial??f.descripcion_inicial??"",modalidad_cobro:e?.modalidad_cobro??f.modalidad_cobro??"prepago",honorario_moneda:e?.honorario_moneda??f.honorario_moneda??"UF",honorario_total_uf:e?.honorario_total_uf??f.honorario_total_uf,honorario_pagado_uf:e?.honorario_pagado_uf??f.honorario_pagado_uf,honorario_variable_porcentaje:e?.honorario_variable_porcentaje??f.honorario_variable_porcentaje,honorario_variable_base:e?.honorario_variable_base??f.honorario_variable_base,honorario_notas:e?.honorario_notas??f.honorario_notas,tarifa_referencia:e?.tarifa_referencia??f.tarifa_referencia,alcance_cliente_autorizado:e?.alcance_cliente_autorizado??f.alcance_cliente_autorizado,alcance_cliente_solicitado:e?.alcance_cliente_solicitado??f.alcance_cliente_solicitado,cliente_principal_id:h};return await p(j)}catch(a){return console.error("Error in createCaseFromBrief:",a),{success:!1,error:a.message}}}async function r(a,b){try{let c=await (0,g.oC)(),{marcar_validado:d,audiencia_inicial_tipo:f,audiencia_inicial_requiere_testigos:j,...k}=i.hd.parse(b),l=await m(),{data:n,error:p}=await l.from("cases").select("*").eq("id",a).single();if(p||!n)throw Error("Caso no encontrado");let q="admin_firma"===c.role,r="abogado"===c.role&&n.abogado_responsable===c.id,s="analista"===c.role&&n.analista_id===c.id;if(!q&&!r&&!s)throw Error("Sin permisos para editar este caso");if(s&&"cerrado"===n.workflow_state)throw Error("El caso ya fue cerrado");let t=new Date().toISOString(),u={updated_at:t,...void 0!==k.caratulado&&{caratulado:k.caratulado},...void 0!==k.nombre_cliente&&{nombre_cliente:k.nombre_cliente},...void 0!==k.materia&&{materia:k.materia},...void 0!==k.etapa_actual&&{etapa_actual:k.etapa_actual},...void 0!==k.fecha_inicio&&{fecha_inicio:k.fecha_inicio},...void 0!==k.numero_causa&&{numero_causa:k.numero_causa},...void 0!==k.tribunal&&{tribunal:k.tribunal},...void 0!==k.region&&{region:k.region},...void 0!==k.comuna&&{comuna:k.comuna},...void 0!==k.contraparte&&{contraparte:k.contraparte},...void 0!==k.descripcion_inicial&&{descripcion_inicial:k.descripcion_inicial},...void 0!==k.documentacion_recibida&&{documentacion_recibida:k.documentacion_recibida},...void 0!==k.objetivo_cliente&&{objetivo_cliente:k.objetivo_cliente},...void 0!==k.observaciones&&{observaciones:k.observaciones},...void 0!==k.valor_estimado&&{valor_estimado:k.valor_estimado??null},...void 0!==k.honorario_total_uf&&{honorario_total_uf:k.honorario_total_uf??null},...void 0!==k.honorario_pagado_uf&&{honorario_pagado_uf:null!==k.honorario_pagado_uf&&void 0!==k.honorario_pagado_uf?Number(k.honorario_pagado_uf):0},...void 0!==k.honorario_variable_porcentaje&&{honorario_variable_porcentaje:k.honorario_variable_porcentaje??null},...void 0!==k.honorario_variable_base&&{honorario_variable_base:k.honorario_variable_base??null},...void 0!==k.honorario_moneda&&{honorario_moneda:k.honorario_moneda},...void 0!==k.modalidad_cobro&&{modalidad_cobro:k.modalidad_cobro},...void 0!==k.honorario_notas&&{honorario_notas:k.honorario_notas??null},...void 0!==k.tarifa_referencia&&{tarifa_referencia:k.tarifa_referencia??null},...void 0!==k.rut_cliente&&{rut_cliente:k.rut_cliente},...void 0!==k.cliente_principal_id&&{cliente_principal_id:k.cliente_principal_id??null},...void 0!==k.abogado_responsable&&{abogado_responsable:k.abogado_responsable??null},...void 0!==k.analista_id&&{analista_id:k.analista_id??null},...void 0!==k.alcance_cliente_solicitado&&{alcance_cliente_solicitado:null===k.alcance_cliente_solicitado?0:Number(k.alcance_cliente_solicitado)},...void 0!==k.alcance_cliente_autorizado&&{alcance_cliente_autorizado:null===k.alcance_cliente_autorizado?0:Number(k.alcance_cliente_autorizado)}};void 0!==k.estado&&(u.estado=k.estado),void 0!==k.prioridad&&(u.prioridad=k.prioridad),void 0!==k.workflow_state&&(u.workflow_state=o(k.workflow_state)),void 0!==d&&(u.validado_at=d?k.validado_at??n.validado_at??t:null,void 0===k.workflow_state&&(u.workflow_state=d?"cerrado"===n.workflow_state?"cerrado":"en_revision":"preparacion")),s&&!n.analista_id&&(u.analista_id=c.id);let{data:v,error:w}=await l.from("cases").update(u).eq("id",a).select().single();if(w)throw w;return await z(a,k.cliente_principal_id??void 0),await (0,h.UU)({action:"UPDATE",entity_type:"case",entity_id:a,diff_json:{from:n,to:v}}),f&&await B(v,{audienciaTipo:f,...void 0!==j&&{requiereTestigos:!!j}}),(0,e.revalidatePath)(`/cases/${a}`),(0,e.revalidatePath)("/cases"),(0,e.revalidatePath)("/dashboard"),{success:!0,case:v}}catch(a){return console.error("Error in updateCase:",a),{success:!1,error:a.message}}}async function s(a,b){try{let c=await (0,g.oC)("cliente"),d=await m(),{data:f,error:i}=await d.from("cases").select("id, cliente_principal_id, alcance_cliente_autorizado, alcance_cliente_solicitado").eq("id",a).maybeSingle();if(i||!f)throw Error("Caso no encontrado");let j=f.cliente_principal_id===c.id;if(!j){let{data:b}=await d.from("case_clients").select("id").eq("case_id",a).eq("client_profile_id",c.id).maybeSingle();j=!!b}if(!j)throw Error("Sin permisos para solicitar avances en este caso");let{data:k,error:l}=await d.from("case_stages").select("id, case_id, orden, requiere_pago, es_publica, estado, estado_pago").eq("id",b).maybeSingle();if(l||!k)throw Error("Etapa no encontrada");if(k.case_id!==a)throw Error("La etapa seleccionada no pertenece al caso");if(!1===k.es_publica)throw Error("No puedes solicitar una etapa privada");if("completado"===k.estado)throw Error("La etapa ya se encuentra completada");let n=k.orden??0;if(n<=0)throw Error("La etapa seleccionada no tiene un orden v\xe1lido");let o=f.alcance_cliente_autorizado??0,p=f.alcance_cliente_solicitado??0;if(n<=o)return{success:!1,error:"Esa etapa ya est\xe1 autorizada para ejecuci\xf3n."};let q=Math.max(n,p??0),r=new Date().toISOString(),{error:s}=await d.from("cases").update({alcance_cliente_solicitado:q,updated_at:r}).eq("id",a);if(s)throw s;let{error:t}=await d.from("case_stages").update({estado_pago:"solicitado",solicitado_por:c.id,solicitado_at:r}).eq("case_id",a).lte("orden",n).eq("requiere_pago",!0).in("estado_pago",["pendiente","vencido"]);if(t)throw t;return await (0,h.UU)({action:"REQUEST_ADVANCE",entity_type:"case",entity_id:a,diff_json:{requested_order:q,requested_stage_id:b,requested_by:c.id}}),(0,e.revalidatePath)(`/cases/${a}`),(0,e.revalidatePath)("/dashboard"),{success:!0,requestedOrder:q}}catch(a){return console.error("Error in requestCaseAdvance:",a),{success:!1,error:a.message}}}async function t(a,b){try{let c=await (0,g.oC)(["admin_firma","analista"]),d=await m();if(!Number.isInteger(b)||b<=0)throw Error("Debes seleccionar una etapa v\xe1lida para autorizar.");let{data:f,error:i}=await d.from("cases").select("id, alcance_cliente_autorizado, alcance_cliente_solicitado").eq("id",a).maybeSingle();if(i||!f)throw Error("Caso no encontrado");let j=f.alcance_cliente_autorizado??0,k=f.alcance_cliente_solicitado??0;if(b<=j)return{success:!1,error:"Ya existe un alcance igual o superior autorizado."};let l=k>0?Math.min(b,k):b,{data:n}=await d.from("case_stages").select("id").eq("case_id",a).eq("orden",l).maybeSingle();if(!n)throw Error("La etapa seleccionada no existe en el caso");let o=new Date().toISOString(),{error:p}=await d.from("cases").update({alcance_cliente_autorizado:l,alcance_cliente_solicitado:Math.max(k??0,l),updated_at:o}).eq("id",a);if(p)throw p;let{error:q}=await d.from("case_stages").update({estado_pago:"en_proceso"}).eq("case_id",a).lte("orden",l).eq("requiere_pago",!0).in("estado_pago",["solicitado"]);if(q)throw q;return await (0,h.UU)({action:"AUTHORIZE_ADVANCE",entity_type:"case",entity_id:a,diff_json:{authorized_order:l,authorized_by:c.id}}),(0,e.revalidatePath)(`/cases/${a}`),(0,e.revalidatePath)("/dashboard"),{success:!0,authorizedOrder:l}}catch(a){return console.error("Error in authorizeCaseAdvance:",a),{success:!1,error:a.message}}}async function u(){try{await (0,g.oC)(["admin_firma","analista"]);let a=await m(),{data:b,error:c}=await a.from("profiles").select("id, nombre, email, telefono, activo").eq("role","abogado").order("nombre",{ascending:!0});if(c)throw c;let d=b?.map(a=>({id:a.id,nombre:a.nombre,email:a.email,telefono:a.telefono,activo:a.activo}))??[];return{success:!0,lawyers:d}}catch(a){return console.error("Error in listAvailableLawyers:",a),{success:!1,lawyers:[],error:a.message}}}async function v(a){try{let b=await (0,g.oC)(["admin_firma","analista"]),c=i.NX.parse(a),d=await m(),{data:f,error:j}=await d.from("cases").select("id, abogado_responsable").eq("id",c.case_id).single();if(j||!f)throw j??Error("Caso no encontrado");if(f.abogado_responsable===c.abogado_id)return{success:!1,error:"El caso ya est\xe1 asignado a ese abogado."};let k=new Date().toISOString(),{data:l,error:n}=await d.from("cases").update({abogado_responsable:c.abogado_id,updated_at:k}).eq("id",c.case_id).select("id, abogado_responsable").single();if(n)throw n;let{data:o}=await d.from("profiles").select("id, nombre, email, telefono").eq("id",c.abogado_id).maybeSingle();return await (0,h.UU)({action:"ASSIGN_LAWYER",entity_type:"case",entity_id:c.case_id,diff_json:{previous_lawyer:f.abogado_responsable??null,new_lawyer:c.abogado_id,changed_by:b.id}}),(0,e.revalidatePath)(`/cases/${c.case_id}`),(0,e.revalidatePath)("/cases"),(0,e.revalidatePath)("/dashboard"),{success:!0,case:l,lawyer:o??null}}catch(a){return console.error("Error in assignLawyer:",a),{success:!1,error:a.message}}}async function w(a){try{await (0,g.oC)("admin_firma");let b=await m(),{error:c}=await b.from("cases").delete().eq("id",a);if(c)throw c;return await (0,h.UU)({action:"DELETE",entity_type:"case",entity_id:a,diff_json:{deleted:!0}}),(0,e.revalidatePath)("/cases"),(0,e.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error("Error in deleteCase:",a),{success:!1,error:a.message}}}async function x(a={}){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c={...a??{}};null==c.page&&(c.page=1),null==c.limit&&(c.limit=10);let d=i.xp.parse(c),e=await m(),f=e.from("cases").select(`
        *,
        abogado_responsable:profiles!cases_abogado_responsable_fkey(id, nombre),
        case_stages(id, etapa, estado, fecha_programada, orden),
        counterparties:case_counterparties(nombre, tipo)
      `,{count:"exact"});if("abogado"===b.role)f=f.eq("abogado_responsable",b.id);else if("cliente"===b.role){let{data:a}=await e.from("case_clients").select("case_id").eq("client_profile_id",b.id),c=a?.map(a=>a.case_id)??[];if(0===c.length)return{success:!0,cases:[],total:0,page:d.page,limit:d.limit};f=f.in("id",c)}if(d.estado&&(f=f.eq("estado",d.estado)),d.prioridad&&(f=f.eq("prioridad",d.prioridad)),d.abogado_responsable&&(f=f.eq("abogado_responsable",d.abogado_responsable)),d.materia&&(f=f.eq("materia",d.materia)),d.fecha_inicio_desde&&(f=f.gte("fecha_inicio",d.fecha_inicio_desde)),d.fecha_inicio_hasta&&(f=f.lte("fecha_inicio",d.fecha_inicio_hasta)),d.search){let a=d.search;f=f.or(`caratulado.ilike.%${a}%,nombre_cliente.ilike.%${a}%,numero_causa.ilike.%${a}%`)}let h=(d.page-1)*d.limit,j=h+d.limit-1,{data:k,error:l,count:n}=await f.range(h,j).order("created_at",{ascending:!1});if(l)throw l;return{success:!0,cases:k??[],total:n??0,page:d.page,limit:d.limit}}catch(a){return console.error("Error in getCases:",a),{success:!1,error:a.message,cases:[],total:0}}}async function y(a){try{let b=await (0,g.Rk)();if(!b)throw Error("No autenticado");let c=await m(),{data:d,error:e}=await c.from("cases").select("*").eq("id",a).single();if(e||!d)throw Error("Caso no encontrado");if("cliente"===b.role){let{data:d}=await c.from("case_clients").select("id").eq("case_id",a).eq("client_profile_id",b.id).maybeSingle();if(!d)throw Error("Sin permisos para ver este caso")}if("abogado"===b.role&&d.abogado_responsable&&d.abogado_responsable!==b.id)throw Error("Sin permisos para ver este caso");let[f,h,i,j,k,l,n]=await Promise.all([(async()=>{if(!d.abogado_responsable)return null;let{data:b,error:e}=await c.from("profiles").select("id, nombre, telefono, rut").eq("id",d.abogado_responsable).maybeSingle();return e?(console.error("Error fetching lawyer profile",a,e.message),null):b})(),c.from("case_stages").select("*, responsable:profiles(id, nombre)").eq("case_id",a).order("orden",{ascending:!0}),c.from("notes").select("*, author:profiles(id, nombre)").eq("case_id",a).order("created_at",{ascending:!1}),c.from("documents").select("*, uploader:profiles(id, nombre)").eq("case_id",a).order("created_at",{ascending:!1}),c.from("info_requests").select("*, creador:profiles(id, nombre)").eq("case_id",a).order("created_at",{ascending:!1}),c.from("case_counterparties").select("*").eq("case_id",a).order("created_at",{ascending:!1}),c.from("case_clients").select("client:profiles(id, nombre, email, telefono)").eq("case_id",a).order("created_at",{ascending:!0})]),o={...d,abogado_responsable_id:d.abogado_responsable,abogado_responsable:f?{id:f.id,nombre:f.nombre,telefono:f.telefono,rut:f.rut}:null,case_stages:h?.data??[],notes:i?.data??[],documents:j?.data??[],info_requests:k?.data??[],counterparties:l?.data??[],clients:n?.data?.map(a=>a.client?{...a.client}:null).filter(a=>!!a)??[]};return{success:!0,case:o}}catch(a){return console.error("Error in getCaseById:",a),{success:!1,error:a.message}}}async function z(a,b){if(b)try{let c=await m();await c.from("case_clients").upsert([{case_id:a,client_profile_id:b}],{onConflict:"case_id,client_profile_id"})}catch(a){console.error("Error vinculando cliente principal al caso:",a)}}async function A(a){let b=await m(),c=(0,j.CT)(a.materia||"Civil"),d=a.fecha_inicio?new Date(a.fecha_inicio):new Date,e=function(a){if(!a)return;let b=a.trim().toLowerCase(),c=b.replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");for(let a of k){let d=a.items.find(a=>a.id===b||a.id===c||a.nombre.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")===c);if(d)return d}}(a.tarifa_referencia),f="number"==typeof a.honorario_total_uf?Number(a.honorario_total_uf):e?.montoUf??null,g=(a.modalidad_cobro??"prepago")==="prepago"&&"UF"===a.honorario_moneda&&null!==f,h=g?f:null,i=a=>Number(a.toFixed(2)),l=0,n=0,o=c.map((b,e)=>{l+=b.diasEstimados;let f=new Date(d.getTime());f.setDate(f.getDate()+l);let j=f.toISOString().split("T")[0],k=null;if(null!==h){let a=b.porcentajeHonorario??0;a>0&&(e===c.length-1?k=i(h-n):(k=i(h*a),n+=k))}return{case_id:a.id,etapa:b.etapa,descripcion:b.descripcion??null,estado:"pendiente",orden:e+1,es_publica:b.esPublica??!0,fecha_programada:j??null,fecha_cumplida:null,responsable_id:null,requiere_pago:g,costo_uf:k,porcentaje_variable:b.porcentajeVariable??null,estado_pago:"pendiente",enlace_pago:null,notas_pago:b.notasPago??null,monto_variable_base:b.porcentajeVariable&&b.notasPago?b.notasPago:null,monto_pagado_uf:0}});0!==o.length&&await b.from("case_stages").insert(o)}async function B(a,b){let{audienciaTipo:c,requiereTestigos:d}=b;if(c)try{let b=await m(),{data:e,error:f}=await b.from("case_stages").select("id, etapa").eq("case_id",a.id).in("etapa","preparatoria"===c?["Audiencia preparatoria","Audiencia preliminar"]:["Audiencia de juicio","Audiencia juicio","Juicio","Alegatos y vista de la causa"]).order("orden",{ascending:!0}).limit(1).maybeSingle();f&&console.error("Error buscando etapa de audiencia inicial:",f);let g=e?.id??null;if(!g){let{data:c,error:d}=await b.from("case_stages").select("id, etapa").eq("case_id",a.id).ilike("etapa","%audiencia%").order("orden",{ascending:!0}).limit(1).maybeSingle();d&&console.error("Error buscando etapa de audiencia (fallback):",d),g=c?.id??null}if(!g)return;await b.from("case_stages").update({audiencia_tipo:c,requiere_testigos:!!d}).eq("id",g)}catch(a){console.error("Error aplicando preferencia de audiencia inicial:",a)}}async function C(a){let b={};for(let c of a.toLowerCase().split("\n")){if(c.includes("caratulado")||c.includes("caso")||c.includes("demanda")){let a=c.match(/(?:caratulado|caso|demanda)[:\s]+(.+)/),d=a?.[1]?.trim();d&&(b.caratulado=d)}if(c.includes("cliente")||c.includes("demandante")){let a=c.match(/(?:cliente|demandante)[:\s]+(.+)/),d=a?.[1]?.trim();d&&(b.nombre_cliente=d)}c.includes("laboral")&&(b.materia="Laboral"),c.includes("civil")&&(b.materia="Civil"),c.includes("comercial")&&(b.materia="Comercial"),c.includes("penal")&&(b.materia="Penal"),c.includes("familia")&&(b.materia="Familia"),c.includes("urgente")&&(b.prioridad="urgente"),c.includes("alta prioridad")&&(b.prioridad="alta"),c.includes("baja prioridad")&&(b.prioridad="baja")}return b.observaciones=b.observaciones??`Caso creado desde brief:

${a}`,b}(0,l.D)([p,q,r,s,t,u,v,w,x,y]),(0,d.A)(p,"402238d93ed96f80b46537a5e0b468a17e405e77e2",null),(0,d.A)(q,"4000d8cd2ba4bd8571f053fb2215c286c8fbf097fa",null),(0,d.A)(r,"601dc316dca099ac5c6111fb7c78b63a6a2296a56b",null),(0,d.A)(s,"60d22c0eee3e81479564a5d2c578cd4d8d7527f1eb",null),(0,d.A)(t,"6086c61dfb9231b4acbda11d41d490ece17f554ca3",null),(0,d.A)(u,"00127df0956e3268c8ee6c6b96b1f1e3b422410771",null),(0,d.A)(v,"406a9d70a736b5d8693dccaf0ba8bb918d3389df1f",null),(0,d.A)(w,"4054e0d1cecfb5e836b11e8f19c114f2724f0c0c7c",null),(0,d.A)(x,"401f7248722e0533778da264be8df7152af35a6787",null),(0,d.A)(y,"4005f7c145bf66a16dcd86c42970c298fe8360e0be",null)}};