"use strict";exports.id=563,exports.ids=[563],exports.modules={8618:(a,b,c)=>{c.d(b,{Wu:()=>j,ZB:()=>i,Zp:()=>g,aR:()=>h});var d=c(59356),e=c(56389),f=c(16815);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));g.displayName="Card";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex flex-col space-y-1.5 p-6",a),...b}));h.displayName="CardHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h3",{ref:c,className:(0,f.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));i.displayName="CardTitle",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("p",{ref:c,className:(0,f.cn)("text-sm text-muted-foreground",a),...b})).displayName="CardDescription";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("p-6 pt-0",a),...b}));j.displayName="CardContent",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter"},18137:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},25908:(a,b,c)=>{c.d(b,{Fc:()=>n,JN:()=>l,Pj:()=>p,md:()=>q,w1:()=>m,wx:()=>k,xf:()=>o});var d=c(19703);c(71977);var e=c(15352),f=c(47550),g=c(42981);let h=a=>(a??"").trim().toLowerCase(),i=a=>["admin_firma","abogado","analista"].includes(a),j={totalCases:0,activeCases:0,completedCases:0,totalClients:0,totalDocuments:0,totalNotes:0,pendingRequests:0,overdueStages:0};async function k(){try{let a=await (0,f.oC)(),b=h(a.role);if(!i(b))return console.warn("⚠️ Rol sin permisos (getDashboardStats):",a.role),{success:!0,stats:{...j}};let c=await (0,e.R)(),d=c.from("cases").select("*"),g=(async()=>{if("abogado"===b){let{data:b,error:d}=await c.from("cases").select("id").eq("abogado_responsable",a.id);if(d)return{data:null,error:d};let e=b?.map(a=>a.id)||[];if(0===e.length)return{data:[],error:null};let{data:f,error:g}=await c.from("case_clients").select("client_profile_id").in("case_id",e);if(g)return{data:null,error:g};let h=f?.map(a=>a.client_profile_id)||[];return 0===h.length?{data:[],error:null}:c.from("profiles").select("*").in("id",h)}return c.from("profiles").select("*").eq("role","cliente")})();"abogado"===b&&(d=d.eq("abogado_responsable",a.id));let[k,l,m,n,o,p]=await Promise.all([d,g,c.from("documents").select("*"),c.from("notes").select("*"),c.from("info_requests").select("*").eq("estado","pendiente"),c.from("case_stages").select("*").eq("estado","pendiente").lt("fecha_programada",new Date().toISOString())]);if(k.error)throw k.error;if(l.error)throw l.error;if(m.error)throw m.error;if(n.error)throw n.error;if(o.error)throw o.error;if(p.error)throw p.error;let q=k.data??[],r=q.filter(a=>"activo"===a.estado).length,s=q.filter(a=>"terminado"===a.estado).length,t={totalCases:q.length,activeCases:r,completedCases:s,totalClients:l.data?.length||0,totalDocuments:m.data?.length||0,totalNotes:n.data?.length||0,pendingRequests:o.data?.length||0,overdueStages:p.data?.length||0};return{success:!0,stats:t}}catch(a){return console.error("Error getting dashboard stats:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function l(){try{let a=await (0,f.oC)(),b=h(a.role);if(!i(b))return console.warn("⚠️ Rol sin permisos (getCasesByStatus):",a.role),{success:!0,data:[]};let c=(await (0,e.R)()).from("cases").select("estado");"abogado"===b&&(c=c.eq("abogado_responsable",a.id));let{data:d,error:g}=await c;if(g)throw g;let j=d??[],k=j.reduce((a,b)=>{let c=b.estado||"sin_estado";return a[c]=(a[c]||0)+1,a},{}),l=j.length,m=Object.entries(k).map(([a,b])=>({status:a,count:b,percentage:l>0?Math.round(b/l*100):0}));return{success:!0,data:m}}catch(a){return console.error("Error getting cases by status:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function m(){try{let a=await (0,f.oC)(),b=h(a.role);if(!i(b))return console.warn("⚠️ Rol sin permisos (getCasesByMateria):",a.role),{success:!0,data:[]};let c=(await (0,e.R)()).from("cases").select("materia");"abogado"===b&&(c=c.eq("abogado_responsable",a.id));let{data:d,error:g}=await c;if(g)throw g;let j=d??[],k=j.reduce((a,b)=>{let c=b.materia||"Sin especificar";return a[c]=(a[c]||0)+1,a},{}),l=j.length,m=Object.entries(k).map(([a,b])=>({materia:a,count:b,percentage:l>0?Math.round(b/l*100):0}));return{success:!0,data:m}}catch(a){return console.error("Error getting cases by materia:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function n(){try{let a=await (0,f.oC)(),b=h(a.role);if(!i(b))return console.warn("⚠️ Rol sin permisos (getCasesByPriority):",a.role),{success:!0,data:[]};let c=(await (0,e.R)()).from("cases").select("prioridad");"abogado"===b&&(c=c.eq("abogado_responsable",a.id));let{data:d,error:g}=await c;if(g)throw g;let j=d??[],k=j.reduce((a,b)=>{let c=b.prioridad||"media";return a[c]=(a[c]||0)+1,a},{}),l=j.length,m=Object.entries(k).map(([a,b])=>({priority:a,count:b,percentage:l>0?Math.round(b/l*100):0}));return{success:!0,data:m}}catch(a){return console.error("Error getting cases by priority:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function o(){try{let a=await (0,f.oC)(),b=h(a.role);if(!i(b)){console.warn("⚠️ Rol sin permisos (getMonthlyStats):",a.role);let b=Array.from({length:12}).map((a,b)=>{let c=new Date;return c.setMonth(c.getMonth()-(11-b)),{month:c.toLocaleDateString("es-CL",{year:"numeric",month:"short"}),newCases:0,completedCases:0,revenue:0}});return{success:!0,data:b}}let c=await (0,e.R)(),d=new Date;d.setMonth(d.getMonth()-11),d.setDate(1);let g=c.from("cases").select("fecha_inicio, valor_estimado").gte("fecha_inicio",d.toISOString()),j=c.from("cases").select("updated_at, valor_estimado").eq("estado","terminado").gte("updated_at",d.toISOString());"abogado"===b&&(g=g.eq("abogado_responsable",a.id),j=j.eq("abogado_responsable",a.id));let[k,l]=await Promise.all([g,j]);if(k.error)throw k.error;if(l.error)throw l.error;let m=k.data??[],n=l.data??[],o={};for(let a=0;a<12;a++){let b=new Date;b.setMonth(b.getMonth()-a);let c=b.toISOString().slice(0,7),d=b.toLocaleDateString("es-CL",{year:"numeric",month:"short"});o[c]={month:d,newCases:0,completedCases:0,revenue:0}}m.forEach(a=>{let b=a.fecha_inicio;if(b){let a=b.slice(0,7);o[a]&&o[a].newCases++}}),n.forEach(a=>{let b=a.updated_at,c=a.valor_estimado;if(b){let a=b.slice(0,7);o[a]&&(o[a].completedCases++,o[a].revenue+=c||0)}});let p=Object.values(o).reverse();return{success:!0,data:p}}catch(a){return console.error("Error getting monthly stats:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function p(){try{let a=await (0,f.oC)(),b=h(a.role);if("admin_firma"!==b)return console.warn("⚠️ Rol sin permisos (getAbogadoWorkload):",a.role),{success:!0,data:[]};let c=await (0,e.R)(),{data:d,error:g}=await c.from("profiles").select("id, nombre").in("role",["abogado","admin_firma"]);if(g)throw g;let i=(d??[]).map(async a=>{let[b,d]=await Promise.all([c.from("cases").select("valor_estimado").eq("abogado_responsable",a.id).eq("estado","activo"),c.from("cases").select("valor_estimado").eq("abogado_responsable",a.id).eq("estado","terminado")]),e=b.data??[],f=d.data??[],g=[...e,...f].reduce((a,b)=>a+(b.valor_estimado??0),0),h=e.length+f.length;return{abogado_id:a.id,nombre:a.nombre??"Sin nombre",activeCases:e.length,completedCases:f.length,totalValue:g,avgCaseValue:h>0?g/h:0}}),j=await Promise.all(i);return{success:!0,data:j}}catch(a){return console.error("Error getting abogado workload:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}async function q(){try{let a=await (0,f.oC)(),b=h(a.role);if(!i(b))return console.warn("⚠️ Rol sin permisos (getUpcomingDeadlines):",a.role),{success:!0,data:[]};let c=await (0,e.R)(),d=new Date;d.setDate(d.getDate()+30);let g=c.from("case_stages").select(`
        *,
        case:cases(id, caratulado, abogado_responsable)
      `).eq("estado","pendiente").gte("fecha_programada",new Date().toISOString()).lte("fecha_programada",d.toISOString()).order("fecha_programada",{ascending:!0}),{data:j,error:k}=await g;if(k)throw k;let l=j??[];return"abogado"===b&&(l=l.filter(b=>b.case?.abogado_responsable===a.id)),{success:!0,data:l}}catch(a){return console.error("Error getting upcoming deadlines:",a),{success:!1,error:a instanceof Error?a.message:"Error desconocido"}}}(0,g.D)([k,l,m,n,o,p,q]),(0,d.A)(k,"00b0c0991001c43998fbe8fca79f6f6fddd96cb435",null),(0,d.A)(l,"0008bff0091f66acd6f3d225a68a5099f149e470c5",null),(0,d.A)(m,"00d692812707324e898f70ed1741b9c3902a6a3826",null),(0,d.A)(n,"009b866e6c28c23f314bab603bbf793035d3395bc5",null),(0,d.A)(o,"00ca71899d311f6e5a4b7589c5cbba2d1548882f6f",null),(0,d.A)(p,"005ff48d47f36c821b14c6a5a4241e4535e6e20516",null),(0,d.A)(q,"00ab3108b1806c7de2adec88336c2165b4388076ee",null)},26323:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]])},38388:(a,b,c)=>{c.d(b,{$:()=>j});var d=c(59356),e=c(56389),f=c(67339),g=c(28321),h=c(16815);let i=(0,g.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),j=e.forwardRef(({className:a,variant:b,size:c,asChild:e=!1,...g},j)=>{let k=e?f.DX:"button";return(0,d.jsx)(k,{className:(0,h.cn)(i({variant:b,size:c,className:a})),ref:j,...g})});j.displayName="Button"},58637:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(97145).A)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},87879:(a,b,c)=>{c.d(b,{default:()=>h});var d=c(59356),e=c(56389),f=c(5074),g=c(38388);function h(){let[a,b]=(0,e.useState)(!1),c=(0,f.useRouter)(),h=async()=>{b(!0);try{await fetch("/api/logout",{method:"POST"}),c.replace("/login")}finally{b(!1)}};return(0,d.jsx)(g.$,{variant:"ghost",onClick:h,disabled:a,children:a?"Saliendo…":"Cerrar sesi\xf3n"})}}};